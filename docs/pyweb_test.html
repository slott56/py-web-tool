<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<title>pyWeb Literate Programming 3.3 - Test Suite</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

/* Page layout tweaks */
div.document { width: 7in; }
.small { font-size: smaller; }
.code
{
	color: #101080;
	display: block;
	border-color: black;
	border-width: thin;
	border-style: solid;
	background-color: #E0FFFF;
	/*#99FFFF*/
	padding: 0 0 0 1%;
	margin: 0 6% 0 6%;
	text-align: left;
	font-size: smaller;
}

</style>
</head>
<body>
<div class="document" id="pyweb-literate-programming-3-3-test-suite">
<h1 class="title">pyWeb Literate Programming 3.3 - Test Suite</h1>

<p>** Yet Another Literate Programming Tool**</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#unit-testing" id="toc-entry-2">Unit Testing</a><ul>
<li><a class="reference internal" href="#emitter-tests" id="toc-entry-3">Emitter Tests</a></li>
<li><a class="reference internal" href="#chunk-tests" id="toc-entry-4">Chunk Tests</a></li>
<li><a class="reference internal" href="#chunk-references-tests" id="toc-entry-5">Chunk References Tests</a></li>
<li><a class="reference internal" href="#command-tests" id="toc-entry-6">Command Tests</a></li>
<li><a class="reference internal" href="#web-tests" id="toc-entry-7">Web Tests</a></li>
<li><a class="reference internal" href="#webreader-tests" id="toc-entry-8">WebReader Tests</a></li>
<li><a class="reference internal" href="#action-tests" id="toc-entry-9">Action Tests</a></li>
<li><a class="reference internal" href="#application-tests" id="toc-entry-10">Application Tests</a></li>
<li><a class="reference internal" href="#overheads-and-main-script" id="toc-entry-11">Overheads and Main Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-testing" id="toc-entry-12">Functional Testing</a><ul>
<li><a class="reference internal" href="#shared-fixtures" id="toc-entry-13">Shared Fixtures</a></li>
<li><a class="reference internal" href="#tests-for-loading" id="toc-entry-14">Tests for Loading</a></li>
<li><a class="reference internal" href="#tests-for-tangling" id="toc-entry-15">Tests for Tangling</a></li>
<li><a class="reference internal" href="#tests-for-weaving" id="toc-entry-16">Tests for Weaving</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-scripts-testing" id="toc-entry-17">Additional Scripts Testing</a><ul>
<li><a class="reference internal" href="#sample-web-file" id="toc-entry-18">Sample Web File</a></li>
<li><a class="reference internal" href="#fixture-for-test-cases" id="toc-entry-19">Fixture for test cases</a></li>
<li><a class="reference internal" href="#weave-script-test" id="toc-entry-20">Weave Script Test</a></li>
<li><a class="reference internal" href="#tangle-script-test" id="toc-entry-21">Tangle Script Test</a></li>
<li><a class="reference internal" href="#overheads" id="toc-entry-22">Overheads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices" id="toc-entry-23">Indices</a><ul>
<li><a class="reference internal" href="#files" id="toc-entry-24">Files</a></li>
<li><a class="reference internal" href="#macros" id="toc-entry-25">Macros</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#toc-entry-1">Introduction</a></h1>
<!-- test/test_intro.w -->
<p>There are two levels of testing in this document.</p>
<ul class="simple">
<li><a class="reference internal" href="#unit-testing">Unit Testing</a></li>
<li><a class="reference internal" href="#functional-testing">Functional Testing</a></li>
</ul>
<p>Other testing, like performance or security, is possible.
But for this application, not very interesting.</p>
<p>The <tt class="docutils literal">pyweb_test.w</tt> WEB creates the test suite.
This source will weave a <tt class="docutils literal">pyweb_test.rst</tt> file.
It tangles several test modules:  <tt class="docutils literal">test.py</tt>, <tt class="docutils literal">test_tangler.py</tt>, <tt class="docutils literal">test_weaver.py</tt>,
<tt class="docutils literal">test_loader.py</tt>, <tt class="docutils literal">test_unit.py</tt>, and <tt class="docutils literal">test_scripts.py</tt>.</p>
<p>Use <strong>pytest</strong> to discover and run all 80+ test cases.</p>
<p>Here's a script that works out well for running this without disturbing the development
environment. The <tt class="docutils literal">PYTHONPATH</tt> setting is essential to support importing <tt class="docutils literal">pyweb</tt>.</p>
<pre class="literal-block">
python pyweb.py -o tests tests/pyweb_test.w
PYTHONPATH=$(PWD) pytest
</pre>
<p>Note that the last line sets an environment variable and runs
the <tt class="docutils literal">pytest</tt> tool on a single line.</p>
</div>
<div class="section" id="unit-testing">
<h1><a class="toc-backref" href="#toc-entry-2">Unit Testing</a></h1>
<!-- test/unit.w -->
<p>There are several broad areas of unit testing.  There are the 34 classes in this application.
However, it isn't really necessary to test everyone single one of these classes.
We'll decompose these into several hierarchies.</p>
<ul>
<li><p class="first">Emitters</p>
<blockquote>
<p>class Emitter:</p>
<p>class Weaver(Emitter):</p>
<p>class LaTeX(Weaver):</p>
<p>class HTML(Weaver):</p>
<p>class Tangler(Emitter):</p>
<p>class TanglerMake(Tangler):</p>
</blockquote>
</li>
<li><p class="first">Structure: Chunk, Command</p>
<blockquote>
<p>class Chunk:</p>
<p>class NamedChunk(Chunk):</p>
<p>class NamedChunk_Noindent(Chunk):</p>
<p>class OutputChunk(NamedChunk):</p>
<p>class NamedDocumentChunk(NamedChunk):</p>
<p>class Command:</p>
<p>class TextCommand(Command):</p>
<p>class CodeCommand(TextCommand):</p>
<p>class XrefCommand(Command):</p>
<p>class FileXrefCommand(XrefCommand):</p>
<p>class MacroXrefCommand(XrefCommand):</p>
<p>class UserIdXrefCommand(XrefCommand):</p>
<p>class ReferenceCommand(Command):</p>
</blockquote>
</li>
<li><p class="first">class Error(Exception):</p>
</li>
<li><p class="first">Reference Handling</p>
<blockquote>
<p>class Reference:</p>
<p>class SimpleReference(Reference):</p>
<p>class TransitiveReference(Reference):</p>
</blockquote>
</li>
<li><p class="first">class Web:</p>
</li>
<li><p class="first">class WebReader:</p>
<blockquote>
<p>class Tokenizer:</p>
<p>class OptionParser:</p>
</blockquote>
</li>
<li><p class="first">Action</p>
<blockquote>
<p>class Action:</p>
<p>class ActionSequence(Action):</p>
<p>class WeaveAction(Action):</p>
<p>class TangleAction(Action):</p>
<p>class LoadAction(Action):</p>
</blockquote>
</li>
<li><p class="first">class Application:</p>
</li>
<li><p class="first">class MyWeaver(HTML):</p>
</li>
<li><p class="first">class MyHTML(pyweb.HTML):</p>
</li>
</ul>
<p>This gives us the following outline for unit testing.</p>
<p class="rubric" id="tests-test-unit-py-1">tests/test_unit.py (1) =</p>
<pre class="code literal-block">
→ `Unit Test overheads: imports, etc. (79)`_

→ `Unit Test of Emitter class hierarchy (2)`_
→ `Unit Test of Chunk class hierarchy (14)`_
→ `Unit Test of Chunk References (34)`_
→ `Unit Test of Command class hierarchy (39)`_
→ `Unit Test of Web class (60)`_
→ `Unit Test of WebReader class (65)`_
→ `Unit Test of Action class hierarchy (69)`_
→ `Unit Test of Application class (78)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>tests/test_unit.py (1)</em>.</div>
<div class="section" id="emitter-tests">
<h2><a class="toc-backref" href="#toc-entry-3">Emitter Tests</a></h2>
<p>The emitter class hierarchy produces output files; either woven output
which uses templates to generate proper markup, or tangled output which
precisely follows the document structure.</p>
<p class="rubric" id="unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2) =</p>
<pre class="code literal-block">
→ `Unit Test Mock Chunk class (4)`_
→ `Unit Test of Emitter Superclass (3)`_
→ `Unit Test of Weaver subclass of Emitter (5)`_
→ `Unit Test of LaTeX macros in Weaver (7)`_
→ `Unit Test of HTML macros in Weaver (10)`_
→ `Unit Test of Tangler subclass of Emitter (12)`_
→ `Unit Test of TanglerMake subclass of Emitter (13)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Emitter class hierarchy (2)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p>The Emitter superclass is designed to be extended.
The test creates a subclass to exercise a few key features.
The default emitter is Tangler-like.</p>
<p class="rubric" id="unit-test-of-emitter-superclass-3">Unit Test of Emitter Superclass (3) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def emitter_subclass():
    mock_emit_method = Mock()

    class EmitterExtension(pyweb.Emitter):
        def emit(self, web: pyweb.Web) -&gt; None:
            mock_emit_method(web)
    return EmitterExtension, mock_emit_method

def test_emitter_should_open_close_write(tmp_path, emitter_subclass):
    emitter_subclass, mock_emit_method = emitter_subclass

    output = tmp_path / &quot;TestEmitter.out&quot;
    emitter = emitter_subclass(output)
    web = Mock(name=&quot;mock web&quot;)
    emitter.emit(web)

    mock_emit_method.assert_called_once_with(web)
    assert emitter.output == output
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Emitter Superclass (3)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</div>
<p>A mock <tt class="docutils literal">Chunk</tt> object can be used to test <tt class="docutils literal">Weaver</tt> subclasses.</p>
<p>Some tests will create multiple chunks.
To keep their state separate, we define a function to return each mocked <tt class="docutils literal">Chunk</tt> instance as a new Mock object.</p>
<p>The <tt class="docutils literal">write_closure()</tt> is a function that calls the <tt class="docutils literal">Tangler.write()</tt>  method.
This is <em>not</em> consistent with best unit testing practices.
It is merely a hold-over from an older testing strategy.
The mock call history to the <tt class="docutils literal">tangle()</tt> method of each <tt class="docutils literal">Chunk</tt> instance is a better test strategy.</p>
<p class="rubric" id="unit-test-mock-chunk-class-4">Unit Test Mock Chunk class (4) =</p>
<pre class="code literal-block">
def mock_chunk_instance(name: str, seq: int, location: tuple[str, int], commands=None) -&gt; Mock:
    chunk = Mock(
        wraps=pyweb.Chunk,
        seq=seq,
        commands=commands or [],
        def_names=[],
        references=0,
        referencedBy=None,
        # Properties
        full_name=name,
        path=None,
        location=location,
        # Methods
        type_is=Mock(side_effect=lambda x: x == &quot;Chunk&quot;),
        tangle=Mock(),
    )
    # Peculiarity of mocks, ``name`` as mocked property must be set separately.
    chunk.name = name
    return chunk

# Remove this...
MockChunk = Mock(
    name=&quot;Chunk class&quot;,
    side_effect=mock_chunk_instance
)

# TODO: Make this a fixture used by the mock web fixture.
def mock_chunks() -&gt; list[pyweb.Chunk]:
    def tangle_method(aTangler: pyweb.Tangler, target: TextIO) -&gt; None:
        aTangler.codeBlock(target, &quot;Mocked Tangle Output\n&quot;)

    # Pre-built references for a mock web.
    mock_file = Mock(full_name=&quot;sample.out&quot;, seq=1)
    mock_file.name = &quot;sample.out&quot;

    mock_output = Mock(full_name=&quot;named chunk&quot;, seq=2, def_list=[3])
    mock_output.name = &quot;named chunk&quot;

    mock_uid_1 = Mock(userid=&quot;user_id_1&quot;, ref_list=[mock_output])
    mock_uid_2 = Mock(userid=&quot;user_id_2&quot;, ref_list=[mock_output])

    c_0 = mock_chunk_instance(&quot;c1&quot;, 1, (mock_file.name, 11))
    c_0.type_is=Mock(side_effect = lambda n: n == &quot;Chunk&quot;)
    c_0.referenced_by = None
    c_0.commands=[
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.TextCommand, &quot;typeid&quot;),
            text=&quot;text with |char| untouched.&quot;,
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.TextCommand, &quot;typeid&quot;),
            text=&quot;\n&quot;,
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.FileXrefCommand, &quot;typeid&quot;),
            location=1,
            files=[mock_file],
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.TextCommand, &quot;typeid&quot;),
            text=&quot;\n&quot;,
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.MacroXrefCommand, &quot;typeid&quot;),
            location=2,
            macros=[mock_output],
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.TextCommand, &quot;typeid&quot;),
            text=&quot;\n&quot;,
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.UserIdXrefCommand, &quot;typeid&quot;),
            location=3,
            userids=[mock_uid_1, mock_uid_2]
        ),
    ]

    c_1 = mock_chunk_instance(&quot;c3...&quot;, 42, (mock_file.name, 22))
    c_1.type_is=Mock(side_effect = lambda n: n == &quot;OutputChunk&quot;)
    c_1.full_name=mock_file.name
    c_1.referencedBy = None
    c_1.commands=[
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.CodeCommand, &quot;typeid&quot;),
            text=&quot;|char| `code` *em* _em_&quot;,
            tangle=Mock(side_effect=tangle_method),
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.CodeCommand, &quot;typeid&quot;),
            text=&quot;\n&quot;,
            tangle=Mock(),
        ),
        Mock(
            typeid=pyweb.TypeId(), full_name=&quot;named chunk&quot;, seq=42
        ),
    ]
    # Tweak mocked command's name
    c_1.commands[0].name = &quot;c3...&quot;
    # Tweak mocked reference command's name
    c_1.commands[2].typeid.__set_name__(pyweb.ReferenceCommand, &quot;typeid&quot;)
    c_1.commands[2].name = &quot;named...&quot;

    c_2 = mock_chunk_instance(&quot;c3 has a long name&quot;, 3, (mock_file.name, 33))
    c_2.type_is=Mock(side_effect = lambda n: n == &quot;NamedChunk&quot;)
    c_2.def_names = [&quot;userid&quot;]
    c_2.referencedBy = c_1
    c_2.commands=[
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.CodeCommand, &quot;typeid&quot;),
            text=&quot;|char| `code` *em* _em_&quot;,
        ),
        Mock(
            typeid=pyweb.TypeId().__set_name__(pyweb.CodeCommand, &quot;typeid&quot;),
            text=&quot;\n&quot;,
            tangle=Mock(),
        ),
    ]

    return [c_0, c_1, c_2]

# TODO: Make this a fixture.
def mock_web() -&gt; pyweb.Web:
    &quot;&quot;&quot;Complex WEB for weaver testing.&quot;&quot;&quot;
    chunk_list = mock_chunks()
    web = Mock(
        name=&quot;mock web&quot;,
        web_path=Path(&quot;TestWeaver.w&quot;),
        chunks=chunk_list,
    )
    web.chunks[1].name=&quot;sample.out&quot;
    web.chunks[2].name=&quot;named...&quot;
    web.files = [web.chunks[1]]
    return web
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test Mock Chunk class (4)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</div>
<p>The default <tt class="docutils literal">Weaver</tt> is an <tt class="docutils literal">Emitter</tt> that uses templates to produce RST markup.</p>
<p class="rubric" id="unit-test-of-weaver-subclass-of-emitter-5">Unit Test of Weaver subclass of Emitter (5) =</p>
<pre class="code literal-block">
def test_rst_quote_rules():
    assert pyweb.rst_quote_rules(&quot;|char| `code` *em* _em_&quot;) == &quot;|char| `code` *em* _em_&quot;

def test_html_quote_rules():
    assert pyweb.html_quote_rules(&quot;a &amp; b &lt; c &gt; d&quot;) == r&quot;a &amp;amp; b &amp;lt; c &amp;gt; d&quot;

→ `expected RST output (6)`_

&#64;pytest.fixture
def web_rst_weaver(tmp_path):
    weaver = pyweb.Weaver(tmp_path)
    weaver.set_markup(&quot;rst&quot;)
    web = mock_web()
    return web, weaver

def test_weaver_functions_generic(tmp_path, web_rst_weaver):
    web, weaver = web_rst_weaver
    weaver.emit(web)
    output_path = tmp_path / &quot;TestWeaver.rst&quot;
    actual = output_path.read_text()
    assert expected_rst_output == actual
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Weaver subclass of Emitter (5)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</div>
<p class="rubric" id="expected-rst-output-6">expected RST output (6) =</p>
<pre class="code literal-block">
expected_rst_output = ('text with |char| untouched.\n'
     ':sample.out:\n'
     '    → `sample.out (1)`_\n'
     ':named chunk:\n'
     '    → ` ()`_\n'
     '\n'
     '\n'
     ':user_id_1:\n'
     '    → `named chunk (2)`_\n'
     '\n'
     ':user_id_2:\n'
     '    → `named chunk (2)`_\n'
     '\n'
     '\n'
    '..  _`sample.out (42)`:\n'
    '..  rubric:: sample.out (42) =\n'
    '..  code-block::\n'
    '    :class: code\n'
    '\n'
    '    |char| `code` *em* _em_\n'
    '    \n'
    '    → `named chunk (42)`_\n'
    '..\n'
    '\n'
    '..  container:: small\n'
    '\n'
    '    ∎ *sample.out (42)*.\n'
    '    \n'
    '\n'
    '\n'
    '..  _`c3 has a long name (3)`:\n'
    '..  rubric:: c3 has a long name (3) =\n'
    '..  code-block::\n'
    '    :class: code\n'
    '\n'
    '    |char| `code` *em* _em_\n'
    '    \n'
    '\n'
    '..\n'
    '\n'
    '..  container:: small\n'
    '\n'
    '    ∎ *c3 has a long name (3)*.\n'
    '    Used by     → `sample.out (42)`_.\n'
    '\n')
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>expected RST output (6)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-weaver-subclass-of-emitter-5">Unit Test of Weaver subclass of Emitter (5)</a>.</div>
<p>A significant fraction of the various subclasses of weaver are expansion of various template macros.
Testing the template macros looks deeply at the intermediate product (RST or LaTeX), something that may be more easily tested by the final <strong>docutils</strong>, <strong>Sphinx</strong>, or a LaTeX processor.</p>
<p>Because of the complexity of LaTeX, we will examine a few features of these template macros.</p>
<p class="rubric" id="unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7) =</p>
<pre class="code literal-block">
→ `expected tex output (8)`_
→ `expected tex minted output (9)`_

&#64;pytest.fixture
def mock_tiny_web():
    aFileChunk = mock_chunk_instance(&quot;File&quot;, 123, (&quot;sample.w&quot;, 456))
    aFileChunk.referencedBy = [ ]

    aChunk = mock_chunk_instance(&quot;Chunk&quot;, 314, (&quot;sample.w&quot;, 789))
    aChunk.style = &quot;python&quot;
    aChunk.type_is = Mock(side_effect=lambda n: n == &quot;OutputChunk&quot;)
    aChunk.referencedBy = [aFileChunk,]
    aChunk.references = [(aFileChunk.name, aFileChunk.seq)]

    web = Mock(chunks=[aChunk])
    return web

&#64;pytest.fixture
def weaver_instance(tmp_path):
    weaver = pyweb.Weaver(tmp_path)
    return weaver

def test_weaver_functions_latex(weaver_instance, mock_tiny_web):
    weaver_instance.set_markup(&quot;tex&quot;)

    quote_result = pyweb.latex_quote_rules(&quot;\\end{Verbatim}&quot;)
    assert &quot;\\end\\,{Verbatim}&quot; == quote_result

    weave_result = list(weaver_instance.generate_text(mock_tiny_web))
    assert expected_tex_output == weave_result

def test_weaver_functions_latex_minted(weaver_instance, mock_tiny_web):
    weaver_instance.set_markup(&quot;tex-minted&quot;)
    quote_result = pyweb.latex_minted_quote_rules(&quot;\\end{minted}&quot;)
    assert &quot;\\end\\,{minted}&quot; == quote_result

    weave_result = list(weaver_instance.generate_text(mock_tiny_web))
    assert expected_tex_minted_output == weave_result
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of LaTeX macros in Weaver (7)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</div>
<p class="rubric" id="expected-tex-output-8">expected tex output (8) =</p>
<pre class="code literal-block">
expected_tex_output = [
    '\n'
    '\\label{pyweb-314}\n'
    '\\begin{flushleft}\n'
    '\\textit{Code example Chunk (314)}\n'
    '\\begin{Verbatim}[commandchars=\\\\\\{\\},codes={\\catcode`$$=3\\catcode`^=7},frame=single]',
    '\n'
    '\\end{Verbatim}\n'
    '\\end{flushleft}\n'
]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>expected tex output (8)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7)</a>.</div>
<p class="rubric" id="expected-tex-minted-output-9">expected tex minted output (9) =</p>
<pre class="code literal-block">
expected_tex_minted_output = [
    '\n'
    '\\label{pyweb-314}\n'
    '\\textit{Code example Chunk (314)}\n'
    '\\begin{minted}{python}',
    '\n'
    '\\end{minted}\n'
]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>expected tex minted output (9)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7)</a>.</div>
<p>We'll examine a few features of the HTML templates.</p>
<p class="rubric" id="unit-test-of-html-macros-in-weaver-10">Unit Test of HTML macros in Weaver (10) =</p>
<pre class="code literal-block">
→ `expected html output (11)`_

def test_weaver_functions_html(weaver_instance, mock_tiny_web):
    weaver_instance.set_markup(&quot;html&quot;)

    quote_result = pyweb.html_quote_rules(&quot;a &lt; b &amp;&amp; c &gt; d&quot;)
    assert &quot;a &amp;lt; b &amp;amp;&amp;amp; c &amp;gt; d&quot; == quote_result

    weave_result = list(weaver_instance.generate_text(mock_tiny_web))
    assert expected_html_output == weave_result
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of HTML macros in Weaver (10)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</div>
<p class="rubric" id="expected-html-output-11">expected html output (11) =</p>
<pre class="code literal-block">
expected_html_output = [
    '\n'
    '&lt;a name=&quot;pyweb_314&quot;&gt;&lt;/a&gt;\n'
    &quot;&lt;!--line number ('sample.w', 789)--&gt;\n&quot;
    '&lt;p&gt;&lt;em&gt;Chunk (314)&lt;/em&gt; =&lt;/p&gt;\n'
    '&lt;pre&gt;&lt;code&gt;',
    '\n'
    '&lt;/code&gt;&lt;/pre&gt;\n'
    '&lt;p&gt;&amp;#8718; &lt;em&gt;Chunk (314)&lt;/em&gt;.\n'
    'Used by &amp;rarr;&lt;a href=&quot;#pyweb_&quot;&gt;&lt;em&gt; ()&lt;/em&gt;&lt;/a&gt;.\n'
    '&lt;/p&gt; \n'
]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>expected html output (11)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-html-macros-in-weaver-10">Unit Test of HTML macros in Weaver (10)</a>.</div>
<p>A Tangler emits the various named source files in proper format for the desired
compiler and language.</p>
<p class="rubric" id="unit-test-of-tangler-subclass-of-emitter-12">Unit Test of Tangler subclass of Emitter (12) =</p>
<pre class="code literal-block">
def test_tangler_should_codeBlock(tmp_path) -&gt; None:
    tangler = pyweb.Tangler(tmp_path)
    target = io.StringIO()
    tangler.codeBlock(target, &quot;Some&quot;)
    tangler.codeBlock(target, &quot; Code&quot;)
    tangler.codeBlock(target, &quot;\n&quot;)
    output = target.getvalue()
    assert &quot;Some Code\n&quot; == output

def test_tangler_should_indent(tmp_path) -&gt; None:
    tangler = pyweb.Tangler(tmp_path)
    target = io.StringIO()
    tangler.codeBlock(target, &quot;Begin\n&quot;)
    tangler.addIndent(4)
    tangler.codeBlock(target, &quot;More Code\n&quot;)
    tangler.clrIndent()
    tangler.codeBlock(target, &quot;End\n&quot;)
    output = target.getvalue()
    assert &quot;Begin\n    More Code\nEnd\n&quot; == output

def test_tangler_should_noindent(tmp_path) -&gt; None:
    tangler = pyweb.Tangler(tmp_path)
    target = io.StringIO()
    tangler.codeBlock(target, &quot;Begin&quot;)
    tangler.codeBlock(target, &quot;\n&quot;)
    tangler.setIndent(0)
    tangler.codeBlock(target, &quot;More Code&quot;)
    tangler.codeBlock(target, &quot;\n&quot;)
    tangler.clrIndent()
    tangler.codeBlock(target, &quot;End&quot;)
    tangler.codeBlock(target, &quot;\n&quot;)
    output = target.getvalue()
    assert &quot;Begin\nMore Code\nEnd\n&quot; == output
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Tangler subclass of Emitter (12)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</div>
<p>A TanglerMake uses a cheap hack to see if anything changed.
It creates a temporary file and then does a complete (slow, expensive) file difference check.
If the file is different, the old version is replaced with  the new version.
If the file content is the same, the old version is left intact with all of the operating system creation timestamps untouched.</p>
<p class="rubric" id="unit-test-of-tanglermake-subclass-of-emitter-13">Unit Test of TanglerMake subclass of Emitter (13) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def web_output_tangler(tmp_path):
    tangler = pyweb.TanglerMake()
    web = mock_web()
    tangler.output = tmp_path
    tangler.emit(web)
    return web, tmp_path / &quot;sample.out&quot;, tangler

def test_confirm_tanged_output(web_output_tangler) -&gt; None:
    web, output, tangler = web_output_tangler
    tangled = output.read_text()
    expected = (
        'Mocked Tangle Output\n'
    )
    assert expected == tangled


def test_same_should_leave(web_output_tangler) -&gt; None:
    web, output, tangler = web_output_tangler
    original_stat = output.stat()
    tangler.emit(web)
    assert os.path.samestat(original_stat, output.stat())
    assert original_stat.st_mtime == output.stat().st_mtime

def test_different_should_update(web_output_tangler) -&gt; None:
    web, output, tangler = web_output_tangler
    original_stat = output.stat()

    # Modify the web in some way to create a distinct value.
    def tangle_method(aTangler: pyweb.Tangler, target: TextIO) -&gt; None:
        aTangler.codeBlock(target, &quot;Updated Tangle Output\n&quot;)
    web.chunks[1].commands[0].tangle = Mock(side_effect=tangle_method)

    tangler.emit(web)

    assert not os.path.samestat(original_stat, output.stat())
    # Not **always** true...
    # Would require a short sleep to assure time stamps don't match.
    # assert original_stat.st_mtime != output.stat().st_mtime
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of TanglerMake subclass of Emitter (13)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</div>
</div>
<div class="section" id="chunk-tests">
<h2><a class="toc-backref" href="#toc-entry-4">Chunk Tests</a></h2>
<p>The <tt class="docutils literal">Chunk</tt> and <tt class="docutils literal">Command</tt> class hierarchies model the input document -- the web
of chunks that are used to produce the documentation and the source files.</p>
<p class="rubric" id="unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14) =</p>
<pre class="code literal-block">
→ `Unit Test of Chunk superclass (15)`_
→ `Unit Test of NamedChunk subclass (22)`_
→ `Unit Test of NamedChunk with no indent (25)`_
→ `Unit Test of OutputChunk subclass (28)`_
→ `Unit Test of NamedDocumentChunk subclass (31)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk class hierarchy (14)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p>In order to test the <tt class="docutils literal">Chunk</tt> superclass, we need several mock objects.
A <tt class="docutils literal">Chunk</tt> contains one or more <tt class="docutils literal">Command</tt> instances.
A <tt class="docutils literal">Chunk</tt> is a part of a <tt class="docutils literal">Web</tt>.
Also, a <tt class="docutils literal">Chunk</tt> is processed by a <tt class="docutils literal">Tangler</tt> or a <tt class="docutils literal">Weaver</tt>.
We'll need  mock objects for all of these relationships in which a <tt class="docutils literal">Chunk</tt> participates.</p>
<p>We'll replace Commands (and Web) with <tt class="docutils literal">Mock</tt> objects.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-15">Unit Test of Chunk superclass (15) =</p>
<pre class="code literal-block">
MockCommand = Mock(
    name=&quot;Command class&quot;,
    side_effect=lambda: Mock(
        name=&quot;Command instance&quot;,
        # text=&quot;&quot;,  # Only used for TextCommand.
        lineNumber=314,
        startswith=Mock(return_value=False)
    )
)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk superclass (15)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p>A <tt class="docutils literal">MockWeb</tt> contains a <tt class="docutils literal">Chunk</tt>.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-16">Unit Test of Chunk superclass (16) +=</p>
<pre class="code literal-block">
# Remove These...
def mock_web_instance() -&gt; Mock:
    web = Mock(
        name=&quot;Web instance&quot;,
        chunks=[],
        # Methods
        # fullNameFor=Mock(side_effect=lambda name: name),
        # fileXref=Mock(return_value={'file': [1,2,3]}),
        # chunkXref=Mock(return_value={'chunk': [4,5,6]}),
        # userNamesXref=Mock(return_value={'name': (7, [8,9,10])}),
        createUsedBy=Mock(),
        # weaveChunk=Mock(side_effect=lambda name, weaver: weaver.write(name)),
        # weave=Mock(return_value=None),
        # tangle=Mock(return_value=None),
        web_path=&quot;sample.input&quot;,
    )
    return web

MockWeb = Mock(
    name=&quot;Web class&quot;,
    side_effect=mock_web_instance,
)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk superclass (16)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p>A MockWeaver or MockTangler appear to process a <tt class="docutils literal">Chunk</tt>.
We can interrogate the <tt class="docutils literal">mock_calls</tt> to be sure the right things were done.</p>
<p>We need to permit <tt class="docutils literal">__enter__()</tt> and <tt class="docutils literal">__exit__()</tt>,
which leads to a multi-step instance.
The initial instance with <tt class="docutils literal">__enter__()</tt> that
returns the context manager instance.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-17">Unit Test of Chunk superclass (17) +=</p>
<pre class="code literal-block">
def mock_weaver_instance() -&gt; MagicMock:
    context = MagicMock(
        name=&quot;Weaver instance context&quot;,
        __exit__=Mock()
    )

    weaver = MagicMock(
        name=&quot;Weaver instance&quot;,
        quote=Mock(return_value=&quot;quoted&quot;),
        __enter__=Mock(return_value=context)
    )
    return weaver

MockWeaver = Mock(
    name=&quot;Weaver class&quot;,
    side_effect=mock_weaver_instance
)

def mock_tangler_instance() -&gt; MagicMock:
    context = MagicMock(
        name=&quot;Tangler instance context&quot;,
        reference_names=Mock(add=Mock()),
        __exit__=Mock()
    )

    tangler = MagicMock(
        name=&quot;Tangler instance&quot;,
        __enter__=Mock(return_value=context),
    )
    return tangler

MockTangler = Mock(
    name=&quot;Tangler class&quot;,
    side_effect=mock_tangler_instance
)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk superclass (17)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p>A <tt class="docutils literal">Chunk</tt> must be built, interrogated and then emitted.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18) +=</p>
<pre class="code literal-block">
&#64;pytest.fixture
def chunk_instance():
    return pyweb.Chunk()

→ `Unit Test of Chunk construction (19)`_
→ `Unit Test of Chunk interrogation (20)`_
→ `Unit Test of Chunk properties (21)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk superclass (18)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p>Can we build a Chunk?</p>
<p class="rubric" id="unit-test-of-chunk-construction-19">Unit Test of Chunk construction (19) =</p>
<pre class="code literal-block">
def test_append_command_should_work(chunk_instance) -&gt; None:
    cmd1 = MockCommand()
    chunk_instance.commands.append(cmd1)
    assert 1 == len(chunk_instance.commands)
    assert [cmd1] == chunk_instance.commands

    cmd2 = MockCommand()
    chunk_instance.commands.append(cmd2)
    assert 2 == len(chunk_instance.commands)
    assert [cmd1, cmd2] == chunk_instance.commands
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk construction (19)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a>.</div>
<p>Can we interrogate a Chunk?</p>
<p class="rubric" id="unit-test-of-chunk-interrogation-20">Unit Test of Chunk interrogation (20) =</p>
<pre class="code literal-block">
def test_lineNumber_should_work(chunk_instance) -&gt; None:
    cmd1 = MockCommand()
    chunk_instance.commands.append(cmd1)
    assert 314 == chunk_instance.commands[0].lineNumber
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk interrogation (20)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a>.</div>
<p>Can we emit a Chunk with a weaver or tangler?</p>
<p class="rubric" id="unit-test-of-chunk-properties-21">Unit Test of Chunk properties (21) =</p>
<pre class="code literal-block">
def test_chunk_properties(chunk_instance) -&gt; None:
    chunk_instance.name = &quot;some name&quot;
    web = mock_web()
    chunk_instance.web = Mock(return_value=web)

    chunk_instance.full_name
    web.resolve_name.assert_called_once_with(chunk_instance.name)
    assert chunk_instance.path is None
    assert chunk_instance.type_is('Chunk')
    assert not chunk_instance.type_is('OutputChunk')
    assert chunk_instance.referencedBy is None
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk properties (21)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a>.</div>
<p>The <tt class="docutils literal">NamedChunk</tt> is created by a <tt class="docutils literal">&#64;d</tt> command.
Since it's named, it appears in the Web's index.
Also, it is woven and tangled differently than anonymous chunks.</p>
<p class="rubric" id="unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def namedchunk_instance():
    chunk = pyweb.NamedChunk(options=[&quot;Some Name...&quot;])
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit test of named chunk xref (23)`_
→ `Unit test of named chunk properties (24)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of NamedChunk subclass (22)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p class="rubric" id="unit-test-of-named-chunk-xref-23">Unit test of named chunk xref (23) =</p>
<pre class="code literal-block">
def test_should_find_xref_words(namedchunk_instance) -&gt; None:
    assert 2 == len(namedchunk_instance.def_names)
    assert {&quot;index&quot;, &quot;terms&quot;} == set(namedchunk_instance.def_names)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of named chunk xref (23)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22)</a>.</div>
<p class="rubric" id="unit-test-of-named-chunk-properties-24">Unit test of named chunk properties (24) =</p>
<pre class="code literal-block">
def test_namedchunk_properties(namedchunk_instance) -&gt; None:
    web = mock_web()
    namedchunk_instance.web = Mock(return_value=web)
    namedchunk_instance.full_name
    web.resolve_name.assert_called_once_with(namedchunk_instance.name)
    assert namedchunk_instance.path is None
    assert namedchunk_instance.type_is(&quot;NamedChunk&quot;)
    assert not namedchunk_instance.type_is(&quot;OutputChunk&quot;)
    assert not namedchunk_instance.type_is(&quot;Chunk&quot;)
    assert namedchunk_instance.referencedBy is None
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of named chunk properties (24)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22)</a>.</div>
<p class="rubric" id="unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def namedchunk_noindent_instance():
    chunk = pyweb.NamedChunk(options=[&quot;-noindent&quot;, &quot;NoIndent Name...&quot;])
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit test of named chunk no-indent xref (26)`_
→ `Unit test of named chunk no-indent properties (27)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of NamedChunk with no indent (25)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p class="rubric" id="unit-test-of-named-chunk-no-indent-xref-26">Unit test of named chunk no-indent xref (26) =</p>
<pre class="code literal-block">
def test_should_find_xref_words(namedchunk_noindent_instance) -&gt; None:
    assert 2 == len(namedchunk_noindent_instance.def_names)
    assert {&quot;index&quot;, &quot;terms&quot;} == set(namedchunk_noindent_instance.def_names)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of named chunk no-indent xref (26)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25)</a>.</div>
<p class="rubric" id="unit-test-of-named-chunk-no-indent-properties-27">Unit test of named chunk no-indent properties (27) =</p>
<pre class="code literal-block">
def test_namedchunk_ni_properties(namedchunk_noindent_instance) -&gt; None:
    web = mock_web()
    namedchunk_noindent_instance.web = Mock(return_value=web)
    namedchunk_noindent_instance.full_name
    web.resolve_name.assert_called_once_with(namedchunk_noindent_instance.name)
    assert namedchunk_noindent_instance.path is None
    assert namedchunk_noindent_instance.type_is(&quot;NamedChunk&quot;)
    assert not namedchunk_noindent_instance.type_is(&quot;Chunk&quot;)
    assert namedchunk_noindent_instance.referencedBy is None
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of named chunk no-indent properties (27)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25)</a>.</div>
<p>An <tt class="docutils literal">OutputChunk</tt> is created by a <tt class="docutils literal">&#64;o</tt> command.
Since it's named, it appears in the Web's index.
Also, it is woven and tangled differently than anonymous chunks of text.
This defines the files of tangled code.</p>
<p class="rubric" id="unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def outputchunk_instance():
    chunk = pyweb.OutputChunk(options=[&quot;filename.out&quot;])
    chunk.comment_start = &quot;# &quot;
    chunk.comment_end = &quot;&quot;
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit Test output chunk xref (29)`_
→ `Unit Test output chunk properties (30)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of OutputChunk subclass (28)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p class="rubric" id="unit-test-output-chunk-xref-29">Unit Test output chunk xref (29) =</p>
<pre class="code literal-block">
def test_should_find_xref_words(outputchunk_instance) -&gt; None:
    assert 2 == len(outputchunk_instance.def_names)
    assert {&quot;index&quot;, &quot;terms&quot;} == set(outputchunk_instance.def_names)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test output chunk xref (29)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28)</a>.</div>
<p class="rubric" id="unit-test-output-chunk-properties-30">Unit Test output chunk properties (30) =</p>
<pre class="code literal-block">
def test_outputchunk_properties(outputchunk_instance) -&gt; None:
    web = mock_web()
    outputchunk_instance.web = Mock(return_value=web)
    assert outputchunk_instance.full_name is None
    web.resolve_name.assert_not_called()
    assert outputchunk_instance.path == Path(&quot;filename.out&quot;)
    assert outputchunk_instance.type_is(&quot;OutputChunk&quot;)
    assert not outputchunk_instance.type_is(&quot;Chunk&quot;)
    assert outputchunk_instance.referencedBy is None
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test output chunk properties (30)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28)</a>.</div>
<p>The <tt class="docutils literal">NamedDocumentChunk</tt> is a way to define substitutable text, similar to code, but it applies to document chunks.
It's not clear how useful this really is.</p>
<p class="rubric" id="unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def named_documentchunk_instance():
    chunk = pyweb.NamedDocumentChunk(&quot;Document Chunk Name...&quot;)
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit test named document chunk xref (32)`_
→ `Unit test named document chunk properties (33)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of NamedDocumentChunk subclass (31)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</div>
<p class="rubric" id="unit-test-named-document-chunk-xref-32">Unit test named document chunk xref (32) =</p>
<pre class="code literal-block">
def test_should_find_xref_words(named_documentchunk_instance) -&gt; None:
    assert 2 == len(named_documentchunk_instance.def_names)
    assert {&quot;index&quot;, &quot;terms&quot;} == set(named_documentchunk_instance.def_names)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test named document chunk xref (32)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31)</a>.</div>
<p class="rubric" id="unit-test-named-document-chunk-properties-33">Unit test named document chunk properties (33) =</p>
<pre class="code literal-block">
def test_nameddocument_chunk_properties(named_documentchunk_instance) -&gt; None:
    web = mock_web()
    named_documentchunk_instance.web = Mock(return_value=web)
    named_documentchunk_instance.full_name
    web.resolve_name.assert_called_once_with(named_documentchunk_instance.name)
    assert named_documentchunk_instance.path is None
    assert named_documentchunk_instance.type_is(&quot;NamedDocumentChunk&quot;)
    assert not named_documentchunk_instance.type_is(&quot;OutputChunk&quot;)
    assert named_documentchunk_instance.referencedBy is None
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test named document chunk properties (33)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31)</a>.</div>
</div>
<div class="section" id="chunk-references-tests">
<h2><a class="toc-backref" href="#toc-entry-5">Chunk References Tests</a></h2>
<p>A <tt class="docutils literal">Chunk</tt>'s &quot;referencedBy&quot; attribute is set by the <tt class="docutils literal">Web</tt> during the initialization processing.</p>
<p>The test fixture is this</p>
<pre class="literal-block">
&#64;d main &#64;{ &#64;&lt; parent &#64;&gt; &#64;}

&#64;d parent &#64;{ &#64;&lt; sub &#64;&gt; &#64;}

&#64;d sub &#64;{ something &#64;}
</pre>
<p>The <tt class="docutils literal">sub</tt> item is referenced by <tt class="docutils literal">parent</tt> which is referenced by <tt class="docutils literal">main</tt>.</p>
<p>There are two broad styles of references:</p>
<ul class="simple">
<li>The simple reference is <tt class="docutils literal">sub</tt> referenced by <tt class="docutils literal">parent</tt>.</li>
<li>The transitive references are <tt class="docutils literal">sub</tt> referenced by <tt class="docutils literal">parent</tt> which is referenced by <tt class="docutils literal">main</tt>.</li>
</ul>
<p class="rubric" id="unit-test-of-chunk-references-34">Unit Test of Chunk References (34) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def main_parent_sub_chunks():
    web = MockWeb()
    main = pyweb.NamedChunk(&quot;Main&quot;, 1)
    main.referencedBy = None
    main.web = Mock(return_value=web)
    parent = pyweb.NamedChunk(&quot;Parent&quot;, 2)
    parent.referencedBy = main
    parent.web = Mock(return_value=web)
    chunk = pyweb.NamedChunk(&quot;Sub&quot;, 3)
    chunk.referencedBy = parent
    chunk.web = Mock(return_value=web)
    return main, parent, chunk

→ `Unit test of simple references (35)`_
→ `Unit test of two-level transitive reference (36)`_
→ `Unit test of one-level transitive reference (37)`_
→ `Unit test of top-level transitive reference (38)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Chunk References (34)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p class="rubric" id="unit-test-of-simple-references-35">Unit test of simple references (35) =</p>
<pre class="code literal-block">
def test_simple(main_parent_sub_chunks) -&gt; None:
    main, parent, chunk = main_parent_sub_chunks
    assert chunk.referencedBy == parent
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of simple references (35)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</div>
<p class="rubric" id="unit-test-of-two-level-transitive-reference-36">Unit test of two-level transitive reference (36) =</p>
<pre class="code literal-block">
def test_transitive_sub_sub(main_parent_sub_chunks) -&gt; None:
    main, parent, chunk = main_parent_sub_chunks
    theList = chunk.transitive_referencedBy
    assert 2 == len(theList)
    assert parent == theList[0]
    assert main == theList[1]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of two-level transitive reference (36)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</div>
<p class="rubric" id="unit-test-of-one-level-transitive-reference-37">Unit test of one-level transitive reference (37) =</p>
<pre class="code literal-block">
def test_transitive_sub(main_parent_sub_chunks) -&gt; None:
    main, parent, chunk = main_parent_sub_chunks
    theList = parent.transitive_referencedBy
    assert 1 == len(theList)
    assert main == theList[0]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of one-level transitive reference (37)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</div>
<p class="rubric" id="unit-test-of-top-level-transitive-reference-38">Unit test of top-level transitive reference (38) =</p>
<pre class="code literal-block">
def test_transitive_top(main_parent_sub_chunks) -&gt; None:
    main, parent, chunk = main_parent_sub_chunks
    theList = main.transitive_referencedBy
    assert 0 == len(theList)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of top-level transitive reference (38)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</div>
</div>
<div class="section" id="command-tests">
<h2><a class="toc-backref" href="#toc-entry-6">Command Tests</a></h2>
<p>A <tt class="docutils literal">Chunk</tt> is a sequence of individual <tt class="docutils literal">Command</tt> instances.
The invidual commands include all of the <tt class="docutils literal">&#64;x</tt> commands,
plus the remaining blocks of text (or code.)</p>
<p class="rubric" id="unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39) =</p>
<pre class="code literal-block">
→ `Unit Test of Command superclass (40)`_
→ `Unit Test of TextCommand class to contain a document text block (41)`_
→ `Unit Test of CodeCommand class to contain a program source code block (44)`_
→ `Unit Test of XrefCommand superclass for all cross-reference commands (47)`_
→ `Unit Test of FileXrefCommand class for an output file cross-reference (48)`_
→ `Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)`_
→ `Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)`_
→ `Unit Test of ReferenceCommand class for chunk references (57)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Command class hierarchy (39)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p>This Command superclass is essentially an inteface definition; it has no real testable features.</p>
<p class="rubric" id="unit-test-of-command-superclass-40">Unit Test of Command superclass (40) =</p>
<pre class="code literal-block">
# No Tests
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Command superclass (40)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p>A <tt class="docutils literal">TextCommand</tt> object must be built from source text, interrogated, and emitted.
A <tt class="docutils literal">TextCommand</tt> should not (generally) be created in a <tt class="docutils literal">Chunk</tt>, it should
only be part of a <tt class="docutils literal">NamedChunk</tt> or <tt class="docutils literal">OutputChunk</tt>.</p>
<p class="rubric" id="unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def text_command_instances():
    cmd = pyweb.TextCommand(&quot;Some text &amp; words in the document\n    &quot;, (&quot;sample.w&quot;, 314))
    cmd2 = pyweb.TextCommand(&quot;No Indent\n&quot;, (&quot;sample.w&quot;, 271))
    return cmd, cmd2

→ `Unit test text command methods should work (42)`_
→ `Unit test text command tangle should error (43)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of TextCommand class to contain a document text block (41)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p class="rubric" id="unit-test-text-command-methods-should-work-42">Unit test text command methods should work (42) =</p>
<pre class="code literal-block">
def test_textcommand_methods(text_command_instances) -&gt; None:
    cmd, cmd2 = text_command_instances
    assert cmd.typeid.TextCommand
    assert (&quot;sample.w&quot;, 314) == cmd.location
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test text command methods should work (42)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41)</a>.</div>
<p class="rubric" id="unit-test-text-command-tangle-should-error-43">Unit test text command tangle should error (43) =</p>
<pre class="code literal-block">
def test_textcommamnd_tangle_should_error(text_command_instances) -&gt; None:
    cmd, cmd2 = text_command_instances
    tangler = MockTangler()
    with pytest.raises(pyweb.Error) as exc_info:
        cmd.tangle(tangler, sentinel.TARGET)
    assert exc_info.value.args == (
        &quot;attempt to tangle a text block ('sample.w', 314) 'Some text &amp; words in the [...]'&quot;,
    )
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test text command tangle should error (43)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41)</a>.</div>
<p>A <tt class="docutils literal">CodeCommand</tt> object is a <tt class="docutils literal">TextCommand</tt> with different processing when it is emitted.
It represents a block of code in a <tt class="docutils literal">NamedChunk</tt> or <tt class="docutils literal">OutputChunk</tt>.</p>
<p class="rubric" id="unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def code_command_instance():
    cmd = pyweb.CodeCommand(&quot;Some code in the document\n    &quot;, (&quot;sample.w&quot;, 314))
    return cmd

→ `Unit test code command methods should work (45)`_
→ `Unit test code command tangle should error (46)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of CodeCommand class to contain a program source code block (44)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p class="rubric" id="unit-test-code-command-methods-should-work-45">Unit test code command methods should work (45) =</p>
<pre class="code literal-block">
def test_codecommand_methods(code_command_instance) -&gt; None:
    assert code_command_instance.typeid.CodeCommand
    assert (&quot;sample.w&quot;, 314)== code_command_instance.location
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test code command methods should work (45)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44)</a>.</div>
<p class="rubric" id="unit-test-code-command-tangle-should-error-46">Unit test code command tangle should error (46) =</p>
<pre class="code literal-block">
def test_codecommand_tangle_should_work(code_command_instance) -&gt; None:
    tangler = MockTangler()
    code_command_instance.tangle(tangler, sentinel.TARGET)
    tangler.codeBlock.assert_called_once_with(sentinel.TARGET, 'Some code in the document\n    ')
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test code command tangle should error (46)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44)</a>.</div>
<p>An <tt class="docutils literal">XrefCommand</tt> class (if defined) would be abstract.
We could formalize this, but it seems easier to have a collection of <tt class="docutils literal">&#64;dataclass</tt> definitions with a  <tt class="docutils literal"><span class="pre">Union[...]</span></tt> type hint.</p>
<p class="rubric" id="unit-test-of-xrefcommand-superclass-for-all-cross-reference-commands-47">Unit Test of XrefCommand superclass for all cross-reference commands (47) =</p>
<pre class="code literal-block">
# No Tests
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of XrefCommand superclass for all cross-reference commands (47)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p>The <tt class="docutils literal">FileXrefCommand</tt> command is expanded by a weaver to a list of <tt class="docutils literal">&#64;o</tt> locations.</p>
<p class="rubric" id="unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def filexref_command_instance():
    web = Mock(files=sentinel.FILES)
    cmd = pyweb.FileXrefCommand((&quot;sample.w&quot;, 314))
    cmd.web = Mock(return_value=web)
    return cmd

→ `Unit test file xref command methods should work (49)`_
→ `Unit test file xref command tangle should error (50)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of FileXrefCommand class for an output file cross-reference (48)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p class="rubric" id="unit-test-file-xref-command-methods-should-work-49">Unit test file xref command methods should work (49) =</p>
<pre class="code literal-block">
def test_filexrefcommand_methods(filexref_command_instance) -&gt; None:
    assert filexref_command_instance.typeid.FileXrefCommand
    assert (&quot;sample.w&quot;, 314) == filexref_command_instance.location
    assert sentinel.FILES == filexref_command_instance.files
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test file xref command methods should work (49)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48)</a>.</div>
<p class="rubric" id="unit-test-file-xref-command-tangle-should-error-50">Unit test file xref command tangle should error (50) =</p>
<pre class="code literal-block">
def test_filexrefcommand_tangle_should_fail(filexref_command_instance) -&gt; None:
    tangler = MockTangler()
    with pytest.raises(pyweb.Error):
        filexref_command_instance.tangle(tangler, sentinel.TARGET)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test file xref command tangle should error (50)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48)</a>.</div>
<p>The <tt class="docutils literal">MacroXrefCommand</tt> command is expanded by a weaver to a list of all <tt class="docutils literal">&#64;d</tt> locations.</p>
<p class="rubric" id="unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def macroxref_command_instance():
    web = Mock(macros=sentinel.MACROS)
    cmd = pyweb.MacroXrefCommand((&quot;sample.w&quot;, 314))
    cmd.web = Mock(return_value=web)
    return cmd

→ `Unit test macro xref command methods should work (52)`_
→ `Unit test macro xref command tangle shuould fail (53)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p class="rubric" id="unit-test-macro-xref-command-methods-should-work-52">Unit test macro xref command methods should work (52) =</p>
<pre class="code literal-block">
def test_macroxrefcommand_methods(macroxref_command_instance) -&gt; None:
    assert macroxref_command_instance.typeid.MacroXrefCommand
    assert (&quot;sample.w&quot;, 314) == macroxref_command_instance.location
    assert sentinel.MACROS == macroxref_command_instance.macros
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test macro xref command methods should work (52)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</a>.</div>
<p class="rubric" id="unit-test-macro-xref-command-tangle-shuould-fail-53">Unit test macro xref command tangle shuould fail (53) =</p>
<pre class="code literal-block">
def test_macroxrefcommand_tangle_should_fail(macroxref_command_instance) -&gt; None:
    tangler = MockTangler()
    with pytest.raises(pyweb.Error):
        macroxref_command_instance.tangle(tangler, sentinel.TARGET)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test macro xref command tangle shuould fail (53)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</a>.</div>
<p>The <tt class="docutils literal">UserIdXrefCommand</tt> command is expanded by a weaver to a list of all <tt class="docutils literal">&#64;|</tt> names.</p>
<p class="rubric" id="unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def useridxref_command_instance():
    web = Mock(userids=sentinel.USERIDS)
    cmd = pyweb.UserIdXrefCommand((&quot;sample.w&quot;, 314))
    cmd.web = Mock(return_value=web)
    return cmd

→ `Unit test userid xref command methods should work (55)`_
→ `Unit test userid xref command tangle should fail (56)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p class="rubric" id="unit-test-userid-xref-command-methods-should-work-55">Unit test userid xref command methods should work (55) =</p>
<pre class="code literal-block">
def test_useridxref_command_methods(useridxref_command_instance) -&gt; None:
    assert useridxref_command_instance.typeid.UserIdXrefCommand
    assert (&quot;sample.w&quot;, 314) == useridxref_command_instance.location
    assert sentinel.USERIDS == useridxref_command_instance.userids
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test userid xref command methods should work (55)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</a>.</div>
<p class="rubric" id="unit-test-userid-xref-command-tangle-should-fail-56">Unit test userid xref command tangle should fail (56) =</p>
<pre class="code literal-block">
def test_useridxref_command_tangle_should_fail(useridxref_command_instance) -&gt; None:
    tangler = MockTangler()
    with pytest.raises(pyweb.Error):
        useridxref_command_instance.tangle(tangler, sentinel.TARGET)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test userid xref command tangle should fail (56)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</a>.</div>
<p>Instances of the <tt class="docutils literal">Reference</tt> command reflect <tt class="docutils literal">&#64;&lt; name &#64;&gt;</tt> locations in code.
These require a context when tangling.
The context helps provide the required indentation.
They can't be simply tangled, since the expand to code that may (transitively) have more references to more code.</p>
<p>The document here is a mock-up of the following</p>
<pre class="literal-block">
&#64;d name &#64;{ &#64;&lt;Some Name&#64;&gt; &#64;}

&#64;d Some Name &#64;{ code &#64;}
</pre>
<p>This is a single <tt class="docutils literal">Chunk</tt> with a reference to another <tt class="docutils literal">Chunk</tt>.</p>
<p>The <tt class="docutils literal">Web</tt> class <tt class="docutils literal">__post_init__</tt> sets the <tt class="docutils literal">references</tt> and <tt class="docutils literal">referencedBy</tt> attributes of each <tt class="docutils literal">Chunk</tt>.</p>
<p class="rubric" id="unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57) =</p>
<pre class="code literal-block">
→ `Unit Test reference command methods should work (58)`_
→ `Unit Test reference command tangle should work (59)`_

&#64;pytest.fixture
def reference_command_instance():
    cmd = pyweb.ReferenceCommand(&quot;Some Name&quot;, (&quot;sample.w&quot;, 314))
    chunk = mock_chunk_instance(&quot;name&quot;, 123, (&quot;sample.w&quot;, 456), commands=[cmd])
    referenced_chunk = Mock(seq=sentinel.SEQUENCE, references=1, referencedBy=chunk, commands=[Mock()])
    web = Mock(
        resolve_name=Mock(return_value=sentinel.FULL_NAME),
        resolve_chunk=Mock(return_value=[referenced_chunk])
    )
    cmd.web = Mock(return_value=web)
    return cmd
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of ReferenceCommand class for chunk references (57)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</div>
<p class="rubric" id="unit-test-reference-command-methods-should-work-58">Unit Test reference command methods should work (58) =</p>
<pre class="code literal-block">
def test_reference_command_methods(reference_command_instance) -&gt; None:
    assert reference_command_instance.typeid.ReferenceCommand
    assert (&quot;sample.w&quot;, 314) == reference_command_instance.location
    assert sentinel.FULL_NAME == reference_command_instance.full_name
    assert sentinel.SEQUENCE == reference_command_instance.seq
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test reference command methods should work (58)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57)</a>.</div>
<p class="rubric" id="unit-test-reference-command-tangle-should-work-59">Unit Test reference command tangle should work (59) =</p>
<pre class="code literal-block">
def test_reference_command_tangle_should_work(reference_command_instance) -&gt; None:
    tangler = MockTangler()
    reference_command_instance.tangle(tangler, sentinel.TARGET)
    web = reference_command_instance.web()
    web.resolve_chunk.assert_called_once_with(&quot;Some Name&quot;)
    tangler.reference_names.add.assert_called_once_with('Some Name')
    referenced_chunk = web.resolve_chunk(&quot;Some Name&quot;)[0]
    referenced_chunk.commands[0].tangle.assert_called_once_with(tangler, sentinel.TARGET)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test reference command tangle should work (59)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57)</a>.</div>
</div>
<div class="section" id="web-tests">
<h2><a class="toc-backref" href="#toc-entry-7">Web Tests</a></h2>
<p>We create a <tt class="docutils literal">Web</tt> instance with mocked <tt class="docutils literal">Chunks</tt> and mocked <tt class="docutils literal">Commands</tt>.
The point is to test the <tt class="docutils literal">Web</tt> features in isolation.
This is tricky because some state is recorded in the <tt class="docutils literal">Chunk</tt> instances.</p>
<p class="rubric" id="unit-test-of-web-class-60">Unit Test of Web class (60) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def web_instance():
    c1 = mock_chunk_instance(&quot;c1&quot;, 1, (&quot;sample.w&quot;, 11))
    c1.type_is = Mock(side_effect = lambda n: n == &quot;Chunk&quot;)
    c1.referencedBy = None
    c1.name = None

    c2 = mock_chunk_instance(&quot;c2&quot;, 2, (&quot;sample.w&quot;, 22))
    c2.type_is = Mock(side_effect = lambda n: n == &quot;OutputChunk&quot;)
    c2.commands = [Mock()]
    c2.commands[0].name = &quot;c3...&quot;
    c2.commands[0].typeid = Mock(ReferenceCommand=True, TextCommand=False, CodeCommand=False)
    c2.referencedBy = None

    c3 = mock_chunk_instance(&quot;c3 has a long name&quot;, 3, (&quot;sample.w&quot;, 33))
    c3.type_is = Mock(side_effect = lambda n: n == &quot;NamedChunk&quot;)
    c3.referencedBy = None
    c3.def_names = [&quot;userid&quot;]

    raw_chunks = [c1, c2, c3]
    web = pyweb.Web(raw_chunks)
    return web

→ `Unit test web name resolution (61)`_
→ `Unit test web iteration over chunks (62)`_
→ `Unit test web tangle when valid (63)`_
→ `Unit test web weave when valid (64)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Web class (60)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p class="rubric" id="unit-test-web-name-resolution-61">Unit test web name resolution (61) =</p>
<pre class="code literal-block">
def test_web_name_resolution(web_instance) -&gt; None:
    assert web_instance.resolve_name(&quot;c1&quot;) == &quot;c1&quot;
    assert web_instance.resolve_chunk(&quot;c2&quot;) == [web_instance.chunks[1]]
    assert web_instance.resolve_name(&quot;c1...&quot;) == &quot;c1&quot;
    assert web_instance.resolve_name(&quot;c3...&quot;) == &quot;c3 has a long name&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test web name resolution (61)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</div>
<p class="rubric" id="unit-test-web-iteration-over-chunks-62">Unit test web iteration over chunks (62) =</p>
<pre class="code literal-block">
def test_chunks_should_iterate(web_instance) -&gt; None:
    web = web_instance
    c1, c2, c3 = web_instance.chunks
    assert [c2] == list(web.file_iter())
    assert [c3] == list(web.macro_iter())
    assert [SimpleNamespace(def_name=&quot;userid&quot;, chunk=c3)] == list(web.userid_iter())
    assert [c2] == web.files
    assert [
            SimpleNamespace(name=&quot;c2&quot;, full_name=&quot;c2&quot;, seq=1, def_list=[c2]),
            SimpleNamespace(name=&quot;c3 has a long name&quot;, full_name=&quot;c3 has a long name&quot;, seq=2, def_list=[c3])
        ] == web.macros
    assert [SimpleNamespace(userid='userid', ref_list=[c3])] == web.userids
    assert [c2] == web.no_reference()
    assert [] == web.multi_reference()
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test web iteration over chunks (62)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</div>
<p>This exercises the entire interface used by tangling.
All details are pushed down to <tt class="docutils literal">`command.tangle()</tt> methods for each command in each chunk.</p>
<p class="rubric" id="unit-test-web-tangle-when-valid-63">Unit test web tangle when valid (63) =</p>
<pre class="code literal-block">
def test_valid_web_should_tangle(web_instance) -&gt; None:
    web = web_instance
    c1, c2, c3 = web_instance.chunks
    assert [c2], web.files
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test web tangle when valid (63)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</div>
<p>This the entire interface used by weaving is the <tt class="docutils literal">web.chunks</tt> attribute, which is implicitly tested in several places.
All chunk-specific details are pushed down to unique processing based on <tt class="docutils literal">chunk.type_is</tt>.</p>
<p class="rubric" id="unit-test-web-weave-when-valid-64">Unit test web weave when valid (64) =</p>
<pre class="code literal-block">
# No tests
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test web weave when valid (64)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</div>
</div>
<div class="section" id="webreader-tests">
<h2><a class="toc-backref" href="#toc-entry-8">WebReader Tests</a></h2>
<p>Generally, this is tested separately through the functional tests.
Those tests each present source files to be processed by the
WebReader.</p>
<p>The <tt class="docutils literal">WebReader</tt> is poorly designed for unit testing.
The various chunk and command classes are part of the <tt class="docutils literal">WebReader</tt>, and
new classes cannot be injected gracefully.</p>
<p>Exacerbating this are two special cases: the <tt class="docutils literal">&#64;&#64;</tt> and <tt class="docutils literal">&#64;(expr&#64;)</tt> constructs
are evaluated immediately, and don't create commands.</p>
<p class="rubric" id="unit-test-of-webreader-class-65">Unit Test of WebReader class (65) =</p>
<pre class="code literal-block">
# Tested via functional tests
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of WebReader class (65)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p>Some lower-level units: specifically the tokenizer and the option parser.</p>
<p class="rubric" id="unit-test-of-webreader-class-66">Unit Test of WebReader class (66) +=</p>
<pre class="code literal-block">
&#64;pytest.fixture
def tokenizer():
    input = io.StringIO(&quot;&#64;&#64; word &#64;{ &#64;[ &#64;&lt; &#64;&gt;\n&#64;] &#64;} &#64;i &#64;| &#64;m &#64;f &#64;u &#64;( &#64;)\n&quot;)
    tokenizer = pyweb.Tokenizer(input)
    return tokenizer

def test_should_split_tokens(tokenizer) -&gt; None:
    tokens = list(tokenizer)
    assert len(tokens) == 28
    assert tokens == ['&#64;&#64;', ' word ', '&#64;{', ' ', '&#64;[', ' ', '&#64;&lt;', ' ',
    '&#64;&gt;', '\n', '&#64;]', ' ', '&#64;}', ' ', '&#64;i', ' ', '&#64;|', ' ', '&#64;m', ' ',
    '&#64;f', ' ', '&#64;u', ' ', '&#64;(', ' ', '&#64;)', '\n']
    assert tokenizer.lineNumber == 2
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of WebReader class (66)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p class="rubric" id="unit-test-of-webreader-class-67">Unit Test of WebReader class (67) +=</p>
<pre class="code literal-block">
def test_output_chunk_with_options_should_parse() -&gt; None:
    text1 = &quot; -start /* -end */ -noweave something.css &quot;
    chunk1 = pyweb.OutputChunk(options=shlex.split(text1))
    assert asdict(chunk1) == {
        'commands': [],
        'comment_end': '',
        'comment_start': '# ',
        'def_names': [],
        'indent': None,
        'initial': False,
        'logger': chunk1.logger,
        'name': 'something.css',
        'options': ['-start', '/*', '-end', '*/', '-noweave', 'something.css'],
        'referencedBy': None,
        'references': 0,
        'seq': None,
        'style': None,
        'weave': False,
        'web': None}

def test_output_chunk_without_options_should_parse() -&gt; None:
    text2 = &quot; something.py &quot;
    chunk2 = pyweb.OutputChunk(options=shlex.split(text2))
    assert asdict(chunk2) == {
        'commands': [],
        'comment_end': '',
        'comment_start': '# ',
        'def_names': [],
        'indent': None,
        'initial': False,
        'logger': chunk2.logger,
        'name': 'something.py',
        'options': ['something.py'],
        'referencedBy': None,
        'references': 0,
        'seq': None,
        'style': None,
        'weave': True,
        'web': None}

def test_namedchunk_with_options_should_parse() -&gt; None:
    text1 = &quot; -indent the name of test1 chunk... &quot;
    chunk1 = pyweb.NamedChunk(options=shlex.split(text1))
    assert asdict(chunk1) == {
        'commands': [],
        'comment_end': None,
        'comment_start': None,
        'def_names': [],
        'indent': None,
        'initial': False,
        'logger': chunk1.logger,
        'name': 'the name of test1 chunk...',
        'options': ['-indent', 'the', 'name', 'of', 'test1', 'chunk...'],
        'referencedBy': None,
        'references': 0,
        'seq': None,
        'style': None,
        'weave': True,
        'web': None}

def test_namedchunk_without_options_should_parse() -&gt; None:
    text2 = &quot; the name of test2 chunk... &quot;
    chunk2 = pyweb.NamedChunk(options=shlex.split(text2))
    assert asdict(chunk2) == {
        'commands': [],
        'comment_end': None,
        'comment_start': None,
        'def_names': [],
        'indent': None,
        'initial': False,
        'logger': chunk2.logger,
        'name': 'the name of test2 chunk...',
        'options': ['the', 'name', 'of', 'test2', 'chunk...'],
        'referencedBy': None,
        'references': 0,
        'seq': None,
        'style': None,
        'weave': True,
        'web': None}
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of WebReader class (67)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p>Testing the <tt class="docutils literal">&#64;&#64;</tt> case and one of the <tt class="docutils literal">&#64;(expr&#64;)</tt> cases.
Need to test all the available variables: <tt class="docutils literal">os.path</tt>, <tt class="docutils literal">os.getcwd</tt>, <tt class="docutils literal">os.name</tt>, <tt class="docutils literal">time</tt>, <tt class="docutils literal">datetime</tt>, <tt class="docutils literal">platform</tt>,
<tt class="docutils literal">theWebReader</tt>, <tt class="docutils literal">theFile</tt>, <tt class="docutils literal">thisApplication</tt>, <tt class="docutils literal">version</tt>, <tt class="docutils literal">theLocation</tt>.</p>
<p>Note the escape processing has a lot of <tt class="docutils literal">&#64;</tt> characters in it.</p>
<p class="rubric" id="unit-test-of-webreader-class-68">Unit Test of WebReader class (68) +=</p>
<pre class="code literal-block">
ex1 = (&quot;Escape: &#64;&#64; Example&quot;, &quot;Escape: &#64; Example&quot;)
ex2 = (&quot;Filename: &#64;(theFile&#64;)&quot;, &quot;Filename: sample.w&quot;)

&#64;pytest.fixture(params=(ex1, ex2))
def chunks_text(request) -&gt; tuple[list[pyweb.Chunk], str]:
    input, expected = request.param
    reader = pyweb.WebReader()
    chunks = reader.load(Path(&quot;sample.w&quot;), io.StringIO(input))
    return chunks, expected

def test_web_reader_builds_escape_chunk(chunks_text):
    chunks, expected = chunks_text
    assert len(chunks) == 1
    assert len(chunks[0].commands) == 1
    assert chunks[0].commands[0].text == expected
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of WebReader class (68)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
</div>
<div class="section" id="action-tests">
<h2><a class="toc-backref" href="#toc-entry-9">Action Tests</a></h2>
<p>Each <tt class="docutils literal">Action</tt> class is tested separately.
This requires a aequence of some mocks.
The behaviors include loading, tangling, weaving.</p>
<p class="rubric" id="unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69) =</p>
<pre class="code literal-block">
→ `Unit test of Action Sequence class (70)`_
→ `Unit test of LoadAction class (76)`_
→ `Unit test of TangleAction class (74)`_
→ `Unit test of WeaverAction class (72)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Action class hierarchy (69)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p><strong>TODO:</strong> Replace with Mock</p>
<p class="rubric" id="unit-test-of-action-sequence-class-70">Unit test of Action Sequence class (70) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def action_sequence_instance():
    a1 = MagicMock(name=&quot;Action1&quot;)
    a2 = MagicMock(name=&quot;Action2&quot;)
    action = pyweb.ActionSequence(&quot;TwoSteps&quot;, [a1, a2])
    action.web = mock_web()
    return action

→ `Unit test of action sequence (71)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of Action Sequence class (70)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</div>
<p class="rubric" id="unit-test-of-action-sequence-71">Unit test of action sequence (71) =</p>
<pre class="code literal-block">
def test_action_sequence_execute_both(action_sequence_instance) -&gt; None:
    action_sequence_instance(sentinel.OPTIONS)
    action_sequence_instance.opSequence[0].assert_called_once_with(sentinel.OPTIONS)
    action_sequence_instance.opSequence[1].assert_called_once_with(sentinel.OPTIONS)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of action sequence (71)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-sequence-class-70">Unit test of Action Sequence class (70)</a>.</div>
<p class="rubric" id="unit-test-of-weaveraction-class-72">Unit test of WeaverAction class (72) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def action_weave_instance(tmp_path):
    action = pyweb.WeaveAction()
    web = mock_web()
    weaver = MockWeaver()
    options = argparse.Namespace(
        theWeaver=weaver,
        output=tmp_path,
        web=web,
        weaver='rst',
    )
    return action, options

→ `Unit test WeaveAction should call Weaver (73)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of WeaverAction class (72)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</div>
<p class="rubric" id="unit-test-weaveaction-should-call-weaver-73">Unit test WeaveAction should call Weaver (73) =</p>
<pre class="code literal-block">
def test_weave_action(action_weave_instance) -&gt; None:
    action, options = action_weave_instance
    action(options)
    options.theWeaver.emit.assert_called_once_with(options.web)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test WeaveAction should call Weaver (73)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-weaveraction-class-72">Unit test of WeaverAction class (72)</a>.</div>
<p class="rubric" id="unit-test-of-tangleaction-class-74">Unit test of TangleAction class (74) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def action_tangle_instance(tmp_path):
    action = pyweb.TangleAction()
    web = mock_web()
    tangler = MockTangler()
    options = argparse.Namespace(
        theTangler=tangler,
        output=tmp_path,
        tangler_line_numbers=False,
        web=web,
    )
    return action, options

→ `Unit test TangleAction should call Tangler (75)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of TangleAction class (74)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</div>
<p class="rubric" id="unit-test-tangleaction-should-call-tangler-75">Unit test TangleAction should call Tangler (75) =</p>
<pre class="code literal-block">
def test_tangle_action(action_tangle_instance) -&gt; None:
    action, options = action_tangle_instance
    action(options)
    options.theTangler.emit.assert_called_once_with(options.web)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test TangleAction should call Tangler (75)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-tangleaction-class-74">Unit test of TangleAction class (74)</a>.</div>
<p>The mocked <tt class="docutils literal">WebReader</tt> must provide an <tt class="docutils literal">errors</tt> property to the <tt class="docutils literal">LoadAction</tt> instance.</p>
<p class="rubric" id="unit-test-of-loadaction-class-76">Unit test of LoadAction class (76) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def action_loader_instance(tmp_path):
    action = pyweb.LoadAction()
    web = MockWeb()
    webReader = Mock(
            name=&quot;WebReader&quot;,
            errors=0,
            load=Mock(return_value=[])
        )
    options = argparse.Namespace(
        webReader=webReader,
        source_path=tmp_path,
        command=&quot;&#64;&quot;,
        permitList=[],
        output=tmp_path,
    )
    return action, options

→ `Unit test LoadAction should call WebReader (77)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test of LoadAction class (76)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</div>
<p class="rubric" id="unit-test-loadaction-should-call-webreader-77">Unit test LoadAction should call WebReader (77) =</p>
<pre class="code literal-block">
def test_loader_action(action_loader_instance) -&gt; None:
    action, options = action_loader_instance
    action(options)
    options.webReader.load.assert_called_once_with(options.source_path)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit test LoadAction should call WebReader (77)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-loadaction-class-76">Unit test of LoadAction class (76)</a>.</div>
</div>
<div class="section" id="application-tests">
<h2><a class="toc-backref" href="#toc-entry-10">Application Tests</a></h2>
<p>As with testing WebReader, this requires extensive mocking.
It's easier to simply run the various use cases.</p>
<p><strong>TODO:</strong> Test Application class</p>
<p class="rubric" id="unit-test-of-application-class-78">Unit Test of Application class (78) =</p>
<pre class="code literal-block">
# TODO Test Application class
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test of Application class (78)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
</div>
<div class="section" id="overheads-and-main-script">
<h2><a class="toc-backref" href="#toc-entry-11">Overheads and Main Script</a></h2>
<p>The boilerplate code for unit testing is the following.</p>
<p class="rubric" id="unit-test-overheads-imports-etc-79">Unit Test overheads: imports, etc. (79) =</p>
<pre class="code literal-block">
&quot;&quot;&quot;Unit tests.&quot;&quot;&quot;
import argparse
from dataclasses import asdict
import io
import logging
import os
from pathlib import Path
import re
import shlex
import string
import sys
import textwrap
import time
from types import SimpleNamespace
from typing import Any, TextIO
from unittest.mock import Mock, call, MagicMock, sentinel
import warnings

import pytest

import pyweb
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test overheads: imports, etc. (79)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
<p>One more overhead is a function to cleanup output files.</p>
<p class="rubric" id="unit-test-overheads-imports-etc-80">Unit Test overheads: imports, etc. (80) +=</p>
<pre class="code literal-block">
def rstrip_lines(source: str) -&gt; list[str]:
    return list(l.rstrip() for l in source.splitlines())
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Unit Test overheads: imports, etc. (80)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</div>
</div>
</div>
<div class="section" id="functional-testing">
<h1><a class="toc-backref" href="#toc-entry-12">Functional Testing</a></h1>
<!-- test/func.w -->
<p>There are three broad areas of functional testing.</p>
<ul class="simple">
<li><a class="reference internal" href="#tests-for-loading">Tests for Loading</a></li>
<li><a class="reference internal" href="#tests-for-tangling">Tests for Tangling</a></li>
<li><a class="reference internal" href="#tests-for-weaving">Tests for Weaving</a></li>
</ul>
<p>Because of some overlaps in fixture definition, there is also a <tt class="docutils literal">conftest.py</tt> file that contains the shared test fixtures.</p>
<div class="section" id="shared-fixtures">
<h2><a class="toc-backref" href="#toc-entry-13">Shared Fixtures</a></h2>
<p class="rubric" id="tests-conftest-py-81">tests/conftest.py (81) =</p>
<pre class="code literal-block">
import io
from pathlib import Path
from typing import TextIO
import pytest
import pyweb

→ `Fixture for Source, WebReader, and Path (82)`_

→ `Fixture for Source, WebReader, Path, with an Include (83)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>tests/conftest.py (81)</em>.</div>
<p>These fixtures require a &quot;marker&quot; set in each test that uses them.
The marker provides needed parameter values.</p>
<p>Many of the parsing test cases have a common setup shown in this fixture.</p>
<p class="rubric" id="fixture-for-source-webreader-and-path-82">Fixture for Source, WebReader, and Path (82) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def source_path(request, tmp_path) -&gt; [TextIO, pyweb.WebReader, Path]:
    marker = request.node.get_closest_marker(&quot;text_name&quot;)
    text, name = marker.args
    source = io.StringIO(text)
    path = tmp_path / name
    return source, path
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Fixture for Source, WebReader, and Path (82)</em>.
Used by     → <a class="reference internal" href="#tests-conftest-py-81">tests/conftest.py (81)</a>.</div>
<p>Some of the more complex cases inject an Include file.
This requires a somewhat more complicated fixture.</p>
<p class="rubric" id="fixture-for-source-webreader-path-with-an-include-83">Fixture for Source, WebReader, Path, with an Include (83) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def source_path_incl(request, tmp_path) -&gt; [TextIO, pyweb.WebReader, Path]:
    marker = request.node.get_closest_marker(&quot;text_name_incl&quot;)
    text, name, incl_text, incl_name = marker.args
    include_path = tmp_path / incl_name
    include_path.write_text(incl_text)
    source = io.StringIO(text)
    path = tmp_path / name
    return source, path
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Fixture for Source, WebReader, Path, with an Include (83)</em>.
Used by     → <a class="reference internal" href="#tests-conftest-py-81">tests/conftest.py (81)</a>.</div>
<p>Additionally, a <tt class="docutils literal">pytest.ini</tt> is also required to register the marks used to provide test parameters to a fixture.
This also sets a logging format to assure the log messages have the expected format.</p>
<p class="rubric" id="pytest-ini-84">pytest.ini (84) =</p>
<pre class="code literal-block">
[pytest]
markers =
    text_name: a blob of text, the path name
    text_name_incl: a blob of text, a path, a blob of include text, the include path
log_format = %(levelname)s:%(name)s:%(message)s
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>pytest.ini (84)</em>.</div>
</div>
<div class="section" id="tests-for-loading">
<h2><a class="toc-backref" href="#toc-entry-14">Tests for Loading</a></h2>
<p>We need to be able to load a web from one or more source files.</p>
<p class="rubric" id="tests-test-loader-py-85">tests/test_loader.py (85) =</p>
<pre class="code literal-block">
→ `Load Test overheads: imports, etc. (90)`_

→ `Load Test error handling with a few common syntax errors (86)`_

→ `Load Test include processing with syntax errors (88)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>tests/test_loader.py (85)</em>.</div>
<p>There are a lot of specific parsing exceptions which can be thrown.
We'll cover most of the cases with a quick check for a failure to  find an expected next token.</p>
<p class="rubric" id="load-test-error-handling-with-a-few-common-syntax-errors-86">Load Test error handling with a few common syntax errors (86) =</p>
<pre class="code literal-block">
→ `Sample Document 1 with correct and incorrect syntax (87)`_

&#64;pytest.mark.text_name(test1_w, &quot;test1.w&quot;)
def test_error_should_count_1(source_path, caplog):
    source, file_path = source_path
    rdr = pyweb.WebReader()

    with caplog.at_level(level='WARN', logger='WebReader') as log_capture:
        chunks = rdr.load(file_path, source)
    assert 3 == rdr.errors
    assert caplog.text.splitlines() == [
        &quot;ERROR:WebReader:At ('test1.w', 8): expected {'&#64;{'}, found '&#64;o'&quot;,
        &quot;ERROR:WebReader:Extra '&#64;{' (possibly missing chunk name) near ('test1.w', 9)&quot;,
        &quot;ERROR:WebReader:Extra '&#64;{' (possibly missing chunk name) near ('test1.w', 9)&quot;
    ]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Load Test error handling with a few common syntax errors (86)</em>.
Used by     → <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>.</div>
<p class="rubric" id="sample-document-1-with-correct-and-incorrect-syntax-87">Sample Document 1 with correct and incorrect syntax (87) =</p>
<pre class="code literal-block">
test1_w = &quot;&quot;&quot;Some anonymous chunk
&#64;o test1.tmp
&#64;{&#64;&lt;part1&#64;&gt;
&#64;&lt;part2&#64;&gt;
&#64;}&#64;&#64;
&#64;d part1 &#64;{This is part 1.&#64;}
Okay, now for an error.
&#64;o show how &#64;o commands work
&#64;{ &#64;{ &#64;] &#64;]
&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Sample Document 1 with correct and incorrect syntax (87)</em>.
Used by     → <a class="reference internal" href="#load-test-error-handling-with-a-few-common-syntax-errors-86">Load Test error handling with a few common syntax errors (86)</a>.</div>
<p>All of the parsing exceptions should be correctly identified with any included file.
We'll cover most of the cases with a quick check for a failure to find an expected next token.</p>
<p>In order to test the include file processing, we have to actually create a temporary file.
It's hard to mock the include processing, since it's a nested instance of the tokenizer.</p>
<p class="rubric" id="load-test-include-processing-with-syntax-errors-88">Load Test include processing with syntax errors (88) =</p>
<pre class="code literal-block">
→ `Sample Document 8 and the file it includes (89)`_

&#64;pytest.mark.text_name_incl(test8_w, &quot;test8.w&quot;, test8_inc_w, 'test8_inc.w')
def test_error_should_count_2(caplog, tmp_path, source_path_incl) -&gt; None:
    source, file_path = source_path_incl
    rdr = pyweb.WebReader()
    with caplog.at_level(level='WARN', logger='WebReader') as log_capture:
        chunks = rdr.load(file_path, source)
    assert 1 == rdr.errors
    assert caplog.text.splitlines() == [
        &quot;ERROR:WebReader:At ('test8_inc.w', 4): end of input, {'&#64;{', '&#64;['} not found&quot;,
        &quot;ERROR:WebReader:Errors in included file 'test8_inc.w', output is incomplete.&quot;
    ]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Load Test include processing with syntax errors (88)</em>.
Used by     → <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>.</div>
<p>The sample document must reference the correct name that will be given to the included document by <tt class="docutils literal">setUp</tt>.</p>
<p class="rubric" id="sample-document-8-and-the-file-it-includes-89">Sample Document 8 and the file it includes (89) =</p>
<pre class="code literal-block">
test8_w = &quot;&quot;&quot;Some anonymous chunk.
&#64;d title &#64;[the title of this document, defined with &#64;&#64;[ and &#64;&#64;]&#64;]
A reference to &#64;&lt;title&#64;&gt;.
&#64;i test8_inc.w
A final anonymous chunk from test8.w
&quot;&quot;&quot;

test8_inc_w=&quot;&quot;&quot;A chunk from test8a.w
And now for an error - incorrect syntax in an included file!
&#64;d yap
&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Sample Document 8 and the file it includes (89)</em>.
Used by     → <a class="reference internal" href="#load-test-include-processing-with-syntax-errors-88">Load Test include processing with syntax errors (88)</a>.</div>
<p>The overheads for a Python test.</p>
<p class="rubric" id="load-test-overheads-imports-etc-90">Load Test overheads: imports, etc. (90) =</p>
<pre class="code literal-block">
&quot;&quot;&quot;Loader and parsing tests.&quot;&quot;&quot;
import io
import logging
import logging.handlers
import os
from pathlib import Path
import string
import sys
from textwrap import dedent
import types
from typing import TextIO

import pytest

import pyweb
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Load Test overheads: imports, etc. (90)</em>.
Used by     → <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>.</div>
</div>
<div class="section" id="tests-for-tangling">
<h2><a class="toc-backref" href="#toc-entry-15">Tests for Tangling</a></h2>
<p>We need to be able to tangle a web.</p>
<p class="rubric" id="tests-test-tangler-py-91">tests/test_tangler.py (91) =</p>
<pre class="code literal-block">
→ `Tangle Test overheads: imports, etc. (99)`_

→ `Tangle Test semantic errors 2-5 (94)`_

→ `Tangle Test fixture to refactor common setup (92)`_
→ `Tangle Test function to execute cases (93)`_

→ `Tangle Test semantic error 6 (95)`_
→ `Tangle Test include example 7 (97)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>tests/test_tangler.py (91)</em>.</div>
<p>Tangling test cases have a common setup and teardown shown in this fixture.
Since tangling must produce a file, it's helpful to remove the file that gets created.
The essential test case is to load and attempt to tangle, checking the exceptions raised.</p>
<p>Since these test cases are all very similar, we can use a parameterized fixture to execute a single test function repeatedly.</p>
<p class="rubric" id="tangle-test-fixture-to-refactor-common-setup-92">Tangle Test fixture to refactor common setup (92) =</p>
<pre class="code literal-block">
tangle_cases = [
    (test2_w, &quot;test2.w&quot;, &quot;Attempt to tangle an undefined Chunk, 'part2'&quot;),
    (test3_w, &quot;test3.w&quot;, &quot;Illegal tangling of a cross reference command.&quot;),
    (test4_w, &quot;test4.w&quot;, &quot;No full name for 'part1...'&quot;),
    (test5_w, &quot;test5.w&quot;, &quot;Ambiguous abbreviation 'part1...', matches ['part1a', 'part1b']&quot;),
]

&#64;pytest.fixture(params=tangle_cases)
def source_reader_path_tangler_error(request, tmp_path) -&gt; [TextIO, pyweb.WebReader, Path, pyweb.Tangler, str]:
    text, name, error = request.param
    source = io.StringIO(text)
    rdr = pyweb.WebReader()
    path = tmp_path / name
    tangler = pyweb.Tangler(tmp_path)
    yield source, rdr, path, tangler, error
    for output in tmp_path.glob(&quot;*.tmp&quot;):
        output.unlink()
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Tangle Test fixture to refactor common setup (92)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</div>
<p class="rubric" id="tangle-test-function-to-execute-cases-93">Tangle Test function to execute cases (93) =</p>
<pre class="code literal-block">
def test_tangle_and_check_exception(source_reader_path_tangler_error) -&gt; None:
    source, rdr, file_path, tangler, exception_text = source_reader_path_tangler_error

    with pytest.raises(pyweb.Error) as exc_info:
        chunks = rdr.load(file_path, source)
        web = pyweb.Web(chunks)
        tangler.emit(web)
        assert False, &quot;Should not tangle&quot;
    assert exception_text == exc_info.value.args[0]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Tangle Test function to execute cases (93)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</div>
<p class="rubric" id="tangle-test-semantic-errors-2-5-94">Tangle Test semantic errors 2-5 (94) =</p>
<pre class="code literal-block">
test2_w = &quot;&quot;&quot;Some anonymous chunk
&#64;o test2.tmp
&#64;{&#64;&lt;part1&#64;&gt;
&#64;&lt;part2&#64;&gt;
&#64;}&#64;&#64;
&#64;d part1 &#64;{This is part 1.&#64;}
Okay, now for some errors: no part2!
&quot;&quot;&quot;

test3_w = &quot;&quot;&quot;Some anonymous chunk
&#64;o test3.tmp
&#64;{&#64;&lt;part1&#64;&gt;
&#64;&lt;part2&#64;&gt;
&#64;}&#64;&#64;
&#64;d part1 &#64;{This is part 1.&#64;}
&#64;d part2 &#64;{This is part 2, with an illegal: &#64;f.&#64;}
Okay, now for some errors: attempt to tangle a cross-reference!
&quot;&quot;&quot;

test4_w = &quot;&quot;&quot;Some anonymous chunk
&#64;o test4.tmp
&#64;{&#64;&lt;part1...&#64;&gt;
&#64;&lt;part2&#64;&gt;
&#64;}&#64;&#64;
&#64;d part1... &#64;{This is part 1.&#64;}
&#64;d part2 &#64;{This is part 2.&#64;}
Okay, now for some errors: attempt to weave but no full name for part1....
&quot;&quot;&quot;

test5_w = &quot;&quot;&quot;
Some anonymous chunk
&#64;o test5.tmp
&#64;{&#64;&lt;part1...&#64;&gt;
&#64;&lt;part2&#64;&gt;
&#64;}&#64;&#64;
&#64;d part1a &#64;{This is part 1 a.&#64;}
&#64;d part1b &#64;{This is part 1 b.&#64;}
&#64;d part2 &#64;{This is part 2.&#64;}
Okay, now for some errors: part1... is ambiguous
&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Tangle Test semantic errors 2-5 (94)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</div>
<p>The remaining errors have unique features, and can't use the generic test function.
The first of these looks for a number of warnings, instead of an exception.</p>
<p class="rubric" id="tangle-test-semantic-error-6-95">Tangle Test semantic error 6 (95) =</p>
<pre class="code literal-block">
→ `Sample Document 6 (96)`_

&#64;pytest.mark.text_name(test6_w, &quot;test6.w&quot;)
def test_tangle_warnings(tmp_path, source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    tangler = pyweb.Tangler(tmp_path)
    tangler.emit(web)
    print(web.no_reference())
    assert 1 == len(web.no_reference())
    assert 1 == len(web.multi_reference())
    assert {'part1a', 'part1...'} == tangler.reference_names
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Tangle Test semantic error 6 (95)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</div>
<p class="rubric" id="sample-document-6-96">Sample Document 6 (96) =</p>
<pre class="code literal-block">
test6_w = &quot;&quot;&quot;Some anonymous chunk
&#64;o test6.tmp
&#64;{&#64;&lt;part1...&#64;&gt;
&#64;&lt;part1a&#64;&gt;
&#64;}&#64;&#64;
&#64;d part1a &#64;{This is part 1 a.&#64;}
&#64;d part2 &#64;{This is part 2.&#64;}
Okay, now for some warnings:
- part1 has multiple references.
- part2 is unreferenced.
&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Sample Document 6 (96)</em>.
Used by     → <a class="reference internal" href="#tangle-test-semantic-error-6-95">Tangle Test semantic error 6 (95)</a>.</div>
<p class="rubric" id="tangle-test-include-example-7-97">Tangle Test include example 7 (97) =</p>
<pre class="code literal-block">
→ `Sample Document 7 and it's included file (98)`_

&#64;pytest.mark.text_name_incl(test7_w, &quot;test7.w&quot;, test7_inc_w, 'test7_inc.tmp')
def test_tangle_should_include(tmp_path, source_path_incl) -&gt; None:
    source, file_path = source_path_incl
    rdr = pyweb.WebReader()

    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    tangler = pyweb.Tangler(tmp_path)
    tangler.emit(web)
    assert 5 == len(web.chunks)
    assert test7_inc_w == web.chunks[3].commands[0].text
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Tangle Test include example 7 (97)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</div>
<p class="rubric" id="sample-document-7-and-it-s-included-file-98">Sample Document 7 and it's included file (98) =</p>
<pre class="code literal-block">
test7_w = &quot;&quot;&quot;
Some anonymous chunk.
&#64;d title &#64;[the title of this document, defined with &#64;&#64;[ and &#64;&#64;]&#64;]
A reference to &#64;&lt;title&#64;&gt;.
&#64;i test7_inc.tmp
A final anonymous chunk from test7.w
&quot;&quot;&quot;

test7_inc_w = &quot;&quot;&quot;The test7a.tmp chunk for test7.w&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Sample Document 7 and it's included file (98)</em>.
Used by     → <a class="reference internal" href="#tangle-test-include-example-7-97">Tangle Test include example 7 (97)</a>.</div>
<p class="rubric" id="tangle-test-overheads-imports-etc-99">Tangle Test overheads: imports, etc. (99) =</p>
<pre class="code literal-block">
&quot;&quot;&quot;Tangler tests exercise various semantic features.&quot;&quot;&quot;
import io
import logging
import os
from pathlib import Path
from typing import ClassVar, TextIO

import pytest

import pyweb
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Tangle Test overheads: imports, etc. (99)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</div>
</div>
<div class="section" id="tests-for-weaving">
<h2><a class="toc-backref" href="#toc-entry-16">Tests for Weaving</a></h2>
<p>We need to be able to weave a document from one or more source files.</p>
<p class="rubric" id="tests-test-weaver-py-100">tests/test_weaver.py (100) =</p>
<pre class="code literal-block">
→ `Weave Test overheads: imports, etc. (107)`_

→ `Weave Test references and definitions (101)`_
→ `Weave Test evaluation of expressions (105)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>tests/test_weaver.py (100)</em>.</div>
<p>Weaving test cases have a common setup shown in this fixture.</p>
<p class="rubric" id="weave-test-references-and-definitions-101">Weave Test references and definitions (101) =</p>
<pre class="code literal-block">
→ `Sample Document 0 (102)`_
→ `Expected Output 0 (103)`_


&#64;pytest.mark.text_name(test0_w, &quot;test0.w&quot;)
def test_load_should_createChunks(source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    assert 3 == len(chunks)

&#64;pytest.mark.text_name(test0_w, &quot;test0.w&quot;)
def test_weave_should_create_html(tmp_path, source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    web.web_path = file_path
    doc = pyweb.Weaver( )
    doc.set_markup(&quot;html&quot;)
    doc.output = tmp_path
    doc.emit(web)
    assert doc.target_path == file_path.with_suffix(&quot;.html&quot;)
    actual = doc.target_path.read_text()
    assert test0_expected_html == actual

&#64;pytest.mark.text_name(test0_w, &quot;test0.w&quot;)
def test_weave_should_create_debug(tmp_path, source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    web.web_path = file_path
    doc = pyweb.Weaver( )
    doc.set_markup(&quot;debug&quot;)
    doc.output = tmp_path
    doc.emit(web)
    assert doc.target_path == file_path.with_suffix(&quot;.debug&quot;)
    actual = doc.target_path.read_text()
    assert test0_expected_debug == actual
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Weave Test references and definitions (101)</em>.
Used by     → <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>.</div>
<p class="rubric" id="sample-document-0-102">Sample Document 0 (102) =</p>
<pre class="code literal-block">
test0_w = &quot;&quot;&quot;&lt;html&gt;
&lt;head&gt;
    &lt;link rel=&quot;StyleSheet&quot; href=&quot;pyweb.css&quot; type=&quot;text/css&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
&#64;&lt;some code&#64;&gt;

&#64;d some code
&#64;{
def fastExp(n, p):
    r = 1
    while p &gt; 0:
        if p%2 == 1: return n*fastExp(n,p-1)
    return n*n*fastExp(n,p/2)

for i in range(24):
    fastExp(2,i)
&#64;}
&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Sample Document 0 (102)</em>.
Used by     → <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a>.</div>
<p class="rubric" id="expected-output-0-103">Expected Output 0 (103) =</p>
<pre class="code literal-block">
test0_expected_html = &quot;&quot;&quot;&lt;html&gt;
&lt;head&gt;
    &lt;link rel=&quot;StyleSheet&quot; href=&quot;pyweb.css&quot; type=&quot;text/css&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
&amp;rarr;&lt;a href=&quot;#pyweb_1&quot;&gt;&lt;em&gt;some code (1)&lt;/em&gt;&lt;/a&gt;


&lt;a name=&quot;pyweb_1&quot;&gt;&lt;/a&gt;
&lt;!--line number ('test0.w', 10)--&gt;
&lt;p&gt;&lt;em&gt;some code (1)&lt;/em&gt; =&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
def fastExp(n, p):
    r = 1
    while p &amp;gt; 0:
        if p%2 == 1: return n*fastExp(n,p-1)
    return n*n*fastExp(n,p/2)

for i in range(24):
    fastExp(2,i)

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;#8718; &lt;em&gt;some code (1)&lt;/em&gt;.

&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Expected Output 0 (103)</em>.
Used by     → <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a>.</div>
<p class="rubric" id="expected-output-0-104">Expected Output 0 (104) +=</p>
<pre class="code literal-block">
test0_expected_debug = (
    'text: TextCommand(text=\'&lt;html&gt;\\n&lt;head&gt;\\n    &lt;link rel=&quot;StyleSheet&quot; href=&quot;pyweb.css&quot; type=&quot;text/css&quot; /&gt;\\n&lt;/head&gt;\\n&lt;body&gt;\\n\', location=(\'test0.w\', 1))\n'
    &quot;ref: ReferenceCommand(name='some code', location=('test0.w', 6))&quot;
    &quot;text: TextCommand(text='\\n\\n', location=('test0.w', 7))\n&quot;
    &quot;begin_code: NamedChunk(options=['some', 'code'], name='some code', seq=1, commands=[CodeCommand(text='\\ndef fastExp(n, p):\\n    r = 1\\n    while p &gt; 0:\\n        if p%2 == 1: return n*fastExp(n,p-1)\\n    return n*n*fastExp(n,p/2)\\n\\nfor i in range(24):\\n    fastExp(2,i)\\n', location=('test0.w', 10))], def_names=[], initial=True, comment_start=None, comment_end=None, weave=True, style=None, references=0, referencedBy=None, logger=&lt;Logger Chunk (INFO)&gt;, indent=None)\n&quot;
    &quot;code: CodeCommand(text='\\ndef fastExp(n, p):\\n    r = 1\\n    while p &gt; 0:\\n        if p%2 == 1: return n*fastExp(n,p-1)\\n    return n*n*fastExp(n,p/2)\\n\\nfor i in range(24):\\n    fastExp(2,i)\\n', location=('test0.w', 10))\n&quot;
    &quot;end_code: NamedChunk(options=['some', 'code'], name='some code', seq=1, commands=[CodeCommand(text='\\ndef fastExp(n, p):\\n    r = 1\\n    while p &gt; 0:\\n        if p%2 == 1: return n*fastExp(n,p-1)\\n    return n*n*fastExp(n,p/2)\\n\\nfor i in range(24):\\n    fastExp(2,i)\\n', location=('test0.w', 10))], def_names=[], initial=True, comment_start=None, comment_end=None, weave=True, style=None, references=0, referencedBy=None, logger=&lt;Logger Chunk (INFO)&gt;, indent=None)\n&quot;
    &quot;text: TextCommand(text='\\n&lt;/body&gt;\\n&lt;/html&gt;\\n', location=('test0.w', 19))&quot;
    )
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Expected Output 0 (104)</em>.
Used by     → <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a>.</div>
<p>Note that this requires a mocked <tt class="docutils literal">time</tt> module in order
to properly provide a consistent output from <tt class="docutils literal">time.asctime()</tt>.</p>
<p class="rubric" id="weave-test-evaluation-of-expressions-105">Weave Test evaluation of expressions (105) =</p>
<pre class="code literal-block">
→ `Sample Document 9 (106)`_

from unittest.mock import Mock

&#64;pytest.fixture()
def mock_time(monkeypatch):
    mock_time = Mock(asctime=Mock(return_value=&quot;mocked time&quot;))
    monkeypatch.setattr(pyweb, &quot;time&quot;, mock_time)
    return mock_time

&#64;pytest.mark.text_name(test9_w, &quot;test9.w&quot;)
def test_should_evaluate(tmp_path, source_path, mock_time) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    web.web_path = file_path
    doc = pyweb.Weaver( )
    doc.set_markup(&quot;html&quot;)
    doc.output = tmp_path
    doc.emit(web)
    assert doc.target_path == file_path.with_suffix(&quot;.html&quot;)
    actual = doc.target_path.read_text().splitlines()
    #print(actual)
    assert &quot;An anonymous chunk.&quot; == actual[0]
    assert &quot;Time = mocked time&quot; == actual[1]
    assert &quot;File = ('test9.w', 3)&quot; == actual[2]
    assert 'Version = 3.3' == actual[3]
    assert f'CWD = {os.getcwd()}' == actual[4]
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Weave Test evaluation of expressions (105)</em>.
Used by     → <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>.</div>
<p class="rubric" id="sample-document-9-106">Sample Document 9 (106) =</p>
<pre class="code literal-block">
test9_w= &quot;&quot;&quot;An anonymous chunk.
Time = &#64;(time.asctime()&#64;)
File = &#64;(theLocation&#64;)
Version = &#64;(__version__&#64;)
CWD = &#64;(os.path.realpath('.')&#64;)
&quot;&quot;&quot;
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Sample Document 9 (106)</em>.
Used by     → <a class="reference internal" href="#weave-test-evaluation-of-expressions-105">Weave Test evaluation of expressions (105)</a>.</div>
<p class="rubric" id="weave-test-overheads-imports-etc-107">Weave Test overheads: imports, etc. (107) =</p>
<pre class="code literal-block">
&quot;&quot;&quot;Weaver tests exercise various weaving features.&quot;&quot;&quot;
import io
import logging
import os
from pathlib import Path
import string
import sys
from textwrap import dedent
from typing import ClassVar

import pytest

import pyweb
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Weave Test overheads: imports, etc. (107)</em>.
Used by     → <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>.</div>
</div>
</div>
<div class="section" id="additional-scripts-testing">
<h1><a class="toc-backref" href="#toc-entry-17">Additional Scripts Testing</a></h1>
<!-- test/scripts.w -->
<p>We provide these two additional scripts; effectively command-line short-cuts:</p>
<ul class="simple">
<li><tt class="docutils literal">tangle.py</tt></li>
<li><tt class="docutils literal">weave.py</tt></li>
</ul>
<p>These isolate specific actions, making it slightly easier to provide a new subclass or macro configuration.
These need their own test cases.</p>
<p>This gives us the following outline for the script testing.</p>
<p class="rubric" id="tests-test-scripts-py-108">tests/test_scripts.py (108) =</p>
<pre class="code literal-block">
→ `Script Test overheads: imports, etc. (113)`_

→ `Sample web file to test with (109)`_

→ `Fixture for test cases (110)`_

→ `Test of weave.py (111)`_

→ `Test of tangle.py (112)`_
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>tests/test_scripts.py (108)</em>.</div>
<div class="section" id="sample-web-file">
<h2><a class="toc-backref" href="#toc-entry-18">Sample Web File</a></h2>
<p>This is a web <tt class="docutils literal">.w</tt> file to create a document and tangle a small file.</p>
<p class="rubric" id="sample-web-file-to-test-with-109">Sample web file to test with (109) =</p>
<pre class="code literal-block">
sample = textwrap.dedent(&quot;&quot;&quot;
    &lt;!doctype html&gt;
    &lt;html lang=&quot;en&quot;&gt;
      &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
        &lt;title&gt;Sample HTML web file&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;h1&gt;Sample HTML web file&lt;/h1&gt;
        &lt;p&gt;We're avoiding using Python specifically.
        This hints at other languages being tangled by this tool.&lt;/p&gt;

    &#64;o sample_tangle.code
    &#64;{
    &#64;&lt;preamble&#64;&gt;
    &#64;&lt;body&#64;&gt;
    &#64;}

    &#64;d preamble
    &#64;{
    #include &lt;stdio.h&gt;
    &#64;}

    &#64;d body
    &#64;{
    int main() {
        println(&quot;Hello, World!&quot;)
    }
    &#64;}

      &lt;/body&gt;
    &lt;/html&gt;
    &quot;&quot;&quot;)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Sample web file to test with (109)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</div>
</div>
<div class="section" id="fixture-for-test-cases">
<h2><a class="toc-backref" href="#toc-entry-19">Fixture for test cases</a></h2>
<p>The <tt class="docutils literal">sample_path</tt> is a consistent test fixture for both test cases.
The sample <tt class="docutils literal">test_sample.w</tt> file is created and removed after the test.</p>
<p class="rubric" id="fixture-for-test-cases-110">Fixture for test cases (110) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def sample_path(tmp_path) -&gt; Path:
    sample_path = tmp_path / &quot;test_sample.w&quot;
    sample_path.write_text(sample)
    yield sample_path
    sample_path.unlink()

def clean_lines(first: str) -&gt; list[str]:
    &quot;&quot;&quot;Strips blank lines and trailing whitespace that (generally) aren't problems when weaving.&quot;&quot;&quot;
    def non_blank(line: str) -&gt; bool:
        return len(line) &gt; 0
    return list(filter(non_blank, (line.rstrip() for line in first.splitlines())))
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Fixture for test cases (110)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</div>
</div>
<div class="section" id="weave-script-test">
<h2><a class="toc-backref" href="#toc-entry-20">Weave Script Test</a></h2>
<p>We check the weave output to be sure it's what we expected.
This could be altered to check a few features of the weave file rather than compare the entire file.</p>
<p class="rubric" id="test-of-weave-py-111">Test of weave.py (111) =</p>
<pre class="code literal-block">
&#64;pytest.fixture
def expected_weave(sample_path) -&gt; str:
    expected_weave = ('&lt;!doctype html&gt;\n'
        '&lt;html lang=&quot;en&quot;&gt;\n'
        '  &lt;head&gt;\n'
        '    &lt;meta charset=&quot;utf-8&quot;&gt;\n'
        '    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;\n'
        '    &lt;title&gt;Sample HTML web file&lt;/title&gt;\n'
        '  &lt;/head&gt;\n'
        '  &lt;body&gt;\n'
        '    &lt;h1&gt;Sample HTML web file&lt;/h1&gt;\n'
        &quot;    &lt;p&gt;We're avoiding using Python specifically.\n&quot;
        '    This hints at other languages being tangled by this tool.&lt;/p&gt;\n'
        '&lt;div class=&quot;card&quot;&gt;\n'
        '  &lt;div class=&quot;card-header&quot;&gt;\n'
        '    &lt;a type=&quot;button&quot; class=&quot;btn btn-primary&quot; name=&quot;pyweb_1&quot;&gt;&lt;/a&gt;\n'
        &quot;    &lt;!--line number ('test_sample.w', 16)--&gt;\n&quot;
        '    &lt;p class=&quot;small&quot;&gt;&lt;em&gt;sample_tangle.code (1)&lt;/em&gt; =&lt;/p&gt;\n'
        '   &lt;/div&gt;\n'
        '  &lt;div class=&quot;card-body&quot;&gt;\n'
        '    &lt;pre&gt;&lt;code&gt;\n'
        '&amp;rarr;&lt;a href=&quot;#pyweb_2&quot;&gt;&lt;em&gt;preamble (2)&lt;/em&gt;&lt;/a&gt;\n'
        '&amp;rarr;&lt;a href=&quot;#pyweb_3&quot;&gt;&lt;em&gt;body (3)&lt;/em&gt;&lt;/a&gt;\n'
        '    &lt;/code&gt;&lt;/pre&gt;\n'
        '  &lt;/div&gt;\n'
        '&lt;div class=&quot;card-footer&quot;&gt;\n'
        '  &lt;p&gt;&amp;#8718; &lt;em&gt;sample_tangle.code (1)&lt;/em&gt;.\n'
        '  &lt;/p&gt;\n'
        '&lt;/div&gt;\n'
        '&lt;/div&gt;\n'
        '&lt;div class=&quot;card&quot;&gt;\n'
        '  &lt;div class=&quot;card-header&quot;&gt;\n'
        '    &lt;a type=&quot;button&quot; class=&quot;btn btn-primary&quot; name=&quot;pyweb_2&quot;&gt;&lt;/a&gt;\n'
        &quot;    &lt;!--line number ('test_sample.w', 22)--&gt;\n&quot;
        '    &lt;p class=&quot;small&quot;&gt;&lt;em&gt;preamble (2)&lt;/em&gt; =&lt;/p&gt;\n'
        '   &lt;/div&gt;\n'
        '  &lt;div class=&quot;card-body&quot;&gt;\n'
        '    &lt;pre&gt;&lt;code&gt;\n'
        '#include &amp;lt;stdio.h&amp;gt;\n'
        '    &lt;/code&gt;&lt;/pre&gt;\n'
        '  &lt;/div&gt;\n'
        '&lt;div class=&quot;card-footer&quot;&gt;\n'
        '  &lt;p&gt;&amp;#8718; &lt;em&gt;preamble (2)&lt;/em&gt;.\n'
        '  &lt;/p&gt;\n'
        '&lt;/div&gt;\n'
        '&lt;/div&gt;\n'
        '&lt;div class=&quot;card&quot;&gt;\n'
        '  &lt;div class=&quot;card-header&quot;&gt;\n'
        '    &lt;a type=&quot;button&quot; class=&quot;btn btn-primary&quot; name=&quot;pyweb_3&quot;&gt;&lt;/a&gt;\n'
        &quot;    &lt;!--line number ('test_sample.w', 27)--&gt;\n&quot;
        '    &lt;p class=&quot;small&quot;&gt;&lt;em&gt;body (3)&lt;/em&gt; =&lt;/p&gt;\n'
        '   &lt;/div&gt;\n'
        '  &lt;div class=&quot;card-body&quot;&gt;\n'
        '    &lt;pre&gt;&lt;code&gt;\n'
        'int main() {\n'
        '    println(&amp;quot;Hello, World!&amp;quot;)\n'
        '}\n'
        '    &lt;/code&gt;&lt;/pre&gt;\n'
        '  &lt;/div&gt;\n'
        '&lt;div class=&quot;card-footer&quot;&gt;\n'
        '  &lt;p&gt;&amp;#8718; &lt;em&gt;body (3)&lt;/em&gt;.\n'
        '  &lt;/p&gt;\n'
        '&lt;/div&gt;\n'
        '&lt;/div&gt;\n'
        '  &lt;/body&gt;\n'
        '&lt;/html&gt;')
    return expected_weave

def test_weave(sample_path: Path, expected_weave) -&gt; None:
    output = sample_path.with_suffix(&quot;.html&quot;)

    weave.main(sample_path)
    result = output.read_text()
    output.unlink()

    assert clean_lines(expected_weave) == clean_lines(result)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Test of weave.py (111)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</div>
</div>
<div class="section" id="tangle-script-test">
<h2><a class="toc-backref" href="#toc-entry-21">Tangle Script Test</a></h2>
<p>We check the tangle output to be sure it's what we expected.</p>
<p class="rubric" id="test-of-tangle-py-112">Test of tangle.py (112) =</p>
<pre class="code literal-block">
expected_tangle = textwrap.dedent(&quot;&quot;&quot;

    #include &lt;stdio.h&gt;


    int main() {
        println(&quot;Hello, World!&quot;)
    }

    &quot;&quot;&quot;)

def test_tangle(sample_path):
    # Name comes from ``&#64;o`` command
    output = sample_path.parent / &quot;sample_tangle.code&quot;

    tangle.main(sample_path)
    result = output.read_text()
    output.unlink()
    assert clean_lines(expected_tangle) == clean_lines(result)
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Test of tangle.py (112)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</div>
</div>
<div class="section" id="overheads">
<h2><a class="toc-backref" href="#toc-entry-22">Overheads</a></h2>
<p>These are the common Python overheads required for testing.
Import some modules used in general.
Import <tt class="docutils literal">pytest</tt> to provide helpful definitions.
Import the modules under test.</p>
<p class="rubric" id="script-test-overheads-imports-etc-113">Script Test overheads: imports, etc. (113) =</p>
<pre class="code literal-block">
&quot;&quot;&quot;Script tests.&quot;&quot;&quot;
import logging
from pathlib import Path
import sys
import textwrap

import pytest

import tangle
import weave
</pre>
<!--  -->
<div class="small docutils container">
∎ <em>Script Test overheads: imports, etc. (113)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</div>
<p>Run this test with the following command:</p>
<pre class="code bash literal-block">
<span class="name variable">PYTHONPATH</span><span class="operator">=</span>src<span class="whitespace"> </span>pytest<span class="whitespace"> </span>tests/test_scripts.py
</pre>
<p>This will put the local <tt class="docutils literal">src</tt> directory on the <tt class="docutils literal">PYTHONPATH</tt>, so the modules under test can be imported.</p>
</div>
</div>
<div class="section" id="indices">
<h1><a class="toc-backref" href="#toc-entry-23">Indices</a></h1>
<div class="section" id="files">
<h2><a class="toc-backref" href="#toc-entry-24">Files</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">tests/test_unit.py:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>:tests/conftest.py:
→ <a class="reference internal" href="#tests-conftest-py-81">tests/conftest.py (81)</a>:pytest.ini:
→ <a class="reference internal" href="#pytest-ini-84">pytest.ini (84)</a>:tests/test_loader.py:
→ <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>:tests/test_tangler.py:
→ <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>:tests/test_weaver.py:
→ <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>:tests/test_scripts.py:
→ <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="macros">
<h2><a class="toc-backref" href="#toc-entry-25">Macros</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">Expected Output 0:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#expected-output-0-103">Expected Output 0 (103)</a>, → <a class="reference internal" href="#expected-output-0-104">Expected Output 0 (104)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Fixture for Source, WebReader, Path, with an Include:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#fixture-for-source-webreader-path-with-an-include-83">Fixture for Source, WebReader, Path, with an Include (83)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Fixture for Source, WebReader, and Path:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#fixture-for-source-webreader-and-path-82">Fixture for Source, WebReader, and Path (82)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Fixture for test cases:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#fixture-for-test-cases-110">Fixture for test cases (110)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Load Test error handling with a few common syntax errors:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#load-test-error-handling-with-a-few-common-syntax-errors-86">Load Test error handling with a few common syntax errors (86)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Load Test include processing with syntax errors:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#load-test-include-processing-with-syntax-errors-88">Load Test include processing with syntax errors (88)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Load Test overheads:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">imports, etc.:
→ <a class="reference internal" href="#load-test-overheads-imports-etc-90">Load Test overheads: imports, etc. (90)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sample Document 0:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#sample-document-0-102">Sample Document 0 (102)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sample Document 1 with correct and incorrect syntax:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#sample-document-1-with-correct-and-incorrect-syntax-87">Sample Document 1 with correct and incorrect syntax (87)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sample Document 6:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#sample-document-6-96">Sample Document 6 (96)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sample Document 7 and it's included file:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#sample-document-7-and-it-s-included-file-98">Sample Document 7 and it's included file (98)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sample Document 8 and the file it includes:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#sample-document-8-and-the-file-it-includes-89">Sample Document 8 and the file it includes (89)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sample Document 9:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#sample-document-9-106">Sample Document 9 (106)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sample web file to test with:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#sample-web-file-to-test-with-109">Sample web file to test with (109)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Script Test overheads:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">imports, etc.:
→ <a class="reference internal" href="#script-test-overheads-imports-etc-113">Script Test overheads: imports, etc. (113)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangle Test fixture to refactor common setup:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#tangle-test-fixture-to-refactor-common-setup-92">Tangle Test fixture to refactor common setup (92)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangle Test function to execute cases:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#tangle-test-function-to-execute-cases-93">Tangle Test function to execute cases (93)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangle Test include example 7:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#tangle-test-include-example-7-97">Tangle Test include example 7 (97)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangle Test overheads:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">imports, etc.:
→ <a class="reference internal" href="#tangle-test-overheads-imports-etc-99">Tangle Test overheads: imports, etc. (99)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangle Test semantic error 6:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#tangle-test-semantic-error-6-95">Tangle Test semantic error 6 (95)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangle Test semantic errors 2-5:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#tangle-test-semantic-errors-2-5-94">Tangle Test semantic errors 2-5 (94)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Test of tangle.py:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#test-of-tangle-py-112">Test of tangle.py (112)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Test of weave.py:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#test-of-weave-py-111">Test of weave.py (111)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test Mock Chunk class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-mock-chunk-class-4">Unit Test Mock Chunk class (4)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Action class hierarchy:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Application class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-application-class-78">Unit Test of Application class (78)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Chunk References:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Chunk class hierarchy:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Chunk construction:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-chunk-construction-19">Unit Test of Chunk construction (19)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Chunk interrogation:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-chunk-interrogation-20">Unit Test of Chunk interrogation (20)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Chunk properties:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-chunk-properties-21">Unit Test of Chunk properties (21)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Chunk superclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-chunk-superclass-15">Unit Test of Chunk superclass (15)</a>, → <a class="reference internal" href="#unit-test-of-chunk-superclass-16">Unit Test of Chunk superclass (16)</a>, → <a class="reference internal" href="#unit-test-of-chunk-superclass-17">Unit Test of Chunk superclass (17)</a>, → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of CodeCommand class to contain a program source code block:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Command class hierarchy:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Command superclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-command-superclass-40">Unit Test of Command superclass (40)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Emitter Superclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-emitter-superclass-3">Unit Test of Emitter Superclass (3)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Emitter class hierarchy:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of FileXrefCommand class for an output file cross-reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of HTML macros in Weaver:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-html-macros-in-weaver-10">Unit Test of HTML macros in Weaver (10)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of LaTeX macros in Weaver:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of MacroXrefCommand class for a named chunk cross-reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of NamedChunk subclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of NamedChunk with no indent:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of NamedDocumentChunk subclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of OutputChunk subclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of ReferenceCommand class for chunk references:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Tangler subclass of Emitter:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-tangler-subclass-of-emitter-12">Unit Test of Tangler subclass of Emitter (12)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of TanglerMake subclass of Emitter:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-tanglermake-subclass-of-emitter-13">Unit Test of TanglerMake subclass of Emitter (13)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of TextCommand class to contain a document text block:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of UserIdXrefCommand class for a user identifier cross-reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Weaver subclass of Emitter:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-weaver-subclass-of-emitter-5">Unit Test of Weaver subclass of Emitter (5)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of Web class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of WebReader class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-webreader-class-65">Unit Test of WebReader class (65)</a>, → <a class="reference internal" href="#unit-test-of-webreader-class-66">Unit Test of WebReader class (66)</a>, → <a class="reference internal" href="#unit-test-of-webreader-class-67">Unit Test of WebReader class (67)</a>, → <a class="reference internal" href="#unit-test-of-webreader-class-68">Unit Test of WebReader class (68)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test of XrefCommand superclass for all cross-reference commands:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-xrefcommand-superclass-for-all-cross-reference-commands-47">Unit Test of XrefCommand superclass for all cross-reference commands (47)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test output chunk properties:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-output-chunk-properties-30">Unit Test output chunk properties (30)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test output chunk xref:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-output-chunk-xref-29">Unit Test output chunk xref (29)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test overheads:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">imports, etc.:
→ <a class="reference internal" href="#unit-test-overheads-imports-etc-79">Unit Test overheads: imports, etc. (79)</a>, → <a class="reference internal" href="#unit-test-overheads-imports-etc-80">Unit Test overheads: imports, etc. (80)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test reference command methods should work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-reference-command-methods-should-work-58">Unit Test reference command methods should work (58)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit Test reference command tangle should work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-reference-command-tangle-should-work-59">Unit Test reference command tangle should work (59)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test LoadAction should call WebReader:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-loadaction-should-call-webreader-77">Unit test LoadAction should call WebReader (77)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test TangleAction should call Tangler:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-tangleaction-should-call-tangler-75">Unit test TangleAction should call Tangler (75)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test WeaveAction should call Weaver:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-weaveaction-should-call-weaver-73">Unit test WeaveAction should call Weaver (73)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test code command methods should work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-code-command-methods-should-work-45">Unit test code command methods should work (45)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test code command tangle should error:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-code-command-tangle-should-error-46">Unit test code command tangle should error (46)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test file xref command methods should work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-file-xref-command-methods-should-work-49">Unit test file xref command methods should work (49)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test file xref command tangle should error:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-file-xref-command-tangle-should-error-50">Unit test file xref command tangle should error (50)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test macro xref command methods should work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-macro-xref-command-methods-should-work-52">Unit test macro xref command methods should work (52)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test macro xref command tangle shuould fail:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-macro-xref-command-tangle-shuould-fail-53">Unit test macro xref command tangle shuould fail (53)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test named document chunk properties:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-named-document-chunk-properties-33">Unit test named document chunk properties (33)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test named document chunk xref:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-named-document-chunk-xref-32">Unit test named document chunk xref (32)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of Action Sequence class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-action-sequence-class-70">Unit test of Action Sequence class (70)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of LoadAction class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-loadaction-class-76">Unit test of LoadAction class (76)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of TangleAction class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-tangleaction-class-74">Unit test of TangleAction class (74)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of WeaverAction class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-weaveraction-class-72">Unit test of WeaverAction class (72)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of action sequence:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-action-sequence-71">Unit test of action sequence (71)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of named chunk no-indent properties:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-named-chunk-no-indent-properties-27">Unit test of named chunk no-indent properties (27)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of named chunk no-indent xref:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-named-chunk-no-indent-xref-26">Unit test of named chunk no-indent xref (26)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of named chunk properties:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-named-chunk-properties-24">Unit test of named chunk properties (24)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of named chunk xref:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-named-chunk-xref-23">Unit test of named chunk xref (23)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of one-level transitive reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-one-level-transitive-reference-37">Unit test of one-level transitive reference (37)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of simple references:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-simple-references-35">Unit test of simple references (35)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of top-level transitive reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-top-level-transitive-reference-38">Unit test of top-level transitive reference (38)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test of two-level transitive reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-of-two-level-transitive-reference-36">Unit test of two-level transitive reference (36)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test text command methods should work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-text-command-methods-should-work-42">Unit test text command methods should work (42)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test text command tangle should error:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-text-command-tangle-should-error-43">Unit test text command tangle should error (43)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test userid xref command methods should work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-userid-xref-command-methods-should-work-55">Unit test userid xref command methods should work (55)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test userid xref command tangle should fail:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-userid-xref-command-tangle-should-fail-56">Unit test userid xref command tangle should fail (56)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test web iteration over chunks:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-web-iteration-over-chunks-62">Unit test web iteration over chunks (62)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test web name resolution:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-web-name-resolution-61">Unit test web name resolution (61)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test web tangle when valid:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-web-tangle-when-valid-63">Unit test web tangle when valid (63)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Unit test web weave when valid:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#unit-test-web-weave-when-valid-64">Unit test web weave when valid (64)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weave Test evaluation of expressions:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#weave-test-evaluation-of-expressions-105">Weave Test evaluation of expressions (105)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weave Test overheads:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">imports, etc.:
→ <a class="reference internal" href="#weave-test-overheads-imports-etc-107">Weave Test overheads: imports, etc. (107)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weave Test references and definitions:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">expected RST output:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#expected-rst-output-6">expected RST output (6)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">expected html output:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#expected-html-output-11">expected html output (11)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">expected tex minted output:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#expected-tex-minted-output-9">expected tex minted output (9)</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">expected tex output:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→ <a class="reference internal" href="#expected-tex-output-8">expected tex output (8)</a></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<div class="small docutils container">
<blockquote>
Created by src/pyweb.py at Sat Oct 26 19:20:11 2024.</blockquote>
<p>Source pyweb_test.w modified Sun Oct 20 13:50:38 2024.</p>
<blockquote>
<p>pyweb.__version__ '3.3'.</p>
<p>Working directory '/Users/slott/Documents/Projects/py-web-tool'.</p>
</blockquote>
</div>
</div>
</div>
</div>
</body>
</html>
