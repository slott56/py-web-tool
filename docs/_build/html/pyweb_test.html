<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>pyWeb Literate Programming 3.3 - Test Suite &#8212; PyWebTool 3.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=c662bb8c" />
    <script src="_static/documentation_options.js?v=828ea960"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="pyWeb Literate Programming 3.3" href="pyweb.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pyweb-literate-programming-3-3-test-suite">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">pyWeb Literate Programming 3.3 - Test Suite</a><a class="headerlink" href="#pyweb-literate-programming-3-3-test-suite" title="Link to this heading">¶</a></h1>
<p>** Yet Another Literate Programming Tool**</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pyweb-literate-programming-3-3-test-suite" id="id1">pyWeb Literate Programming 3.3 - Test Suite</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#unit-testing" id="id3">Unit Testing</a></p>
<ul>
<li><p><a class="reference internal" href="#emitter-tests" id="id4">Emitter Tests</a></p></li>
<li><p><a class="reference internal" href="#chunk-tests" id="id5">Chunk Tests</a></p></li>
<li><p><a class="reference internal" href="#chunk-references-tests" id="id6">Chunk References Tests</a></p></li>
<li><p><a class="reference internal" href="#command-tests" id="id7">Command Tests</a></p></li>
<li><p><a class="reference internal" href="#web-tests" id="id8">Web Tests</a></p></li>
<li><p><a class="reference internal" href="#webreader-tests" id="id9">WebReader Tests</a></p></li>
<li><p><a class="reference internal" href="#action-tests" id="id10">Action Tests</a></p></li>
<li><p><a class="reference internal" href="#application-tests" id="id11">Application Tests</a></p></li>
<li><p><a class="reference internal" href="#overheads-and-main-script" id="id12">Overheads and Main Script</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#functional-testing" id="id13">Functional Testing</a></p>
<ul>
<li><p><a class="reference internal" href="#shared-fixtures" id="id14">Shared Fixtures</a></p></li>
<li><p><a class="reference internal" href="#tests-for-loading" id="id15">Tests for Loading</a></p></li>
<li><p><a class="reference internal" href="#tests-for-tangling" id="id16">Tests for Tangling</a></p></li>
<li><p><a class="reference internal" href="#tests-for-weaving" id="id17">Tests for Weaving</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-scripts-testing" id="id18">Additional Scripts Testing</a></p>
<ul>
<li><p><a class="reference internal" href="#sample-web-file" id="id19">Sample Web File</a></p></li>
<li><p><a class="reference internal" href="#fixture-for-test-cases" id="id20">Fixture for test cases</a></p></li>
<li><p><a class="reference internal" href="#weave-script-test" id="id21">Weave Script Test</a></p></li>
<li><p><a class="reference internal" href="#tangle-script-test" id="id22">Tangle Script Test</a></p></li>
<li><p><a class="reference internal" href="#overheads" id="id23">Overheads</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#indices" id="id24">Indices</a></p>
<ul>
<li><p><a class="reference internal" href="#files" id="id25">Files</a></p></li>
<li><p><a class="reference internal" href="#macros" id="id26">Macros</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>There are two levels of testing in this document.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#unit-testing">Unit Testing</a></p></li>
<li><p><a class="reference internal" href="#functional-testing">Functional Testing</a></p></li>
</ul>
<p>Other testing, like performance or security, is possible.
But for this application, not very interesting.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pyweb_test.w</span></code> WEB creates the test suite.
This source will weave a <code class="docutils literal notranslate"><span class="pre">pyweb_test.rst</span></code> file.
It tangles several test modules:  <code class="docutils literal notranslate"><span class="pre">test.py</span></code>, <code class="docutils literal notranslate"><span class="pre">test_tangler.py</span></code>, <code class="docutils literal notranslate"><span class="pre">test_weaver.py</span></code>,
<code class="docutils literal notranslate"><span class="pre">test_loader.py</span></code>, <code class="docutils literal notranslate"><span class="pre">test_unit.py</span></code>, and <code class="docutils literal notranslate"><span class="pre">test_scripts.py</span></code>.</p>
<p>Use <strong>pytest</strong> to discover and run all 80+ test cases.</p>
<p>Here’s a script that works out well for running this without disturbing the development
environment. The <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> setting is essential to support importing <code class="docutils literal notranslate"><span class="pre">pyweb</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python pyweb.py -o tests tests/pyweb_test.w
PYTHONPATH=$(PWD) pytest
</pre></div>
</div>
<p>Note that the last line sets an environment variable and runs
the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> tool on a single line.</p>
</section>
<section id="unit-testing">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Unit Testing</a><a class="headerlink" href="#unit-testing" title="Link to this heading">¶</a></h2>
<p>There are several broad areas of unit testing.  There are the 34 classes in this application.
However, it isn’t really necessary to test everyone single one of these classes.
We’ll decompose these into several hierarchies.</p>
<ul>
<li><p>Emitters</p>
<blockquote>
<div><p>class Emitter:</p>
<p>class Weaver(Emitter):</p>
<p>class LaTeX(Weaver):</p>
<p>class HTML(Weaver):</p>
<p>class Tangler(Emitter):</p>
<p>class TanglerMake(Tangler):</p>
</div></blockquote>
</li>
<li><p>Structure: Chunk, Command</p>
<blockquote>
<div><p>class Chunk:</p>
<p>class NamedChunk(Chunk):</p>
<p>class NamedChunk_Noindent(Chunk):</p>
<p>class OutputChunk(NamedChunk):</p>
<p>class NamedDocumentChunk(NamedChunk):</p>
<p>class Command:</p>
<p>class TextCommand(Command):</p>
<p>class CodeCommand(TextCommand):</p>
<p>class XrefCommand(Command):</p>
<p>class FileXrefCommand(XrefCommand):</p>
<p>class MacroXrefCommand(XrefCommand):</p>
<p>class UserIdXrefCommand(XrefCommand):</p>
<p>class ReferenceCommand(Command):</p>
</div></blockquote>
</li>
<li><p>class Error(Exception):</p></li>
<li><p>Reference Handling</p>
<blockquote>
<div><p>class Reference:</p>
<p>class SimpleReference(Reference):</p>
<p>class TransitiveReference(Reference):</p>
</div></blockquote>
</li>
<li><p>class Web:</p></li>
<li><p>class WebReader:</p>
<blockquote>
<div><p>class Tokenizer:</p>
<p>class OptionParser:</p>
</div></blockquote>
</li>
<li><p>Action</p>
<blockquote>
<div><p>class Action:</p>
<p>class ActionSequence(Action):</p>
<p>class WeaveAction(Action):</p>
<p>class TangleAction(Action):</p>
<p>class LoadAction(Action):</p>
</div></blockquote>
</li>
<li><p>class Application:</p></li>
<li><p>class MyWeaver(HTML):</p></li>
<li><p>class MyHTML(pyweb.HTML):</p></li>
</ul>
<p>This gives us the following outline for unit testing.</p>
<p class="rubric" id="tests-test-unit-py-1">tests/test_unit.py (1) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Unit Test overheads: imports, etc. (79)`_

→ `Unit Test of Emitter class hierarchy (2)`_
→ `Unit Test of Chunk class hierarchy (14)`_
→ `Unit Test of Chunk References (34)`_
→ `Unit Test of Command class hierarchy (39)`_
→ `Unit Test of Web class (60)`_
→ `Unit Test of WebReader class (65)`_
→ `Unit Test of Action class hierarchy (69)`_
→ `Unit Test of Application class (78)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>tests/test_unit.py (1)</em>.</p>
</div>
<section id="emitter-tests">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Emitter Tests</a><a class="headerlink" href="#emitter-tests" title="Link to this heading">¶</a></h3>
<p>The emitter class hierarchy produces output files; either woven output
which uses templates to generate proper markup, or tangled output which
precisely follows the document structure.</p>
<p class="rubric" id="unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Unit Test Mock Chunk class (4)`_
→ `Unit Test of Emitter Superclass (3)`_
→ `Unit Test of Weaver subclass of Emitter (5)`_
→ `Unit Test of LaTeX macros in Weaver (7)`_
→ `Unit Test of HTML macros in Weaver (10)`_
→ `Unit Test of Tangler subclass of Emitter (12)`_
→ `Unit Test of TanglerMake subclass of Emitter (13)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Emitter class hierarchy (2)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p>The Emitter superclass is designed to be extended.
The test creates a subclass to exercise a few key features.
The default emitter is Tangler-like.</p>
<p class="rubric" id="unit-test-of-emitter-superclass-3">Unit Test of Emitter Superclass (3) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">emitter_subclass</span><span class="p">():</span>
    <span class="n">mock_emit_method</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">EmitterExtension</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Emitter</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">web</span><span class="p">:</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Web</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mock_emit_method</span><span class="p">(</span><span class="n">web</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">EmitterExtension</span><span class="p">,</span> <span class="n">mock_emit_method</span>

<span class="k">def</span> <span class="nf">test_emitter_should_open_close_write</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">emitter_subclass</span><span class="p">):</span>
    <span class="n">emitter_subclass</span><span class="p">,</span> <span class="n">mock_emit_method</span> <span class="o">=</span> <span class="n">emitter_subclass</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;TestEmitter.out&quot;</span>
    <span class="n">emitter</span> <span class="o">=</span> <span class="n">emitter_subclass</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;mock web&quot;</span><span class="p">)</span>
    <span class="n">emitter</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">web</span><span class="p">)</span>

    <span class="n">mock_emit_method</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">web</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">emitter</span><span class="o">.</span><span class="n">output</span> <span class="o">==</span> <span class="n">output</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Emitter Superclass (3)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</p>
</div>
<p>A mock <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> object can be used to test <code class="docutils literal notranslate"><span class="pre">Weaver</span></code> subclasses.</p>
<p>Some tests will create multiple chunks.
To keep their state separate, we define a function to return each mocked <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> instance as a new Mock object.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">write_closure()</span></code> is a function that calls the <code class="docutils literal notranslate"><span class="pre">Tangler.write()</span></code>  method.
This is <em>not</em> consistent with best unit testing practices.
It is merely a hold-over from an older testing strategy.
The mock call history to the <code class="docutils literal notranslate"><span class="pre">tangle()</span></code> method of each <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> instance is a better test strategy.</p>
<p class="rubric" id="unit-test-mock-chunk-class-4">Unit Test Mock Chunk class (4) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mock_chunk_instance</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">seq</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">commands</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mock</span><span class="p">:</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
        <span class="n">wraps</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Chunk</span><span class="p">,</span>
        <span class="n">seq</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span>
        <span class="n">commands</span><span class="o">=</span><span class="n">commands</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="n">def_names</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">references</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">referencedBy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Properties</span>
        <span class="n">full_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
        <span class="c1"># Methods</span>
        <span class="n">type_is</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Chunk&quot;</span><span class="p">),</span>
        <span class="n">tangle</span><span class="o">=</span><span class="n">Mock</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="c1"># Peculiarity of mocks, ``name`` as mocked property must be set separately.</span>
    <span class="n">chunk</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">chunk</span>

<span class="c1"># Remove this...</span>
<span class="n">MockChunk</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Chunk class&quot;</span><span class="p">,</span>
    <span class="n">side_effect</span><span class="o">=</span><span class="n">mock_chunk_instance</span>
<span class="p">)</span>

<span class="c1"># TODO: Make this a fixture used by the mock web fixture.</span>
<span class="k">def</span> <span class="nf">mock_chunks</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Chunk</span><span class="p">]:</span>
    <span class="k">def</span> <span class="nf">tangle_method</span><span class="p">(</span><span class="n">aTangler</span><span class="p">:</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tangler</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">TextIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aTangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;Mocked Tangle Output</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Pre-built references for a mock web.</span>
    <span class="n">mock_file</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;sample.out&quot;</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mock_file</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sample.out&quot;</span>

    <span class="n">mock_output</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;named chunk&quot;</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">def_list</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">mock_output</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;named chunk&quot;</span>

    <span class="n">mock_uid_1</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">userid</span><span class="o">=</span><span class="s2">&quot;user_id_1&quot;</span><span class="p">,</span> <span class="n">ref_list</span><span class="o">=</span><span class="p">[</span><span class="n">mock_output</span><span class="p">])</span>
    <span class="n">mock_uid_2</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">userid</span><span class="o">=</span><span class="s2">&quot;user_id_2&quot;</span><span class="p">,</span> <span class="n">ref_list</span><span class="o">=</span><span class="p">[</span><span class="n">mock_output</span><span class="p">])</span>

    <span class="n">c_0</span> <span class="o">=</span> <span class="n">mock_chunk_instance</span><span class="p">(</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">mock_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
    <span class="n">c_0</span><span class="o">.</span><span class="n">type_is</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">==</span> <span class="s2">&quot;Chunk&quot;</span><span class="p">)</span>
    <span class="n">c_0</span><span class="o">.</span><span class="n">referenced_by</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">c_0</span><span class="o">.</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TextCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;text with |char| untouched.&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TextCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">FileXrefCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">location</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="p">[</span><span class="n">mock_file</span><span class="p">],</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TextCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">MacroXrefCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">location</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">macros</span><span class="o">=</span><span class="p">[</span><span class="n">mock_output</span><span class="p">],</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TextCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">UserIdXrefCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">location</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">userids</span><span class="o">=</span><span class="p">[</span><span class="n">mock_uid_1</span><span class="p">,</span> <span class="n">mock_uid_2</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">]</span>

    <span class="n">c_1</span> <span class="o">=</span> <span class="n">mock_chunk_instance</span><span class="p">(</span><span class="s2">&quot;c3...&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="p">(</span><span class="n">mock_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>
    <span class="n">c_1</span><span class="o">.</span><span class="n">type_is</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">==</span> <span class="s2">&quot;OutputChunk&quot;</span><span class="p">)</span>
    <span class="n">c_1</span><span class="o">.</span><span class="n">full_name</span><span class="o">=</span><span class="n">mock_file</span><span class="o">.</span><span class="n">name</span>
    <span class="n">c_1</span><span class="o">.</span><span class="n">referencedBy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">c_1</span><span class="o">.</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">CodeCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;|char| `code` *em* _em_&quot;</span><span class="p">,</span>
            <span class="n">tangle</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">tangle_method</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">CodeCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">tangle</span><span class="o">=</span><span class="n">Mock</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">(),</span> <span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;named chunk&quot;</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">42</span>
        <span class="p">),</span>
    <span class="p">]</span>
    <span class="c1"># Tweak mocked command&#39;s name</span>
    <span class="n">c_1</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;c3...&quot;</span>
    <span class="c1"># Tweak mocked reference command&#39;s name</span>
    <span class="n">c_1</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">typeid</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">ReferenceCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">)</span>
    <span class="n">c_1</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;named...&quot;</span>

    <span class="n">c_2</span> <span class="o">=</span> <span class="n">mock_chunk_instance</span><span class="p">(</span><span class="s2">&quot;c3 has a long name&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">mock_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">33</span><span class="p">))</span>
    <span class="n">c_2</span><span class="o">.</span><span class="n">type_is</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">==</span> <span class="s2">&quot;NamedChunk&quot;</span><span class="p">)</span>
    <span class="n">c_2</span><span class="o">.</span><span class="n">def_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;userid&quot;</span><span class="p">]</span>
    <span class="n">c_2</span><span class="o">.</span><span class="n">referencedBy</span> <span class="o">=</span> <span class="n">c_1</span>
    <span class="n">c_2</span><span class="o">.</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">CodeCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;|char| `code` *em* _em_&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">Mock</span><span class="p">(</span>
            <span class="n">typeid</span><span class="o">=</span><span class="n">pyweb</span><span class="o">.</span><span class="n">TypeId</span><span class="p">()</span><span class="o">.</span><span class="n">__set_name__</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">CodeCommand</span><span class="p">,</span> <span class="s2">&quot;typeid&quot;</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">tangle</span><span class="o">=</span><span class="n">Mock</span><span class="p">(),</span>
        <span class="p">),</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">c_0</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">]</span>

<span class="c1"># TODO: Make this a fixture.</span>
<span class="k">def</span> <span class="nf">mock_web</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Web</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complex WEB for weaver testing.&quot;&quot;&quot;</span>
    <span class="n">chunk_list</span> <span class="o">=</span> <span class="n">mock_chunks</span><span class="p">()</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mock web&quot;</span><span class="p">,</span>
        <span class="n">web_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;TestWeaver.w&quot;</span><span class="p">),</span>
        <span class="n">chunks</span><span class="o">=</span><span class="n">chunk_list</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">web</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sample.out&quot;</span>
    <span class="n">web</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;named...&quot;</span>
    <span class="n">web</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">web</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">web</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test Mock Chunk class (4)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</p>
</div>
<p>The default <code class="docutils literal notranslate"><span class="pre">Weaver</span></code> is an <code class="docutils literal notranslate"><span class="pre">Emitter</span></code> that uses templates to produce RST markup.</p>
<p class="rubric" id="unit-test-of-weaver-subclass-of-emitter-5">Unit Test of Weaver subclass of Emitter (5) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>def test_rst_quote_rules():
    assert pyweb.rst_quote_rules(&quot;|char| `code` *em* _em_&quot;) == &quot;|char| `code` *em* _em_&quot;

def test_html_quote_rules():
    assert pyweb.html_quote_rules(&quot;a &amp; b &lt; c &gt; d&quot;) == r&quot;a &amp;amp; b &amp;lt; c &amp;gt; d&quot;

→ `expected RST output (6)`_

@pytest.fixture
def web_rst_weaver(tmp_path):
    weaver = pyweb.Weaver(tmp_path)
    weaver.set_markup(&quot;rst&quot;)
    web = mock_web()
    return web, weaver

def test_weaver_functions_generic(tmp_path, web_rst_weaver):
    web, weaver = web_rst_weaver
    weaver.emit(web)
    output_path = tmp_path / &quot;TestWeaver.rst&quot;
    actual = output_path.read_text()
    assert expected_rst_output == actual
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Weaver subclass of Emitter (5)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</p>
</div>
<p class="rubric" id="expected-rst-output-6">expected RST output (6) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expected_rst_output</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;text with |char| untouched.</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;:sample.out:</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;    → `sample.out (1)`_</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;:named chunk:</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;    → ` ()`_</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;:user_id_1:</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;    → `named chunk (2)`_</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;:user_id_2:</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;    → `named chunk (2)`_</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
     <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  _`sample.out (42)`:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  rubric:: sample.out (42) =</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  code-block::</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    :class: code</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    |char| `code` *em* _em_</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    </span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    → `named chunk (42)`_</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  container:: small</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    ∎ *sample.out (42)*.</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    </span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  _`c3 has a long name (3)`:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  rubric:: c3 has a long name (3) =</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  code-block::</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    :class: code</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    |char| `code` *em* _em_</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    </span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;..  container:: small</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    ∎ *c3 has a long name (3)*.</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;    Used by     → `sample.out (42)`_.</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>expected RST output (6)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-weaver-subclass-of-emitter-5">Unit Test of Weaver subclass of Emitter (5)</a>.</p>
</div>
<p>A significant fraction of the various subclasses of weaver are expansion of various template macros.
Testing the template macros looks deeply at the intermediate product (RST or LaTeX), something that may be more easily tested by the final <strong>docutils</strong>, <strong>Sphinx</strong>, or a LaTeX processor.</p>
<p>Because of the complexity of LaTeX, we will examine a few features of these template macros.</p>
<p class="rubric" id="unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `expected tex output (8)`_
→ `expected tex minted output (9)`_

@pytest.fixture
def mock_tiny_web():
    aFileChunk = mock_chunk_instance(&quot;File&quot;, 123, (&quot;sample.w&quot;, 456))
    aFileChunk.referencedBy = [ ]

    aChunk = mock_chunk_instance(&quot;Chunk&quot;, 314, (&quot;sample.w&quot;, 789))
    aChunk.style = &quot;python&quot;
    aChunk.type_is = Mock(side_effect=lambda n: n == &quot;OutputChunk&quot;)
    aChunk.referencedBy = [aFileChunk,]
    aChunk.references = [(aFileChunk.name, aFileChunk.seq)]

    web = Mock(chunks=[aChunk])
    return web

@pytest.fixture
def weaver_instance(tmp_path):
    weaver = pyweb.Weaver(tmp_path)
    return weaver

def test_weaver_functions_latex(weaver_instance, mock_tiny_web):
    weaver_instance.set_markup(&quot;tex&quot;)

    quote_result = pyweb.latex_quote_rules(&quot;\\end{Verbatim}&quot;)
    assert &quot;\\end\\,{Verbatim}&quot; == quote_result

    weave_result = list(weaver_instance.generate_text(mock_tiny_web))
    assert expected_tex_output == weave_result

def test_weaver_functions_latex_minted(weaver_instance, mock_tiny_web):
    weaver_instance.set_markup(&quot;tex-minted&quot;)
    quote_result = pyweb.latex_minted_quote_rules(&quot;\\end{minted}&quot;)
    assert &quot;\\end\\,{minted}&quot; == quote_result

    weave_result = list(weaver_instance.generate_text(mock_tiny_web))
    assert expected_tex_minted_output == weave_result
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of LaTeX macros in Weaver (7)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</p>
</div>
<p class="rubric" id="expected-tex-output-8">expected tex output (8) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expected_tex_output</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">label{pyweb-314}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{flushleft}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textit{Code example Chunk (314)}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{Verbatim}</span><span class="s1">[commandchars=</span><span class="se">\\\\\\</span><span class="s1">{</span><span class="se">\\</span><span class="s1">},codes={</span><span class="se">\\</span><span class="s1">catcode`$$=3</span><span class="se">\\</span><span class="s1">catcode`^=7},frame=single]&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{Verbatim}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{flushleft}</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>expected tex output (8)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7)</a>.</p>
</div>
<p class="rubric" id="expected-tex-minted-output-9">expected tex minted output (9) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expected_tex_minted_output</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">label{pyweb-314}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textit{Code example Chunk (314)}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{minted}{python}</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{minted}</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>expected tex minted output (9)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7)</a>.</p>
</div>
<p>We’ll examine a few features of the HTML templates.</p>
<p class="rubric" id="unit-test-of-html-macros-in-weaver-10">Unit Test of HTML macros in Weaver (10) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `expected html output (11)`_

def test_weaver_functions_html(weaver_instance, mock_tiny_web):
    weaver_instance.set_markup(&quot;html&quot;)

    quote_result = pyweb.html_quote_rules(&quot;a &lt; b &amp;&amp; c &gt; d&quot;)
    assert &quot;a &amp;lt; b &amp;amp;&amp;amp; c &amp;gt; d&quot; == quote_result

    weave_result = list(weaver_instance.generate_text(mock_tiny_web))
    assert expected_html_output == weave_result
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of HTML macros in Weaver (10)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</p>
</div>
<p class="rubric" id="expected-html-output-11">expected html output (11) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expected_html_output</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;&lt;a name=&quot;pyweb_314&quot;&gt;&lt;/a&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s2">&quot;&lt;!--line number (&#39;sample.w&#39;, 789)--&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s1">&#39;&lt;p&gt;&lt;em&gt;Chunk (314)&lt;/em&gt; =&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;&lt;pre&gt;&lt;code&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;&lt;/code&gt;&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;&lt;p&gt;&amp;#8718; &lt;em&gt;Chunk (314)&lt;/em&gt;.</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;Used by &amp;rarr;&lt;a href=&quot;#pyweb_&quot;&gt;&lt;em&gt; ()&lt;/em&gt;&lt;/a&gt;.</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;&lt;/p&gt; </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>expected html output (11)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-html-macros-in-weaver-10">Unit Test of HTML macros in Weaver (10)</a>.</p>
</div>
<p>A Tangler emits the various named source files in proper format for the desired
compiler and language.</p>
<p class="rubric" id="unit-test-of-tangler-subclass-of-emitter-12">Unit Test of Tangler subclass of Emitter (12) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_tangler_should_codeBlock</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tangler</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;Some&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot; Code&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;Some Code</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">test_tangler_should_indent</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tangler</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;Begin</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">addIndent</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;More Code</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">clrIndent</span><span class="p">()</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;End</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;Begin</span><span class="se">\n</span><span class="s2">    More Code</span><span class="se">\n</span><span class="s2">End</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">test_tangler_should_noindent</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tangler</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;Begin&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">setIndent</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;More Code&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">clrIndent</span><span class="p">()</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;Begin</span><span class="se">\n</span><span class="s2">More Code</span><span class="se">\n</span><span class="s2">End</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">output</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Tangler subclass of Emitter (12)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</p>
</div>
<p>A TanglerMake uses a cheap hack to see if anything changed.
It creates a temporary file and then does a complete (slow, expensive) file difference check.
If the file is different, the old version is replaced with  the new version.
If the file content is the same, the old version is left intact with all of the operating system creation timestamps untouched.</p>
<p class="rubric" id="unit-test-of-tanglermake-subclass-of-emitter-13">Unit Test of TanglerMake subclass of Emitter (13) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">web_output_tangler</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">TanglerMake</span><span class="p">()</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">mock_web</span><span class="p">()</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">tmp_path</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">web</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">web</span><span class="p">,</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;sample.out&quot;</span><span class="p">,</span> <span class="n">tangler</span>

<span class="k">def</span> <span class="nf">test_confirm_tanged_output</span><span class="p">(</span><span class="n">web_output_tangler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">tangler</span> <span class="o">=</span> <span class="n">web_output_tangler</span>
    <span class="n">tangled</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;Mocked Tangle Output</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">tangled</span>


<span class="k">def</span> <span class="nf">test_same_should_leave</span><span class="p">(</span><span class="n">web_output_tangler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">tangler</span> <span class="o">=</span> <span class="n">web_output_tangler</span>
    <span class="n">original_stat</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">web</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">samestat</span><span class="p">(</span><span class="n">original_stat</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">stat</span><span class="p">())</span>
    <span class="k">assert</span> <span class="n">original_stat</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">==</span> <span class="n">output</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span>

<span class="k">def</span> <span class="nf">test_different_should_update</span><span class="p">(</span><span class="n">web_output_tangler</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">tangler</span> <span class="o">=</span> <span class="n">web_output_tangler</span>
    <span class="n">original_stat</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>

    <span class="c1"># Modify the web in some way to create a distinct value.</span>
    <span class="k">def</span> <span class="nf">tangle_method</span><span class="p">(</span><span class="n">aTangler</span><span class="p">:</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tangler</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">TextIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aTangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;Updated Tangle Output</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">web</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tangle</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">tangle_method</span><span class="p">)</span>

    <span class="n">tangler</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">web</span><span class="p">)</span>

    <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">samestat</span><span class="p">(</span><span class="n">original_stat</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">stat</span><span class="p">())</span>
    <span class="c1"># Not **always** true...</span>
    <span class="c1"># Would require a short sleep to assure time stamps don&#39;t match.</span>
    <span class="c1"># assert original_stat.st_mtime != output.stat().st_mtime</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of TanglerMake subclass of Emitter (13)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a>.</p>
</div>
</section>
<section id="chunk-tests">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Chunk Tests</a><a class="headerlink" href="#chunk-tests" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> and <code class="docutils literal notranslate"><span class="pre">Command</span></code> class hierarchies model the input document – the web
of chunks that are used to produce the documentation and the source files.</p>
<p class="rubric" id="unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Unit Test of Chunk superclass (15)`_
→ `Unit Test of NamedChunk subclass (22)`_
→ `Unit Test of NamedChunk with no indent (25)`_
→ `Unit Test of OutputChunk subclass (28)`_
→ `Unit Test of NamedDocumentChunk subclass (31)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk class hierarchy (14)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p>In order to test the <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> superclass, we need several mock objects.
A <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> contains one or more <code class="docutils literal notranslate"><span class="pre">Command</span></code> instances.
A <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> is a part of a <code class="docutils literal notranslate"><span class="pre">Web</span></code>.
Also, a <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> is processed by a <code class="docutils literal notranslate"><span class="pre">Tangler</span></code> or a <code class="docutils literal notranslate"><span class="pre">Weaver</span></code>.
We’ll need  mock objects for all of these relationships in which a <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> participates.</p>
<p>We’ll replace Commands (and Web) with <code class="docutils literal notranslate"><span class="pre">Mock</span></code> objects.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-15">Unit Test of Chunk superclass (15) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MockCommand</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Command class&quot;</span><span class="p">,</span>
    <span class="n">side_effect</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Mock</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Command instance&quot;</span><span class="p">,</span>
        <span class="c1"># text=&quot;&quot;,  # Only used for TextCommand.</span>
        <span class="n">lineNumber</span><span class="o">=</span><span class="mi">314</span><span class="p">,</span>
        <span class="n">startswith</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk superclass (15)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">MockWeb</span></code> contains a <code class="docutils literal notranslate"><span class="pre">Chunk</span></code>.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-16">Unit Test of Chunk superclass (16) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove These...</span>
<span class="k">def</span> <span class="nf">mock_web_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Mock</span><span class="p">:</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Web instance&quot;</span><span class="p">,</span>
        <span class="n">chunks</span><span class="o">=</span><span class="p">[],</span>
        <span class="c1"># Methods</span>
        <span class="c1"># fullNameFor=Mock(side_effect=lambda name: name),</span>
        <span class="c1"># fileXref=Mock(return_value={&#39;file&#39;: [1,2,3]}),</span>
        <span class="c1"># chunkXref=Mock(return_value={&#39;chunk&#39;: [4,5,6]}),</span>
        <span class="c1"># userNamesXref=Mock(return_value={&#39;name&#39;: (7, [8,9,10])}),</span>
        <span class="n">createUsedBy</span><span class="o">=</span><span class="n">Mock</span><span class="p">(),</span>
        <span class="c1"># weaveChunk=Mock(side_effect=lambda name, weaver: weaver.write(name)),</span>
        <span class="c1"># weave=Mock(return_value=None),</span>
        <span class="c1"># tangle=Mock(return_value=None),</span>
        <span class="n">web_path</span><span class="o">=</span><span class="s2">&quot;sample.input&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">web</span>

<span class="n">MockWeb</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Web class&quot;</span><span class="p">,</span>
    <span class="n">side_effect</span><span class="o">=</span><span class="n">mock_web_instance</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk superclass (16)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p>A MockWeaver or MockTangler appear to process a <code class="docutils literal notranslate"><span class="pre">Chunk</span></code>.
We can interrogate the <code class="docutils literal notranslate"><span class="pre">mock_calls</span></code> to be sure the right things were done.</p>
<p>We need to permit <code class="docutils literal notranslate"><span class="pre">__enter__()</span></code> and <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code>,
which leads to a multi-step instance.
The initial instance with <code class="docutils literal notranslate"><span class="pre">__enter__()</span></code> that
returns the context manager instance.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-17">Unit Test of Chunk superclass (17) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mock_weaver_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MagicMock</span><span class="p">:</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Weaver instance context&quot;</span><span class="p">,</span>
        <span class="fm">__exit__</span><span class="o">=</span><span class="n">Mock</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">weaver</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Weaver instance&quot;</span><span class="p">,</span>
        <span class="n">quote</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;quoted&quot;</span><span class="p">),</span>
        <span class="fm">__enter__</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">weaver</span>

<span class="n">MockWeaver</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Weaver class&quot;</span><span class="p">,</span>
    <span class="n">side_effect</span><span class="o">=</span><span class="n">mock_weaver_instance</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">mock_tangler_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MagicMock</span><span class="p">:</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Tangler instance context&quot;</span><span class="p">,</span>
        <span class="n">reference_names</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">add</span><span class="o">=</span><span class="n">Mock</span><span class="p">()),</span>
        <span class="fm">__exit__</span><span class="o">=</span><span class="n">Mock</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">tangler</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Tangler instance&quot;</span><span class="p">,</span>
        <span class="fm">__enter__</span><span class="o">=</span><span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">context</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tangler</span>

<span class="n">MockTangler</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Tangler class&quot;</span><span class="p">,</span>
    <span class="n">side_effect</span><span class="o">=</span><span class="n">mock_tangler_instance</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk superclass (17)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> must be built, interrogated and then emitted.</p>
<p class="rubric" id="unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def chunk_instance():
    return pyweb.Chunk()

→ `Unit Test of Chunk construction (19)`_
→ `Unit Test of Chunk interrogation (20)`_
→ `Unit Test of Chunk properties (21)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk superclass (18)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p>Can we build a Chunk?</p>
<p class="rubric" id="unit-test-of-chunk-construction-19">Unit Test of Chunk construction (19) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_append_command_should_work</span><span class="p">(</span><span class="n">chunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cmd1</span> <span class="o">=</span> <span class="n">MockCommand</span><span class="p">()</span>
    <span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">cmd1</span><span class="p">]</span> <span class="o">==</span> <span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span>

    <span class="n">cmd2</span> <span class="o">=</span> <span class="n">MockCommand</span><span class="p">()</span>
    <span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">cmd1</span><span class="p">,</span> <span class="n">cmd2</span><span class="p">]</span> <span class="o">==</span> <span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk construction (19)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a>.</p>
</div>
<p>Can we interrogate a Chunk?</p>
<p class="rubric" id="unit-test-of-chunk-interrogation-20">Unit Test of Chunk interrogation (20) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_lineNumber_should_work</span><span class="p">(</span><span class="n">chunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cmd1</span> <span class="o">=</span> <span class="n">MockCommand</span><span class="p">()</span>
    <span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">314</span> <span class="o">==</span> <span class="n">chunk_instance</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lineNumber</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk interrogation (20)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a>.</p>
</div>
<p>Can we emit a Chunk with a weaver or tangler?</p>
<p class="rubric" id="unit-test-of-chunk-properties-21">Unit Test of Chunk properties (21) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_chunk_properties</span><span class="p">(</span><span class="n">chunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">chunk_instance</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;some name&quot;</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">mock_web</span><span class="p">()</span>
    <span class="n">chunk_instance</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">web</span><span class="p">)</span>

    <span class="n">chunk_instance</span><span class="o">.</span><span class="n">full_name</span>
    <span class="n">web</span><span class="o">.</span><span class="n">resolve_name</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">chunk_instance</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_instance</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">chunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s1">&#39;Chunk&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">chunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s1">&#39;OutputChunk&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">chunk_instance</span><span class="o">.</span><span class="n">referencedBy</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk properties (21)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">NamedChunk</span></code> is created by a <code class="docutils literal notranslate"><span class="pre">&#64;d</span></code> command.
Since it’s named, it appears in the Web’s index.
Also, it is woven and tangled differently than anonymous chunks.</p>
<p class="rubric" id="unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def namedchunk_instance():
    chunk = pyweb.NamedChunk(options=[&quot;Some Name...&quot;])
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit test of named chunk xref (23)`_
→ `Unit test of named chunk properties (24)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of NamedChunk subclass (22)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-named-chunk-xref-23">Unit test of named chunk xref (23) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_should_find_xref_words</span><span class="p">(</span><span class="n">namedchunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of named chunk xref (23)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-named-chunk-properties-24">Unit test of named chunk properties (24) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_namedchunk_properties</span><span class="p">(</span><span class="n">namedchunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">mock_web</span><span class="p">()</span>
    <span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">web</span><span class="p">)</span>
    <span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">full_name</span>
    <span class="n">web</span><span class="o">.</span><span class="n">resolve_name</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;NamedChunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;OutputChunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;Chunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">namedchunk_instance</span><span class="o">.</span><span class="n">referencedBy</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of named chunk properties (24)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def namedchunk_noindent_instance():
    chunk = pyweb.NamedChunk(options=[&quot;-noindent&quot;, &quot;NoIndent Name...&quot;])
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit test of named chunk no-indent xref (26)`_
→ `Unit test of named chunk no-indent properties (27)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of NamedChunk with no indent (25)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-named-chunk-no-indent-xref-26">Unit test of named chunk no-indent xref (26) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_should_find_xref_words</span><span class="p">(</span><span class="n">namedchunk_noindent_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of named chunk no-indent xref (26)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-named-chunk-no-indent-properties-27">Unit test of named chunk no-indent properties (27) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_namedchunk_ni_properties</span><span class="p">(</span><span class="n">namedchunk_noindent_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">mock_web</span><span class="p">()</span>
    <span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">web</span><span class="p">)</span>
    <span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">full_name</span>
    <span class="n">web</span><span class="o">.</span><span class="n">resolve_name</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;NamedChunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;Chunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">namedchunk_noindent_instance</span><span class="o">.</span><span class="n">referencedBy</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of named chunk no-indent properties (27)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25)</a>.</p>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">OutputChunk</span></code> is created by a <code class="docutils literal notranslate"><span class="pre">&#64;o</span></code> command.
Since it’s named, it appears in the Web’s index.
Also, it is woven and tangled differently than anonymous chunks of text.
This defines the files of tangled code.</p>
<p class="rubric" id="unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def outputchunk_instance():
    chunk = pyweb.OutputChunk(options=[&quot;filename.out&quot;])
    chunk.comment_start = &quot;# &quot;
    chunk.comment_end = &quot;&quot;
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit Test output chunk xref (29)`_
→ `Unit Test output chunk properties (30)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of OutputChunk subclass (28)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p class="rubric" id="unit-test-output-chunk-xref-29">Unit Test output chunk xref (29) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_should_find_xref_words</span><span class="p">(</span><span class="n">outputchunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test output chunk xref (29)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28)</a>.</p>
</div>
<p class="rubric" id="unit-test-output-chunk-properties-30">Unit Test output chunk properties (30) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_outputchunk_properties</span><span class="p">(</span><span class="n">outputchunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">mock_web</span><span class="p">()</span>
    <span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">web</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">full_name</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="n">web</span><span class="o">.</span><span class="n">resolve_name</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;filename.out&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;OutputChunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;Chunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">outputchunk_instance</span><span class="o">.</span><span class="n">referencedBy</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test output chunk properties (30)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28)</a>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">NamedDocumentChunk</span></code> is a way to define substitutable text, similar to code, but it applies to document chunks.
It’s not clear how useful this really is.</p>
<p class="rubric" id="unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def named_documentchunk_instance():
    chunk = pyweb.NamedDocumentChunk(&quot;Document Chunk Name...&quot;)
    cmd = MockCommand()
    chunk.commands.append(cmd)
    chunk.def_names = [&quot;index&quot;, &quot;terms&quot;]
    return chunk

→ `Unit test named document chunk xref (32)`_
→ `Unit test named document chunk properties (33)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of NamedDocumentChunk subclass (31)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a>.</p>
</div>
<p class="rubric" id="unit-test-named-document-chunk-xref-32">Unit test named document chunk xref (32) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_should_find_xref_words</span><span class="p">(</span><span class="n">named_documentchunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">def_names</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test named document chunk xref (32)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31)</a>.</p>
</div>
<p class="rubric" id="unit-test-named-document-chunk-properties-33">Unit test named document chunk properties (33) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_nameddocument_chunk_properties</span><span class="p">(</span><span class="n">named_documentchunk_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">mock_web</span><span class="p">()</span>
    <span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">web</span><span class="p">)</span>
    <span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">full_name</span>
    <span class="n">web</span><span class="o">.</span><span class="n">resolve_name</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;NamedDocumentChunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">type_is</span><span class="p">(</span><span class="s2">&quot;OutputChunk&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">named_documentchunk_instance</span><span class="o">.</span><span class="n">referencedBy</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test named document chunk properties (33)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31)</a>.</p>
</div>
</section>
<section id="chunk-references-tests">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Chunk References Tests</a><a class="headerlink" href="#chunk-references-tests" title="Link to this heading">¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">Chunk</span></code>‘s “referencedBy” attribute is set by the <code class="docutils literal notranslate"><span class="pre">Web</span></code> during the initialization processing.</p>
<p>The test fixture is this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@d</span> <span class="n">main</span> <span class="o">@</span><span class="p">{</span> <span class="o">@&lt;</span> <span class="n">parent</span> <span class="o">@&gt;</span> <span class="o">@</span><span class="p">}</span>

<span class="nd">@d</span> <span class="n">parent</span> <span class="o">@</span><span class="p">{</span> <span class="o">@&lt;</span> <span class="n">sub</span> <span class="o">@&gt;</span> <span class="o">@</span><span class="p">}</span>

<span class="nd">@d</span> <span class="n">sub</span> <span class="o">@</span><span class="p">{</span> <span class="n">something</span> <span class="o">@</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sub</span></code> item is referenced by <code class="docutils literal notranslate"><span class="pre">parent</span></code> which is referenced by <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
<p>There are two broad styles of references:</p>
<ul class="simple">
<li><p>The simple reference is <code class="docutils literal notranslate"><span class="pre">sub</span></code> referenced by <code class="docutils literal notranslate"><span class="pre">parent</span></code>.</p></li>
<li><p>The transitive references are <code class="docutils literal notranslate"><span class="pre">sub</span></code> referenced by <code class="docutils literal notranslate"><span class="pre">parent</span></code> which is referenced by <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p></li>
</ul>
<p class="rubric" id="unit-test-of-chunk-references-34">Unit Test of Chunk References (34) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def main_parent_sub_chunks():
    web = MockWeb()
    main = pyweb.NamedChunk(&quot;Main&quot;, 1)
    main.referencedBy = None
    main.web = Mock(return_value=web)
    parent = pyweb.NamedChunk(&quot;Parent&quot;, 2)
    parent.referencedBy = main
    parent.web = Mock(return_value=web)
    chunk = pyweb.NamedChunk(&quot;Sub&quot;, 3)
    chunk.referencedBy = parent
    chunk.web = Mock(return_value=web)
    return main, parent, chunk

→ `Unit test of simple references (35)`_
→ `Unit test of two-level transitive reference (36)`_
→ `Unit test of one-level transitive reference (37)`_
→ `Unit test of top-level transitive reference (38)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Chunk References (34)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-simple-references-35">Unit test of simple references (35) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="n">main_parent_sub_chunks</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">main</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">chunk</span> <span class="o">=</span> <span class="n">main_parent_sub_chunks</span>
    <span class="k">assert</span> <span class="n">chunk</span><span class="o">.</span><span class="n">referencedBy</span> <span class="o">==</span> <span class="n">parent</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of simple references (35)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-two-level-transitive-reference-36">Unit test of two-level transitive reference (36) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_transitive_sub_sub</span><span class="p">(</span><span class="n">main_parent_sub_chunks</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">main</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">chunk</span> <span class="o">=</span> <span class="n">main_parent_sub_chunks</span>
    <span class="n">theList</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">transitive_referencedBy</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">theList</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">parent</span> <span class="o">==</span> <span class="n">theList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">main</span> <span class="o">==</span> <span class="n">theList</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of two-level transitive reference (36)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-one-level-transitive-reference-37">Unit test of one-level transitive reference (37) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_transitive_sub</span><span class="p">(</span><span class="n">main_parent_sub_chunks</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">main</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">chunk</span> <span class="o">=</span> <span class="n">main_parent_sub_chunks</span>
    <span class="n">theList</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">transitive_referencedBy</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">theList</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">main</span> <span class="o">==</span> <span class="n">theList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of one-level transitive reference (37)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-top-level-transitive-reference-38">Unit test of top-level transitive reference (38) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_transitive_top</span><span class="p">(</span><span class="n">main_parent_sub_chunks</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">main</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">chunk</span> <span class="o">=</span> <span class="n">main_parent_sub_chunks</span>
    <span class="n">theList</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">transitive_referencedBy</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">theList</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of top-level transitive reference (38)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a>.</p>
</div>
</section>
<section id="command-tests">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Command Tests</a><a class="headerlink" href="#command-tests" title="Link to this heading">¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> is a sequence of individual <code class="docutils literal notranslate"><span class="pre">Command</span></code> instances.
The invidual commands include all of the <code class="docutils literal notranslate"><span class="pre">&#64;x</span></code> commands,
plus the remaining blocks of text (or code.)</p>
<p class="rubric" id="unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Unit Test of Command superclass (40)`_
→ `Unit Test of TextCommand class to contain a document text block (41)`_
→ `Unit Test of CodeCommand class to contain a program source code block (44)`_
→ `Unit Test of XrefCommand superclass for all cross-reference commands (47)`_
→ `Unit Test of FileXrefCommand class for an output file cross-reference (48)`_
→ `Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)`_
→ `Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)`_
→ `Unit Test of ReferenceCommand class for chunk references (57)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Command class hierarchy (39)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p>This Command superclass is essentially an inteface definition; it has no real testable features.</p>
<p class="rubric" id="unit-test-of-command-superclass-40">Unit Test of Command superclass (40) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># No Tests</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Command superclass (40)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">TextCommand</span></code> object must be built from source text, interrogated, and emitted.
A <code class="docutils literal notranslate"><span class="pre">TextCommand</span></code> should not (generally) be created in a <code class="docutils literal notranslate"><span class="pre">Chunk</span></code>, it should
only be part of a <code class="docutils literal notranslate"><span class="pre">NamedChunk</span></code> or <code class="docutils literal notranslate"><span class="pre">OutputChunk</span></code>.</p>
<p class="rubric" id="unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def text_command_instances():
    cmd = pyweb.TextCommand(&quot;Some text &amp; words in the document\n    &quot;, (&quot;sample.w&quot;, 314))
    cmd2 = pyweb.TextCommand(&quot;No Indent\n&quot;, (&quot;sample.w&quot;, 271))
    return cmd, cmd2

→ `Unit test text command methods should work (42)`_
→ `Unit test text command tangle should error (43)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of TextCommand class to contain a document text block (41)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p class="rubric" id="unit-test-text-command-methods-should-work-42">Unit test text command methods should work (42) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_textcommand_methods</span><span class="p">(</span><span class="n">text_command_instances</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cmd</span><span class="p">,</span> <span class="n">cmd2</span> <span class="o">=</span> <span class="n">text_command_instances</span>
    <span class="k">assert</span> <span class="n">cmd</span><span class="o">.</span><span class="n">typeid</span><span class="o">.</span><span class="n">TextCommand</span>
    <span class="k">assert</span> <span class="p">(</span><span class="s2">&quot;sample.w&quot;</span><span class="p">,</span> <span class="mi">314</span><span class="p">)</span> <span class="o">==</span> <span class="n">cmd</span><span class="o">.</span><span class="n">location</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test text command methods should work (42)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41)</a>.</p>
</div>
<p class="rubric" id="unit-test-text-command-tangle-should-error-43">Unit test text command tangle should error (43) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_textcommamnd_tangle_should_error</span><span class="p">(</span><span class="n">text_command_instances</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cmd</span><span class="p">,</span> <span class="n">cmd2</span> <span class="o">=</span> <span class="n">text_command_instances</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">MockTangler</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">tangle</span><span class="p">(</span><span class="n">tangler</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">args</span> <span class="o">==</span> <span class="p">(</span>
        <span class="s2">&quot;attempt to tangle a text block (&#39;sample.w&#39;, 314) &#39;Some text &amp; words in the [...]&#39;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test text command tangle should error (43)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41)</a>.</p>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">CodeCommand</span></code> object is a <code class="docutils literal notranslate"><span class="pre">TextCommand</span></code> with different processing when it is emitted.
It represents a block of code in a <code class="docutils literal notranslate"><span class="pre">NamedChunk</span></code> or <code class="docutils literal notranslate"><span class="pre">OutputChunk</span></code>.</p>
<p class="rubric" id="unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def code_command_instance():
    cmd = pyweb.CodeCommand(&quot;Some code in the document\n    &quot;, (&quot;sample.w&quot;, 314))
    return cmd

→ `Unit test code command methods should work (45)`_
→ `Unit test code command tangle should error (46)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of CodeCommand class to contain a program source code block (44)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p class="rubric" id="unit-test-code-command-methods-should-work-45">Unit test code command methods should work (45) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_codecommand_methods</span><span class="p">(</span><span class="n">code_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">code_command_instance</span><span class="o">.</span><span class="n">typeid</span><span class="o">.</span><span class="n">CodeCommand</span>
    <span class="k">assert</span> <span class="p">(</span><span class="s2">&quot;sample.w&quot;</span><span class="p">,</span> <span class="mi">314</span><span class="p">)</span><span class="o">==</span> <span class="n">code_command_instance</span><span class="o">.</span><span class="n">location</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test code command methods should work (45)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44)</a>.</p>
</div>
<p class="rubric" id="unit-test-code-command-tangle-should-error-46">Unit test code command tangle should error (46) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_codecommand_tangle_should_work</span><span class="p">(</span><span class="n">code_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">MockTangler</span><span class="p">()</span>
    <span class="n">code_command_instance</span><span class="o">.</span><span class="n">tangle</span><span class="p">(</span><span class="n">tangler</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">codeBlock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">,</span> <span class="s1">&#39;Some code in the document</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test code command tangle should error (46)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44)</a>.</p>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">XrefCommand</span></code> class (if defined) would be abstract.
We could formalize this, but it seems easier to have a collection of <code class="docutils literal notranslate"><span class="pre">&#64;dataclass</span></code> definitions with a  <code class="docutils literal notranslate"><span class="pre">Union[...]</span></code> type hint.</p>
<p class="rubric" id="unit-test-of-xrefcommand-superclass-for-all-cross-reference-commands-47">Unit Test of XrefCommand superclass for all cross-reference commands (47) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># No Tests</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of XrefCommand superclass for all cross-reference commands (47)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">FileXrefCommand</span></code> command is expanded by a weaver to a list of <code class="docutils literal notranslate"><span class="pre">&#64;o</span></code> locations.</p>
<p class="rubric" id="unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def filexref_command_instance():
    web = Mock(files=sentinel.FILES)
    cmd = pyweb.FileXrefCommand((&quot;sample.w&quot;, 314))
    cmd.web = Mock(return_value=web)
    return cmd

→ `Unit test file xref command methods should work (49)`_
→ `Unit test file xref command tangle should error (50)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of FileXrefCommand class for an output file cross-reference (48)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p class="rubric" id="unit-test-file-xref-command-methods-should-work-49">Unit test file xref command methods should work (49) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_filexrefcommand_methods</span><span class="p">(</span><span class="n">filexref_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">filexref_command_instance</span><span class="o">.</span><span class="n">typeid</span><span class="o">.</span><span class="n">FileXrefCommand</span>
    <span class="k">assert</span> <span class="p">(</span><span class="s2">&quot;sample.w&quot;</span><span class="p">,</span> <span class="mi">314</span><span class="p">)</span> <span class="o">==</span> <span class="n">filexref_command_instance</span><span class="o">.</span><span class="n">location</span>
    <span class="k">assert</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">FILES</span> <span class="o">==</span> <span class="n">filexref_command_instance</span><span class="o">.</span><span class="n">files</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test file xref command methods should work (49)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48)</a>.</p>
</div>
<p class="rubric" id="unit-test-file-xref-command-tangle-should-error-50">Unit test file xref command tangle should error (50) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_filexrefcommand_tangle_should_fail</span><span class="p">(</span><span class="n">filexref_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">MockTangler</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Error</span><span class="p">):</span>
        <span class="n">filexref_command_instance</span><span class="o">.</span><span class="n">tangle</span><span class="p">(</span><span class="n">tangler</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test file xref command tangle should error (50)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48)</a>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MacroXrefCommand</span></code> command is expanded by a weaver to a list of all <code class="docutils literal notranslate"><span class="pre">&#64;d</span></code> locations.</p>
<p class="rubric" id="unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def macroxref_command_instance():
    web = Mock(macros=sentinel.MACROS)
    cmd = pyweb.MacroXrefCommand((&quot;sample.w&quot;, 314))
    cmd.web = Mock(return_value=web)
    return cmd

→ `Unit test macro xref command methods should work (52)`_
→ `Unit test macro xref command tangle shuould fail (53)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p class="rubric" id="unit-test-macro-xref-command-methods-should-work-52">Unit test macro xref command methods should work (52) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_macroxrefcommand_methods</span><span class="p">(</span><span class="n">macroxref_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">macroxref_command_instance</span><span class="o">.</span><span class="n">typeid</span><span class="o">.</span><span class="n">MacroXrefCommand</span>
    <span class="k">assert</span> <span class="p">(</span><span class="s2">&quot;sample.w&quot;</span><span class="p">,</span> <span class="mi">314</span><span class="p">)</span> <span class="o">==</span> <span class="n">macroxref_command_instance</span><span class="o">.</span><span class="n">location</span>
    <span class="k">assert</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">MACROS</span> <span class="o">==</span> <span class="n">macroxref_command_instance</span><span class="o">.</span><span class="n">macros</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test macro xref command methods should work (52)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</a>.</p>
</div>
<p class="rubric" id="unit-test-macro-xref-command-tangle-shuould-fail-53">Unit test macro xref command tangle shuould fail (53) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_macroxrefcommand_tangle_should_fail</span><span class="p">(</span><span class="n">macroxref_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">MockTangler</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Error</span><span class="p">):</span>
        <span class="n">macroxref_command_instance</span><span class="o">.</span><span class="n">tangle</span><span class="p">(</span><span class="n">tangler</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test macro xref command tangle shuould fail (53)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</a>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">UserIdXrefCommand</span></code> command is expanded by a weaver to a list of all <code class="docutils literal notranslate"><span class="pre">&#64;|</span></code> names.</p>
<p class="rubric" id="unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def useridxref_command_instance():
    web = Mock(userids=sentinel.USERIDS)
    cmd = pyweb.UserIdXrefCommand((&quot;sample.w&quot;, 314))
    cmd.web = Mock(return_value=web)
    return cmd

→ `Unit test userid xref command methods should work (55)`_
→ `Unit test userid xref command tangle should fail (56)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p class="rubric" id="unit-test-userid-xref-command-methods-should-work-55">Unit test userid xref command methods should work (55) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_useridxref_command_methods</span><span class="p">(</span><span class="n">useridxref_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">useridxref_command_instance</span><span class="o">.</span><span class="n">typeid</span><span class="o">.</span><span class="n">UserIdXrefCommand</span>
    <span class="k">assert</span> <span class="p">(</span><span class="s2">&quot;sample.w&quot;</span><span class="p">,</span> <span class="mi">314</span><span class="p">)</span> <span class="o">==</span> <span class="n">useridxref_command_instance</span><span class="o">.</span><span class="n">location</span>
    <span class="k">assert</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">USERIDS</span> <span class="o">==</span> <span class="n">useridxref_command_instance</span><span class="o">.</span><span class="n">userids</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test userid xref command methods should work (55)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</a>.</p>
</div>
<p class="rubric" id="unit-test-userid-xref-command-tangle-should-fail-56">Unit test userid xref command tangle should fail (56) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_useridxref_command_tangle_should_fail</span><span class="p">(</span><span class="n">useridxref_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">MockTangler</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Error</span><span class="p">):</span>
        <span class="n">useridxref_command_instance</span><span class="o">.</span><span class="n">tangle</span><span class="p">(</span><span class="n">tangler</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test userid xref command tangle should fail (56)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</a>.</p>
</div>
<p>Instances of the <code class="docutils literal notranslate"><span class="pre">Reference</span></code> command reflect <code class="docutils literal notranslate"><span class="pre">&#64;&lt;</span> <span class="pre">name</span> <span class="pre">&#64;&gt;</span></code> locations in code.
These require a context when tangling.
The context helps provide the required indentation.
They can’t be simply tangled, since the expand to code that may (transitively) have more references to more code.</p>
<p>The document here is a mock-up of the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@d</span> <span class="n">name</span> <span class="o">@</span><span class="p">{</span> <span class="o">@&lt;</span><span class="n">Some</span> <span class="n">Name</span><span class="o">@&gt;</span> <span class="o">@</span><span class="p">}</span>

<span class="nd">@d</span> <span class="n">Some</span> <span class="n">Name</span> <span class="o">@</span><span class="p">{</span> <span class="n">code</span> <span class="o">@</span><span class="p">}</span>
</pre></div>
</div>
<p>This is a single <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> with a reference to another <code class="docutils literal notranslate"><span class="pre">Chunk</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Web</span></code> class <code class="docutils literal notranslate"><span class="pre">__post_init__</span></code> sets the <code class="docutils literal notranslate"><span class="pre">references</span></code> and <code class="docutils literal notranslate"><span class="pre">referencedBy</span></code> attributes of each <code class="docutils literal notranslate"><span class="pre">Chunk</span></code>.</p>
<p class="rubric" id="unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Unit Test reference command methods should work (58)`_
→ `Unit Test reference command tangle should work (59)`_

@pytest.fixture
def reference_command_instance():
    cmd = pyweb.ReferenceCommand(&quot;Some Name&quot;, (&quot;sample.w&quot;, 314))
    chunk = mock_chunk_instance(&quot;name&quot;, 123, (&quot;sample.w&quot;, 456), commands=[cmd])
    referenced_chunk = Mock(seq=sentinel.SEQUENCE, references=1, referencedBy=chunk, commands=[Mock()])
    web = Mock(
        resolve_name=Mock(return_value=sentinel.FULL_NAME),
        resolve_chunk=Mock(return_value=[referenced_chunk])
    )
    cmd.web = Mock(return_value=web)
    return cmd
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of ReferenceCommand class for chunk references (57)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a>.</p>
</div>
<p class="rubric" id="unit-test-reference-command-methods-should-work-58">Unit Test reference command methods should work (58) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_reference_command_methods</span><span class="p">(</span><span class="n">reference_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">reference_command_instance</span><span class="o">.</span><span class="n">typeid</span><span class="o">.</span><span class="n">ReferenceCommand</span>
    <span class="k">assert</span> <span class="p">(</span><span class="s2">&quot;sample.w&quot;</span><span class="p">,</span> <span class="mi">314</span><span class="p">)</span> <span class="o">==</span> <span class="n">reference_command_instance</span><span class="o">.</span><span class="n">location</span>
    <span class="k">assert</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">FULL_NAME</span> <span class="o">==</span> <span class="n">reference_command_instance</span><span class="o">.</span><span class="n">full_name</span>
    <span class="k">assert</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">SEQUENCE</span> <span class="o">==</span> <span class="n">reference_command_instance</span><span class="o">.</span><span class="n">seq</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test reference command methods should work (58)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57)</a>.</p>
</div>
<p class="rubric" id="unit-test-reference-command-tangle-should-work-59">Unit Test reference command tangle should work (59) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_reference_command_tangle_should_work</span><span class="p">(</span><span class="n">reference_command_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">MockTangler</span><span class="p">()</span>
    <span class="n">reference_command_instance</span><span class="o">.</span><span class="n">tangle</span><span class="p">(</span><span class="n">tangler</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">)</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">reference_command_instance</span><span class="o">.</span><span class="n">web</span><span class="p">()</span>
    <span class="n">web</span><span class="o">.</span><span class="n">resolve_chunk</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;Some Name&quot;</span><span class="p">)</span>
    <span class="n">tangler</span><span class="o">.</span><span class="n">reference_names</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;Some Name&#39;</span><span class="p">)</span>
    <span class="n">referenced_chunk</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">resolve_chunk</span><span class="p">(</span><span class="s2">&quot;Some Name&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">referenced_chunk</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tangle</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">tangler</span><span class="p">,</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">TARGET</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test reference command tangle should work (59)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57)</a>.</p>
</div>
</section>
<section id="web-tests">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Web Tests</a><a class="headerlink" href="#web-tests" title="Link to this heading">¶</a></h3>
<p>We create a <code class="docutils literal notranslate"><span class="pre">Web</span></code> instance with mocked <code class="docutils literal notranslate"><span class="pre">Chunks</span></code> and mocked <code class="docutils literal notranslate"><span class="pre">Commands</span></code>.
The point is to test the <code class="docutils literal notranslate"><span class="pre">Web</span></code> features in isolation.
This is tricky because some state is recorded in the <code class="docutils literal notranslate"><span class="pre">Chunk</span></code> instances.</p>
<p class="rubric" id="unit-test-of-web-class-60">Unit Test of Web class (60) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def web_instance():
    c1 = mock_chunk_instance(&quot;c1&quot;, 1, (&quot;sample.w&quot;, 11))
    c1.type_is = Mock(side_effect = lambda n: n == &quot;Chunk&quot;)
    c1.referencedBy = None
    c1.name = None

    c2 = mock_chunk_instance(&quot;c2&quot;, 2, (&quot;sample.w&quot;, 22))
    c2.type_is = Mock(side_effect = lambda n: n == &quot;OutputChunk&quot;)
    c2.commands = [Mock()]
    c2.commands[0].name = &quot;c3...&quot;
    c2.commands[0].typeid = Mock(ReferenceCommand=True, TextCommand=False, CodeCommand=False)
    c2.referencedBy = None

    c3 = mock_chunk_instance(&quot;c3 has a long name&quot;, 3, (&quot;sample.w&quot;, 33))
    c3.type_is = Mock(side_effect = lambda n: n == &quot;NamedChunk&quot;)
    c3.referencedBy = None
    c3.def_names = [&quot;userid&quot;]

    raw_chunks = [c1, c2, c3]
    web = pyweb.Web(raw_chunks)
    return web

→ `Unit test web name resolution (61)`_
→ `Unit test web iteration over chunks (62)`_
→ `Unit test web tangle when valid (63)`_
→ `Unit test web weave when valid (64)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Web class (60)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p class="rubric" id="unit-test-web-name-resolution-61">Unit test web name resolution (61) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_web_name_resolution</span><span class="p">(</span><span class="n">web_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">web_instance</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s2">&quot;c1&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;c1&quot;</span>
    <span class="k">assert</span> <span class="n">web_instance</span><span class="o">.</span><span class="n">resolve_chunk</span><span class="p">(</span><span class="s2">&quot;c2&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">web_instance</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">assert</span> <span class="n">web_instance</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s2">&quot;c1...&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;c1&quot;</span>
    <span class="k">assert</span> <span class="n">web_instance</span><span class="o">.</span><span class="n">resolve_name</span><span class="p">(</span><span class="s2">&quot;c3...&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;c3 has a long name&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test web name resolution (61)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</p>
</div>
<p class="rubric" id="unit-test-web-iteration-over-chunks-62">Unit test web iteration over chunks (62) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_chunks_should_iterate</span><span class="p">(</span><span class="n">web_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">web_instance</span>
    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">web_instance</span><span class="o">.</span><span class="n">chunks</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">c2</span><span class="p">]</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">file_iter</span><span class="p">())</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">c3</span><span class="p">]</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">macro_iter</span><span class="p">())</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">def_name</span><span class="o">=</span><span class="s2">&quot;userid&quot;</span><span class="p">,</span> <span class="n">chunk</span><span class="o">=</span><span class="n">c3</span><span class="p">)]</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">userid_iter</span><span class="p">())</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">c2</span><span class="p">]</span> <span class="o">==</span> <span class="n">web</span><span class="o">.</span><span class="n">files</span>
    <span class="k">assert</span> <span class="p">[</span>
            <span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">def_list</span><span class="o">=</span><span class="p">[</span><span class="n">c2</span><span class="p">]),</span>
            <span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c3 has a long name&quot;</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;c3 has a long name&quot;</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">def_list</span><span class="o">=</span><span class="p">[</span><span class="n">c3</span><span class="p">])</span>
        <span class="p">]</span> <span class="o">==</span> <span class="n">web</span><span class="o">.</span><span class="n">macros</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">userid</span><span class="o">=</span><span class="s1">&#39;userid&#39;</span><span class="p">,</span> <span class="n">ref_list</span><span class="o">=</span><span class="p">[</span><span class="n">c3</span><span class="p">])]</span> <span class="o">==</span> <span class="n">web</span><span class="o">.</span><span class="n">userids</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">c2</span><span class="p">]</span> <span class="o">==</span> <span class="n">web</span><span class="o">.</span><span class="n">no_reference</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">[]</span> <span class="o">==</span> <span class="n">web</span><span class="o">.</span><span class="n">multi_reference</span><span class="p">()</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test web iteration over chunks (62)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</p>
</div>
<p>This exercises the entire interface used by tangling.
All details are pushed down to <code class="docutils literal notranslate"><span class="pre">`command.tangle()</span></code> methods for each command in each chunk.</p>
<p class="rubric" id="unit-test-web-tangle-when-valid-63">Unit test web tangle when valid (63) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_valid_web_should_tangle</span><span class="p">(</span><span class="n">web_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">web</span> <span class="o">=</span> <span class="n">web_instance</span>
    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">web_instance</span><span class="o">.</span><span class="n">chunks</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">c2</span><span class="p">],</span> <span class="n">web</span><span class="o">.</span><span class="n">files</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test web tangle when valid (63)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</p>
</div>
<p>This the entire interface used by weaving is the <code class="docutils literal notranslate"><span class="pre">web.chunks</span></code> attribute, which is implicitly tested in several places.
All chunk-specific details are pushed down to unique processing based on <code class="docutils literal notranslate"><span class="pre">chunk.type_is</span></code>.</p>
<p class="rubric" id="unit-test-web-weave-when-valid-64">Unit test web weave when valid (64) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># No tests</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test web weave when valid (64)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a>.</p>
</div>
</section>
<section id="webreader-tests">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">WebReader Tests</a><a class="headerlink" href="#webreader-tests" title="Link to this heading">¶</a></h3>
<p>Generally, this is tested separately through the functional tests.
Those tests each present source files to be processed by the
WebReader.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">WebReader</span></code> is poorly designed for unit testing.
The various chunk and command classes are part of the <code class="docutils literal notranslate"><span class="pre">WebReader</span></code>, and
new classes cannot be injected gracefully.</p>
<p>Exacerbating this are two special cases: the <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;(expr&#64;)</span></code> constructs
are evaluated immediately, and don’t create commands.</p>
<p class="rubric" id="unit-test-of-webreader-class-65">Unit Test of WebReader class (65) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tested via functional tests</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of WebReader class (65)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p>Some lower-level units: specifically the tokenizer and the option parser.</p>
<p class="rubric" id="unit-test-of-webreader-class-66">Unit Test of WebReader class (66) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">tokenizer</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;@@ word @{ @[ @&lt; @&gt;</span><span class="se">\n</span><span class="s2">@] @} @i @| @m @f @u @( @)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tokenizer</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tokenizer</span>

<span class="k">def</span> <span class="nf">test_should_split_tokens</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">28</span>
    <span class="k">assert</span> <span class="n">tokens</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;@@&#39;</span><span class="p">,</span> <span class="s1">&#39; word &#39;</span><span class="p">,</span> <span class="s1">&#39;@{&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@[&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="s1">&#39;@&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;@]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@}&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@i&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@|&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@m&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="s1">&#39;@f&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@u&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@(&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;@)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">lineNumber</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of WebReader class (66)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-webreader-class-67">Unit Test of WebReader class (67) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_output_chunk_with_options_should_parse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">text1</span> <span class="o">=</span> <span class="s2">&quot; -start /* -end */ -noweave something.css &quot;</span>
    <span class="n">chunk1</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">OutputChunk</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">text1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">asdict</span><span class="p">(</span><span class="n">chunk1</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
        <span class="s1">&#39;commands&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;comment_end&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comment_start&#39;</span><span class="p">:</span> <span class="s1">&#39;# &#39;</span><span class="p">,</span>
        <span class="s1">&#39;def_names&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;indent&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">chunk1</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;something.css&#39;</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;-start&#39;</span><span class="p">,</span> <span class="s1">&#39;/*&#39;</span><span class="p">,</span> <span class="s1">&#39;-end&#39;</span><span class="p">,</span> <span class="s1">&#39;*/&#39;</span><span class="p">,</span> <span class="s1">&#39;-noweave&#39;</span><span class="p">,</span> <span class="s1">&#39;something.css&#39;</span><span class="p">],</span>
        <span class="s1">&#39;referencedBy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;weave&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;web&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_output_chunk_without_options_should_parse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">text2</span> <span class="o">=</span> <span class="s2">&quot; something.py &quot;</span>
    <span class="n">chunk2</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">OutputChunk</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">text2</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">asdict</span><span class="p">(</span><span class="n">chunk2</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
        <span class="s1">&#39;commands&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;comment_end&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;comment_start&#39;</span><span class="p">:</span> <span class="s1">&#39;# &#39;</span><span class="p">,</span>
        <span class="s1">&#39;def_names&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;indent&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">chunk2</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;something.py&#39;</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;something.py&#39;</span><span class="p">],</span>
        <span class="s1">&#39;referencedBy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;weave&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;web&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_namedchunk_with_options_should_parse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">text1</span> <span class="o">=</span> <span class="s2">&quot; -indent the name of test1 chunk... &quot;</span>
    <span class="n">chunk1</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">NamedChunk</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">text1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">asdict</span><span class="p">(</span><span class="n">chunk1</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
        <span class="s1">&#39;commands&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;comment_end&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;comment_start&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;def_names&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;indent&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">chunk1</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;the name of test1 chunk...&#39;</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;-indent&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="s1">&#39;chunk...&#39;</span><span class="p">],</span>
        <span class="s1">&#39;referencedBy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;weave&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;web&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_namedchunk_without_options_should_parse</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">text2</span> <span class="o">=</span> <span class="s2">&quot; the name of test2 chunk... &quot;</span>
    <span class="n">chunk2</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">NamedChunk</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">text2</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">asdict</span><span class="p">(</span><span class="n">chunk2</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
        <span class="s1">&#39;commands&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;comment_end&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;comment_start&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;def_names&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;indent&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">chunk2</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;the name of test2 chunk...&#39;</span><span class="p">,</span>
        <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="s1">&#39;chunk...&#39;</span><span class="p">],</span>
        <span class="s1">&#39;referencedBy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;seq&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;weave&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;web&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of WebReader class (67)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p>Testing the <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> case and one of the <code class="docutils literal notranslate"><span class="pre">&#64;(expr&#64;)</span></code> cases.
Need to test all the available variables: <code class="docutils literal notranslate"><span class="pre">os.path</span></code>, <code class="docutils literal notranslate"><span class="pre">os.getcwd</span></code>, <code class="docutils literal notranslate"><span class="pre">os.name</span></code>, <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">datetime</span></code>, <code class="docutils literal notranslate"><span class="pre">platform</span></code>,
<code class="docutils literal notranslate"><span class="pre">theWebReader</span></code>, <code class="docutils literal notranslate"><span class="pre">theFile</span></code>, <code class="docutils literal notranslate"><span class="pre">thisApplication</span></code>, <code class="docutils literal notranslate"><span class="pre">version</span></code>, <code class="docutils literal notranslate"><span class="pre">theLocation</span></code>.</p>
<p>Note the escape processing has a lot of <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> characters in it.</p>
<p class="rubric" id="unit-test-of-webreader-class-68">Unit Test of WebReader class (68) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ex1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Escape: @@ Example&quot;</span><span class="p">,</span> <span class="s2">&quot;Escape: @ Example&quot;</span><span class="p">)</span>
<span class="n">ex2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Filename: @(theFile@)&quot;</span><span class="p">,</span> <span class="s2">&quot;Filename: sample.w&quot;</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span> <span class="n">ex2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">chunks_text</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Chunk</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="nb">input</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">WebReader</span><span class="p">()</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;sample.w&quot;</span><span class="p">),</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">expected</span>

<span class="k">def</span> <span class="nf">test_web_reader_builds_escape_chunk</span><span class="p">(</span><span class="n">chunks_text</span><span class="p">):</span>
    <span class="n">chunks</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">chunks_text</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of WebReader class (68)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
</section>
<section id="action-tests">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Action Tests</a><a class="headerlink" href="#action-tests" title="Link to this heading">¶</a></h3>
<p>Each <code class="docutils literal notranslate"><span class="pre">Action</span></code> class is tested separately.
This requires a aequence of some mocks.
The behaviors include loading, tangling, weaving.</p>
<p class="rubric" id="unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Unit test of Action Sequence class (70)`_
→ `Unit test of LoadAction class (76)`_
→ `Unit test of TangleAction class (74)`_
→ `Unit test of WeaverAction class (72)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Action class hierarchy (69)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p><strong>TODO:</strong> Replace with Mock</p>
<p class="rubric" id="unit-test-of-action-sequence-class-70">Unit test of Action Sequence class (70) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def action_sequence_instance():
    a1 = MagicMock(name=&quot;Action1&quot;)
    a2 = MagicMock(name=&quot;Action2&quot;)
    action = pyweb.ActionSequence(&quot;TwoSteps&quot;, [a1, a2])
    action.web = mock_web()
    return action

→ `Unit test of action sequence (71)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of Action Sequence class (70)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-action-sequence-71">Unit test of action sequence (71) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_action_sequence_execute_both</span><span class="p">(</span><span class="n">action_sequence_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">action_sequence_instance</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">)</span>
    <span class="n">action_sequence_instance</span><span class="o">.</span><span class="n">opSequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">)</span>
    <span class="n">action_sequence_instance</span><span class="o">.</span><span class="n">opSequence</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sentinel</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of action sequence (71)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-sequence-class-70">Unit test of Action Sequence class (70)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-weaveraction-class-72">Unit test of WeaverAction class (72) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def action_weave_instance(tmp_path):
    action = pyweb.WeaveAction()
    web = mock_web()
    weaver = MockWeaver()
    options = argparse.Namespace(
        theWeaver=weaver,
        output=tmp_path,
        web=web,
        weaver=&#39;rst&#39;,
    )
    return action, options

→ `Unit test WeaveAction should call Weaver (73)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of WeaverAction class (72)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</p>
</div>
<p class="rubric" id="unit-test-weaveaction-should-call-weaver-73">Unit test WeaveAction should call Weaver (73) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_weave_action</span><span class="p">(</span><span class="n">action_weave_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">action</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">action_weave_instance</span>
    <span class="n">action</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">theWeaver</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">web</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test WeaveAction should call Weaver (73)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-weaveraction-class-72">Unit test of WeaverAction class (72)</a>.</p>
</div>
<p class="rubric" id="unit-test-of-tangleaction-class-74">Unit test of TangleAction class (74) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def action_tangle_instance(tmp_path):
    action = pyweb.TangleAction()
    web = mock_web()
    tangler = MockTangler()
    options = argparse.Namespace(
        theTangler=tangler,
        output=tmp_path,
        tangler_line_numbers=False,
        web=web,
    )
    return action, options

→ `Unit test TangleAction should call Tangler (75)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of TangleAction class (74)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</p>
</div>
<p class="rubric" id="unit-test-tangleaction-should-call-tangler-75">Unit test TangleAction should call Tangler (75) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_tangle_action</span><span class="p">(</span><span class="n">action_tangle_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">action</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">action_tangle_instance</span>
    <span class="n">action</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">theTangler</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">web</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test TangleAction should call Tangler (75)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-tangleaction-class-74">Unit test of TangleAction class (74)</a>.</p>
</div>
<p>The mocked <code class="docutils literal notranslate"><span class="pre">WebReader</span></code> must provide an <code class="docutils literal notranslate"><span class="pre">errors</span></code> property to the <code class="docutils literal notranslate"><span class="pre">LoadAction</span></code> instance.</p>
<p class="rubric" id="unit-test-of-loadaction-class-76">Unit test of LoadAction class (76) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>@pytest.fixture
def action_loader_instance(tmp_path):
    action = pyweb.LoadAction()
    web = MockWeb()
    webReader = Mock(
            name=&quot;WebReader&quot;,
            errors=0,
            load=Mock(return_value=[])
        )
    options = argparse.Namespace(
        webReader=webReader,
        source_path=tmp_path,
        command=&quot;@&quot;,
        permitList=[],
        output=tmp_path,
    )
    return action, options

→ `Unit test LoadAction should call WebReader (77)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test of LoadAction class (76)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a>.</p>
</div>
<p class="rubric" id="unit-test-loadaction-should-call-webreader-77">Unit test LoadAction should call WebReader (77) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_loader_action</span><span class="p">(</span><span class="n">action_loader_instance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">action</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">action_loader_instance</span>
    <span class="n">action</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">webReader</span><span class="o">.</span><span class="n">load</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">source_path</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit test LoadAction should call WebReader (77)</em>.
Used by     → <a class="reference internal" href="#unit-test-of-loadaction-class-76">Unit test of LoadAction class (76)</a>.</p>
</div>
</section>
<section id="application-tests">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Application Tests</a><a class="headerlink" href="#application-tests" title="Link to this heading">¶</a></h3>
<p>As with testing WebReader, this requires extensive mocking.
It’s easier to simply run the various use cases.</p>
<p><strong>TODO:</strong> Test Application class</p>
<p class="rubric" id="unit-test-of-application-class-78">Unit Test of Application class (78) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO Test Application class</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test of Application class (78)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
</section>
<section id="overheads-and-main-script">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Overheads and Main Script</a><a class="headerlink" href="#overheads-and-main-script" title="Link to this heading">¶</a></h3>
<p>The boilerplate code for unit testing is the following.</p>
<p class="rubric" id="unit-test-overheads-imports-etc-79">Unit Test overheads: imports, etc. (79) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Unit tests.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">asdict</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">SimpleNamespace</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">TextIO</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">Mock</span><span class="p">,</span> <span class="n">call</span><span class="p">,</span> <span class="n">MagicMock</span><span class="p">,</span> <span class="n">sentinel</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">import</span> <span class="nn">pyweb</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test overheads: imports, etc. (79)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
<p>One more overhead is a function to cleanup output files.</p>
<p class="rubric" id="unit-test-overheads-imports-etc-80">Unit Test overheads: imports, etc. (80) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rstrip_lines</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Unit Test overheads: imports, etc. (80)</em>.
Used by     → <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>.</p>
</div>
</section>
</section>
<section id="functional-testing">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Functional Testing</a><a class="headerlink" href="#functional-testing" title="Link to this heading">¶</a></h2>
<p>There are three broad areas of functional testing.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tests-for-loading">Tests for Loading</a></p></li>
<li><p><a class="reference internal" href="#tests-for-tangling">Tests for Tangling</a></p></li>
<li><p><a class="reference internal" href="#tests-for-weaving">Tests for Weaving</a></p></li>
</ul>
<p>Because of some overlaps in fixture definition, there is also a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file that contains the shared test fixtures.</p>
<section id="shared-fixtures">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Shared Fixtures</a><a class="headerlink" href="#shared-fixtures" title="Link to this heading">¶</a></h3>
<p class="rubric" id="tests-conftest-py-81">tests/conftest.py (81) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>import io
from pathlib import Path
from typing import TextIO
import pytest
import pyweb

→ `Fixture for Source, WebReader, and Path (82)`_

→ `Fixture for Source, WebReader, Path, with an Include (83)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>tests/conftest.py (81)</em>.</p>
</div>
<p>These fixtures require a “marker” set in each test that uses them.
The marker provides needed parameter values.</p>
<p>Many of the parsing test cases have a common setup shown in this fixture.</p>
<p class="rubric" id="fixture-for-source-webreader-and-path-82">Fixture for Source, WebReader, and Path (82) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">source_path</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">TextIO</span><span class="p">,</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">WebReader</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get_closest_marker</span><span class="p">(</span><span class="s2">&quot;text_name&quot;</span><span class="p">)</span>
    <span class="n">text</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">args</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">source</span><span class="p">,</span> <span class="n">path</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Fixture for Source, WebReader, and Path (82)</em>.
Used by     → <a class="reference internal" href="#tests-conftest-py-81">tests/conftest.py (81)</a>.</p>
</div>
<p>Some of the more complex cases inject an Include file.
This requires a somewhat more complicated fixture.</p>
<p class="rubric" id="fixture-for-source-webreader-path-with-an-include-83">Fixture for Source, WebReader, Path, with an Include (83) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">source_path_incl</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">TextIO</span><span class="p">,</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">WebReader</span><span class="p">,</span> <span class="n">Path</span><span class="p">]:</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get_closest_marker</span><span class="p">(</span><span class="s2">&quot;text_name_incl&quot;</span><span class="p">)</span>
    <span class="n">text</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">incl_text</span><span class="p">,</span> <span class="n">incl_name</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">args</span>
    <span class="n">include_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="n">incl_name</span>
    <span class="n">include_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">incl_text</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">source</span><span class="p">,</span> <span class="n">path</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Fixture for Source, WebReader, Path, with an Include (83)</em>.
Used by     → <a class="reference internal" href="#tests-conftest-py-81">tests/conftest.py (81)</a>.</p>
</div>
<p>Additionally, a <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> is also required to register the marks used to provide test parameters to a fixture.
This also sets a logging format to assure the log messages have the expected format.</p>
<p class="rubric" id="pytest-ini-84">pytest.ini (84) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span>
    <span class="n">text_name</span><span class="p">:</span> <span class="n">a</span> <span class="n">blob</span> <span class="n">of</span> <span class="n">text</span><span class="p">,</span> <span class="n">the</span> <span class="n">path</span> <span class="n">name</span>
    <span class="n">text_name_incl</span><span class="p">:</span> <span class="n">a</span> <span class="n">blob</span> <span class="n">of</span> <span class="n">text</span><span class="p">,</span> <span class="n">a</span> <span class="n">path</span><span class="p">,</span> <span class="n">a</span> <span class="n">blob</span> <span class="n">of</span> <span class="n">include</span> <span class="n">text</span><span class="p">,</span> <span class="n">the</span> <span class="n">include</span> <span class="n">path</span>
<span class="n">log_format</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">levelname</span><span class="p">)</span><span class="n">s</span><span class="p">:</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="n">s</span><span class="p">:</span><span class="o">%</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="n">s</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>pytest.ini (84)</em>.</p>
</div>
</section>
<section id="tests-for-loading">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Tests for Loading</a><a class="headerlink" href="#tests-for-loading" title="Link to this heading">¶</a></h3>
<p>We need to be able to load a web from one or more source files.</p>
<p class="rubric" id="tests-test-loader-py-85">tests/test_loader.py (85) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Load Test overheads: imports, etc. (90)`_

→ `Load Test error handling with a few common syntax errors (86)`_

→ `Load Test include processing with syntax errors (88)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>tests/test_loader.py (85)</em>.</p>
</div>
<p>There are a lot of specific parsing exceptions which can be thrown.
We’ll cover most of the cases with a quick check for a failure to  find an expected next token.</p>
<p class="rubric" id="load-test-error-handling-with-a-few-common-syntax-errors-86">Load Test error handling with a few common syntax errors (86) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Sample Document 1 with correct and incorrect syntax (87)`_

@pytest.mark.text_name(test1_w, &quot;test1.w&quot;)
def test_error_should_count_1(source_path, caplog):
    source, file_path = source_path
    rdr = pyweb.WebReader()

    with caplog.at_level(level=&#39;WARN&#39;, logger=&#39;WebReader&#39;) as log_capture:
        chunks = rdr.load(file_path, source)
    assert 3 == rdr.errors
    assert caplog.text.splitlines() == [
        &quot;ERROR:WebReader:At (&#39;test1.w&#39;, 8): expected {&#39;@{&#39;}, found &#39;@o&#39;&quot;,
        &quot;ERROR:WebReader:Extra &#39;@{&#39; (possibly missing chunk name) near (&#39;test1.w&#39;, 9)&quot;,
        &quot;ERROR:WebReader:Extra &#39;@{&#39; (possibly missing chunk name) near (&#39;test1.w&#39;, 9)&quot;
    ]
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Load Test error handling with a few common syntax errors (86)</em>.
Used by     → <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>.</p>
</div>
<p class="rubric" id="sample-document-1-with-correct-and-incorrect-syntax-87">Sample Document 1 with correct and incorrect syntax (87) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test1_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Some anonymous chunk</span>
<span class="s2">@o test1.tmp</span>
<span class="s2">@{@&lt;part1@&gt;</span>
<span class="s2">@&lt;part2@&gt;</span>
<span class="s2">@}@@</span>
<span class="s2">@d part1 @{This is part 1.@}</span>
<span class="s2">Okay, now for an error.</span>
<span class="s2">@o show how @o commands work</span>
<span class="s2">@{ @{ @] @]</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Sample Document 1 with correct and incorrect syntax (87)</em>.
Used by     → <a class="reference internal" href="#load-test-error-handling-with-a-few-common-syntax-errors-86">Load Test error handling with a few common syntax errors (86)</a>.</p>
</div>
<p>All of the parsing exceptions should be correctly identified with any included file.
We’ll cover most of the cases with a quick check for a failure to find an expected next token.</p>
<p>In order to test the include file processing, we have to actually create a temporary file.
It’s hard to mock the include processing, since it’s a nested instance of the tokenizer.</p>
<p class="rubric" id="load-test-include-processing-with-syntax-errors-88">Load Test include processing with syntax errors (88) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Sample Document 8 and the file it includes (89)`_

@pytest.mark.text_name_incl(test8_w, &quot;test8.w&quot;, test8_inc_w, &#39;test8_inc.w&#39;)
def test_error_should_count_2(caplog, tmp_path, source_path_incl) -&gt; None:
    source, file_path = source_path_incl
    rdr = pyweb.WebReader()
    with caplog.at_level(level=&#39;WARN&#39;, logger=&#39;WebReader&#39;) as log_capture:
        chunks = rdr.load(file_path, source)
    assert 1 == rdr.errors
    assert caplog.text.splitlines() == [
        &quot;ERROR:WebReader:At (&#39;test8_inc.w&#39;, 4): end of input, {&#39;@{&#39;, &#39;@[&#39;} not found&quot;,
        &quot;ERROR:WebReader:Errors in included file &#39;test8_inc.w&#39;, output is incomplete.&quot;
    ]
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Load Test include processing with syntax errors (88)</em>.
Used by     → <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>.</p>
</div>
<p>The sample document must reference the correct name that will be given to the included document by <code class="docutils literal notranslate"><span class="pre">setUp</span></code>.</p>
<p class="rubric" id="sample-document-8-and-the-file-it-includes-89">Sample Document 8 and the file it includes (89) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test8_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Some anonymous chunk.</span>
<span class="s2">@d title @[the title of this document, defined with @@[ and @@]@]</span>
<span class="s2">A reference to @&lt;title@&gt;.</span>
<span class="s2">@i test8_inc.w</span>
<span class="s2">A final anonymous chunk from test8.w</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">test8_inc_w</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;A chunk from test8a.w</span>
<span class="s2">And now for an error - incorrect syntax in an included file!</span>
<span class="s2">@d yap</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Sample Document 8 and the file it includes (89)</em>.
Used by     → <a class="reference internal" href="#load-test-include-processing-with-syntax-errors-88">Load Test include processing with syntax errors (88)</a>.</p>
</div>
<p>The overheads for a Python test.</p>
<p class="rubric" id="load-test-overheads-imports-etc-90">Load Test overheads: imports, etc. (90) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Loader and parsing tests.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.handlers</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TextIO</span>

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">import</span> <span class="nn">pyweb</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Load Test overheads: imports, etc. (90)</em>.
Used by     → <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>.</p>
</div>
</section>
<section id="tests-for-tangling">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Tests for Tangling</a><a class="headerlink" href="#tests-for-tangling" title="Link to this heading">¶</a></h3>
<p>We need to be able to tangle a web.</p>
<p class="rubric" id="tests-test-tangler-py-91">tests/test_tangler.py (91) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Tangle Test overheads: imports, etc. (99)`_

→ `Tangle Test semantic errors 2-5 (94)`_

→ `Tangle Test fixture to refactor common setup (92)`_
→ `Tangle Test function to execute cases (93)`_

→ `Tangle Test semantic error 6 (95)`_
→ `Tangle Test include example 7 (97)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>tests/test_tangler.py (91)</em>.</p>
</div>
<p>Tangling test cases have a common setup and teardown shown in this fixture.
Since tangling must produce a file, it’s helpful to remove the file that gets created.
The essential test case is to load and attempt to tangle, checking the exceptions raised.</p>
<p>Since these test cases are all very similar, we can use a parameterized fixture to execute a single test function repeatedly.</p>
<p class="rubric" id="tangle-test-fixture-to-refactor-common-setup-92">Tangle Test fixture to refactor common setup (92) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tangle_cases</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">test2_w</span><span class="p">,</span> <span class="s2">&quot;test2.w&quot;</span><span class="p">,</span> <span class="s2">&quot;Attempt to tangle an undefined Chunk, &#39;part2&#39;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">test3_w</span><span class="p">,</span> <span class="s2">&quot;test3.w&quot;</span><span class="p">,</span> <span class="s2">&quot;Illegal tangling of a cross reference command.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">test4_w</span><span class="p">,</span> <span class="s2">&quot;test4.w&quot;</span><span class="p">,</span> <span class="s2">&quot;No full name for &#39;part1...&#39;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">test5_w</span><span class="p">,</span> <span class="s2">&quot;test5.w&quot;</span><span class="p">,</span> <span class="s2">&quot;Ambiguous abbreviation &#39;part1...&#39;, matches [&#39;part1a&#39;, &#39;part1b&#39;]&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">tangle_cases</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">source_reader_path_tangler_error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">TextIO</span><span class="p">,</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">WebReader</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tangler</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="n">text</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">rdr</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">WebReader</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="n">name</span>
    <span class="n">tangler</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Tangler</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">source</span><span class="p">,</span> <span class="n">rdr</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">tangler</span><span class="p">,</span> <span class="n">error</span>
    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">tmp_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.tmp&quot;</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Tangle Test fixture to refactor common setup (92)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</p>
</div>
<p class="rubric" id="tangle-test-function-to-execute-cases-93">Tangle Test function to execute cases (93) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_tangle_and_check_exception</span><span class="p">(</span><span class="n">source_reader_path_tangler_error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">rdr</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">tangler</span><span class="p">,</span> <span class="n">exception_text</span> <span class="o">=</span> <span class="n">source_reader_path_tangler_error</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">pyweb</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">rdr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">web</span> <span class="o">=</span> <span class="n">pyweb</span><span class="o">.</span><span class="n">Web</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
        <span class="n">tangler</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">web</span><span class="p">)</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Should not tangle&quot;</span>
    <span class="k">assert</span> <span class="n">exception_text</span> <span class="o">==</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Tangle Test function to execute cases (93)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</p>
</div>
<p class="rubric" id="tangle-test-semantic-errors-2-5-94">Tangle Test semantic errors 2-5 (94) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test2_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Some anonymous chunk</span>
<span class="s2">@o test2.tmp</span>
<span class="s2">@{@&lt;part1@&gt;</span>
<span class="s2">@&lt;part2@&gt;</span>
<span class="s2">@}@@</span>
<span class="s2">@d part1 @{This is part 1.@}</span>
<span class="s2">Okay, now for some errors: no part2!</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">test3_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Some anonymous chunk</span>
<span class="s2">@o test3.tmp</span>
<span class="s2">@{@&lt;part1@&gt;</span>
<span class="s2">@&lt;part2@&gt;</span>
<span class="s2">@}@@</span>
<span class="s2">@d part1 @{This is part 1.@}</span>
<span class="s2">@d part2 @{This is part 2, with an illegal: @f.@}</span>
<span class="s2">Okay, now for some errors: attempt to tangle a cross-reference!</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">test4_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Some anonymous chunk</span>
<span class="s2">@o test4.tmp</span>
<span class="s2">@{@&lt;part1...@&gt;</span>
<span class="s2">@&lt;part2@&gt;</span>
<span class="s2">@}@@</span>
<span class="s2">@d part1... @{This is part 1.@}</span>
<span class="s2">@d part2 @{This is part 2.@}</span>
<span class="s2">Okay, now for some errors: attempt to weave but no full name for part1....</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">test5_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Some anonymous chunk</span>
<span class="s2">@o test5.tmp</span>
<span class="s2">@{@&lt;part1...@&gt;</span>
<span class="s2">@&lt;part2@&gt;</span>
<span class="s2">@}@@</span>
<span class="s2">@d part1a @{This is part 1 a.@}</span>
<span class="s2">@d part1b @{This is part 1 b.@}</span>
<span class="s2">@d part2 @{This is part 2.@}</span>
<span class="s2">Okay, now for some errors: part1... is ambiguous</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Tangle Test semantic errors 2-5 (94)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</p>
</div>
<p>The remaining errors have unique features, and can’t use the generic test function.
The first of these looks for a number of warnings, instead of an exception.</p>
<p class="rubric" id="tangle-test-semantic-error-6-95">Tangle Test semantic error 6 (95) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Sample Document 6 (96)`_

@pytest.mark.text_name(test6_w, &quot;test6.w&quot;)
def test_tangle_warnings(tmp_path, source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    tangler = pyweb.Tangler(tmp_path)
    tangler.emit(web)
    print(web.no_reference())
    assert 1 == len(web.no_reference())
    assert 1 == len(web.multi_reference())
    assert {&#39;part1a&#39;, &#39;part1...&#39;} == tangler.reference_names
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Tangle Test semantic error 6 (95)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</p>
</div>
<p class="rubric" id="sample-document-6-96">Sample Document 6 (96) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test6_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Some anonymous chunk</span>
<span class="s2">@o test6.tmp</span>
<span class="s2">@{@&lt;part1...@&gt;</span>
<span class="s2">@&lt;part1a@&gt;</span>
<span class="s2">@}@@</span>
<span class="s2">@d part1a @{This is part 1 a.@}</span>
<span class="s2">@d part2 @{This is part 2.@}</span>
<span class="s2">Okay, now for some warnings:</span>
<span class="s2">- part1 has multiple references.</span>
<span class="s2">- part2 is unreferenced.</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Sample Document 6 (96)</em>.
Used by     → <a class="reference internal" href="#tangle-test-semantic-error-6-95">Tangle Test semantic error 6 (95)</a>.</p>
</div>
<p class="rubric" id="tangle-test-include-example-7-97">Tangle Test include example 7 (97) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Sample Document 7 and it&#39;s included file (98)`_

@pytest.mark.text_name_incl(test7_w, &quot;test7.w&quot;, test7_inc_w, &#39;test7_inc.tmp&#39;)
def test_tangle_should_include(tmp_path, source_path_incl) -&gt; None:
    source, file_path = source_path_incl
    rdr = pyweb.WebReader()

    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    tangler = pyweb.Tangler(tmp_path)
    tangler.emit(web)
    assert 5 == len(web.chunks)
    assert test7_inc_w == web.chunks[3].commands[0].text
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Tangle Test include example 7 (97)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</p>
</div>
<p class="rubric" id="sample-document-7-and-it-s-included-file-98">Sample Document 7 and it’s included file (98) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test7_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Some anonymous chunk.</span>
<span class="s2">@d title @[the title of this document, defined with @@[ and @@]@]</span>
<span class="s2">A reference to @&lt;title@&gt;.</span>
<span class="s2">@i test7_inc.tmp</span>
<span class="s2">A final anonymous chunk from test7.w</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">test7_inc_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The test7a.tmp chunk for test7.w&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Sample Document 7 and it’s included file (98)</em>.
Used by     → <a class="reference internal" href="#tangle-test-include-example-7-97">Tangle Test include example 7 (97)</a>.</p>
</div>
<p class="rubric" id="tangle-test-overheads-imports-etc-99">Tangle Test overheads: imports, etc. (99) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Tangler tests exercise various semantic features.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">TextIO</span>

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">import</span> <span class="nn">pyweb</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Tangle Test overheads: imports, etc. (99)</em>.
Used by     → <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>.</p>
</div>
</section>
<section id="tests-for-weaving">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Tests for Weaving</a><a class="headerlink" href="#tests-for-weaving" title="Link to this heading">¶</a></h3>
<p>We need to be able to weave a document from one or more source files.</p>
<p class="rubric" id="tests-test-weaver-py-100">tests/test_weaver.py (100) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Weave Test overheads: imports, etc. (107)`_

→ `Weave Test references and definitions (101)`_
→ `Weave Test evaluation of expressions (105)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>tests/test_weaver.py (100)</em>.</p>
</div>
<p>Weaving test cases have a common setup shown in this fixture.</p>
<p class="rubric" id="weave-test-references-and-definitions-101">Weave Test references and definitions (101) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Sample Document 0 (102)`_
→ `Expected Output 0 (103)`_


@pytest.mark.text_name(test0_w, &quot;test0.w&quot;)
def test_load_should_createChunks(source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    assert 3 == len(chunks)

@pytest.mark.text_name(test0_w, &quot;test0.w&quot;)
def test_weave_should_create_html(tmp_path, source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    web.web_path = file_path
    doc = pyweb.Weaver( )
    doc.set_markup(&quot;html&quot;)
    doc.output = tmp_path
    doc.emit(web)
    assert doc.target_path == file_path.with_suffix(&quot;.html&quot;)
    actual = doc.target_path.read_text()
    assert test0_expected_html == actual

@pytest.mark.text_name(test0_w, &quot;test0.w&quot;)
def test_weave_should_create_debug(tmp_path, source_path) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    web.web_path = file_path
    doc = pyweb.Weaver( )
    doc.set_markup(&quot;debug&quot;)
    doc.output = tmp_path
    doc.emit(web)
    assert doc.target_path == file_path.with_suffix(&quot;.debug&quot;)
    actual = doc.target_path.read_text()
    assert test0_expected_debug == actual
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Weave Test references and definitions (101)</em>.
Used by     → <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>.</p>
</div>
<p class="rubric" id="sample-document-0-102">Sample Document 0 (102) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test0_w</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;html&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;link rel=&quot;StyleSheet&quot; href=&quot;pyweb.css&quot; type=&quot;text/css&quot; /&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">@&lt;some code@&gt;</span>

<span class="s2">@d some code</span>
<span class="s2">@{</span>
<span class="s2">def fastExp(n, p):</span>
<span class="s2">    r = 1</span>
<span class="s2">    while p &gt; 0:</span>
<span class="s2">        if p%2 == 1: return n*fastExp(n,p-1)</span>
<span class="s2">    return n*n*fastExp(n,p/2)</span>

<span class="s2">for i in range(24):</span>
<span class="s2">    fastExp(2,i)</span>
<span class="s2">@}</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Sample Document 0 (102)</em>.
Used by     → <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a>.</p>
</div>
<p class="rubric" id="expected-output-0-103">Expected Output 0 (103) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test0_expected_html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;html&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;link rel=&quot;StyleSheet&quot; href=&quot;pyweb.css&quot; type=&quot;text/css&quot; /&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">&amp;rarr;&lt;a href=&quot;#pyweb_1&quot;&gt;&lt;em&gt;some code (1)&lt;/em&gt;&lt;/a&gt;</span>


<span class="s2">&lt;a name=&quot;pyweb_1&quot;&gt;&lt;/a&gt;</span>
<span class="s2">&lt;!--line number (&#39;test0.w&#39;, 10)--&gt;</span>
<span class="s2">&lt;p&gt;&lt;em&gt;some code (1)&lt;/em&gt; =&lt;/p&gt;</span>
<span class="s2">&lt;pre&gt;&lt;code&gt;</span>
<span class="s2">def fastExp(n, p):</span>
<span class="s2">    r = 1</span>
<span class="s2">    while p &amp;gt; 0:</span>
<span class="s2">        if p%2 == 1: return n*fastExp(n,p-1)</span>
<span class="s2">    return n*n*fastExp(n,p/2)</span>

<span class="s2">for i in range(24):</span>
<span class="s2">    fastExp(2,i)</span>

<span class="s2">&lt;/code&gt;&lt;/pre&gt;</span>
<span class="s2">&lt;p&gt;&amp;#8718; &lt;em&gt;some code (1)&lt;/em&gt;.</span>

<span class="s2">&lt;/p&gt;</span>

<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Expected Output 0 (103)</em>.
Used by     → <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a>.</p>
</div>
<p class="rubric" id="expected-output-0-104">Expected Output 0 (104) +=</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test0_expected_debug</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;text: TextCommand(text=</span><span class="se">\&#39;</span><span class="s1">&lt;html&gt;</span><span class="se">\\</span><span class="s1">n&lt;head&gt;</span><span class="se">\\</span><span class="s1">n    &lt;link rel=&quot;StyleSheet&quot; href=&quot;pyweb.css&quot; type=&quot;text/css&quot; /&gt;</span><span class="se">\\</span><span class="s1">n&lt;/head&gt;</span><span class="se">\\</span><span class="s1">n&lt;body&gt;</span><span class="se">\\</span><span class="s1">n</span><span class="se">\&#39;</span><span class="s1">, location=(</span><span class="se">\&#39;</span><span class="s1">test0.w</span><span class="se">\&#39;</span><span class="s1">, 1))</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="s2">&quot;ref: ReferenceCommand(name=&#39;some code&#39;, location=(&#39;test0.w&#39;, 6))&quot;</span>
    <span class="s2">&quot;text: TextCommand(text=&#39;</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n&#39;, location=(&#39;test0.w&#39;, 7))</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;begin_code: NamedChunk(options=[&#39;some&#39;, &#39;code&#39;], name=&#39;some code&#39;, seq=1, commands=[CodeCommand(text=&#39;</span><span class="se">\\</span><span class="s2">ndef fastExp(n, p):</span><span class="se">\\</span><span class="s2">n    r = 1</span><span class="se">\\</span><span class="s2">n    while p &gt; 0:</span><span class="se">\\</span><span class="s2">n        if p%2 == 1: return n*fastExp(n,p-1)</span><span class="se">\\</span><span class="s2">n    return n*n*fastExp(n,p/2)</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nfor i in range(24):</span><span class="se">\\</span><span class="s2">n    fastExp(2,i)</span><span class="se">\\</span><span class="s2">n&#39;, location=(&#39;test0.w&#39;, 10))], def_names=[], initial=True, comment_start=None, comment_end=None, weave=True, style=None, references=0, referencedBy=None, logger=&lt;Logger Chunk (INFO)&gt;, indent=None)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;code: CodeCommand(text=&#39;</span><span class="se">\\</span><span class="s2">ndef fastExp(n, p):</span><span class="se">\\</span><span class="s2">n    r = 1</span><span class="se">\\</span><span class="s2">n    while p &gt; 0:</span><span class="se">\\</span><span class="s2">n        if p%2 == 1: return n*fastExp(n,p-1)</span><span class="se">\\</span><span class="s2">n    return n*n*fastExp(n,p/2)</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nfor i in range(24):</span><span class="se">\\</span><span class="s2">n    fastExp(2,i)</span><span class="se">\\</span><span class="s2">n&#39;, location=(&#39;test0.w&#39;, 10))</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;end_code: NamedChunk(options=[&#39;some&#39;, &#39;code&#39;], name=&#39;some code&#39;, seq=1, commands=[CodeCommand(text=&#39;</span><span class="se">\\</span><span class="s2">ndef fastExp(n, p):</span><span class="se">\\</span><span class="s2">n    r = 1</span><span class="se">\\</span><span class="s2">n    while p &gt; 0:</span><span class="se">\\</span><span class="s2">n        if p%2 == 1: return n*fastExp(n,p-1)</span><span class="se">\\</span><span class="s2">n    return n*n*fastExp(n,p/2)</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nfor i in range(24):</span><span class="se">\\</span><span class="s2">n    fastExp(2,i)</span><span class="se">\\</span><span class="s2">n&#39;, location=(&#39;test0.w&#39;, 10))], def_names=[], initial=True, comment_start=None, comment_end=None, weave=True, style=None, references=0, referencedBy=None, logger=&lt;Logger Chunk (INFO)&gt;, indent=None)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;text: TextCommand(text=&#39;</span><span class="se">\\</span><span class="s2">n&lt;/body&gt;</span><span class="se">\\</span><span class="s2">n&lt;/html&gt;</span><span class="se">\\</span><span class="s2">n&#39;, location=(&#39;test0.w&#39;, 19))&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Expected Output 0 (104)</em>.
Used by     → <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a>.</p>
</div>
<p>Note that this requires a mocked <code class="docutils literal notranslate"><span class="pre">time</span></code> module in order
to properly provide a consistent output from <code class="docutils literal notranslate"><span class="pre">time.asctime()</span></code>.</p>
<p class="rubric" id="weave-test-evaluation-of-expressions-105">Weave Test evaluation of expressions (105) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Sample Document 9 (106)`_

from unittest.mock import Mock

@pytest.fixture()
def mock_time(monkeypatch):
    mock_time = Mock(asctime=Mock(return_value=&quot;mocked time&quot;))
    monkeypatch.setattr(pyweb, &quot;time&quot;, mock_time)
    return mock_time

@pytest.mark.text_name(test9_w, &quot;test9.w&quot;)
def test_should_evaluate(tmp_path, source_path, mock_time) -&gt; None:
    source, file_path = source_path
    rdr = pyweb.WebReader()
    chunks = rdr.load(file_path, source)
    web = pyweb.Web(chunks)
    web.web_path = file_path
    doc = pyweb.Weaver( )
    doc.set_markup(&quot;html&quot;)
    doc.output = tmp_path
    doc.emit(web)
    assert doc.target_path == file_path.with_suffix(&quot;.html&quot;)
    actual = doc.target_path.read_text().splitlines()
    #print(actual)
    assert &quot;An anonymous chunk.&quot; == actual[0]
    assert &quot;Time = mocked time&quot; == actual[1]
    assert &quot;File = (&#39;test9.w&#39;, 3)&quot; == actual[2]
    assert &#39;Version = 3.3&#39; == actual[3]
    assert f&#39;CWD = {os.getcwd()}&#39; == actual[4]
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Weave Test evaluation of expressions (105)</em>.
Used by     → <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>.</p>
</div>
<p class="rubric" id="sample-document-9-106">Sample Document 9 (106) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test9_w</span><span class="o">=</span> <span class="s2">&quot;&quot;&quot;An anonymous chunk.</span>
<span class="s2">Time = @(time.asctime()@)</span>
<span class="s2">File = @(theLocation@)</span>
<span class="s2">Version = @(__version__@)</span>
<span class="s2">CWD = @(os.path.realpath(&#39;.&#39;)@)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Sample Document 9 (106)</em>.
Used by     → <a class="reference internal" href="#weave-test-evaluation-of-expressions-105">Weave Test evaluation of expressions (105)</a>.</p>
</div>
<p class="rubric" id="weave-test-overheads-imports-etc-107">Weave Test overheads: imports, etc. (107) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Weaver tests exercise various weaving features.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span>

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">import</span> <span class="nn">pyweb</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Weave Test overheads: imports, etc. (107)</em>.
Used by     → <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>.</p>
</div>
</section>
</section>
<section id="additional-scripts-testing">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Additional Scripts Testing</a><a class="headerlink" href="#additional-scripts-testing" title="Link to this heading">¶</a></h2>
<p>We provide these two additional scripts; effectively command-line short-cuts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tangle.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weave.py</span></code></p></li>
</ul>
<p>These isolate specific actions, making it slightly easier to provide a new subclass or macro configuration.
These need their own test cases.</p>
<p>This gives us the following outline for the script testing.</p>
<p class="rubric" id="tests-test-scripts-py-108">tests/test_scripts.py (108) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>→ `Script Test overheads: imports, etc. (113)`_

→ `Sample web file to test with (109)`_

→ `Fixture for test cases (110)`_

→ `Test of weave.py (111)`_

→ `Test of tangle.py (112)`_
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>tests/test_scripts.py (108)</em>.</p>
</div>
<section id="sample-web-file">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Sample Web File</a><a class="headerlink" href="#sample-web-file" title="Link to this heading">¶</a></h3>
<p>This is a web <code class="docutils literal notranslate"><span class="pre">.w</span></code> file to create a document and tangle a small file.</p>
<p class="rubric" id="sample-web-file-to-test-with-109">Sample web file to test with (109) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;!doctype html&gt;</span>
<span class="s2">    &lt;html lang=&quot;en&quot;&gt;</span>
<span class="s2">      &lt;head&gt;</span>
<span class="s2">        &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="s2">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span>
<span class="s2">        &lt;title&gt;Sample HTML web file&lt;/title&gt;</span>
<span class="s2">      &lt;/head&gt;</span>
<span class="s2">      &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Sample HTML web file&lt;/h1&gt;</span>
<span class="s2">        &lt;p&gt;We&#39;re avoiding using Python specifically.</span>
<span class="s2">        This hints at other languages being tangled by this tool.&lt;/p&gt;</span>

<span class="s2">    @o sample_tangle.code</span>
<span class="s2">    @{</span>
<span class="s2">    @&lt;preamble@&gt;</span>
<span class="s2">    @&lt;body@&gt;</span>
<span class="s2">    @}</span>

<span class="s2">    @d preamble</span>
<span class="s2">    @{</span>
<span class="s2">    #include &lt;stdio.h&gt;</span>
<span class="s2">    @}</span>

<span class="s2">    @d body</span>
<span class="s2">    @{</span>
<span class="s2">    int main() {</span>
<span class="s2">        println(&quot;Hello, World!&quot;)</span>
<span class="s2">    }</span>
<span class="s2">    @}</span>

<span class="s2">      &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Sample web file to test with (109)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</p>
</div>
</section>
<section id="fixture-for-test-cases">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Fixture for test cases</a><a class="headerlink" href="#fixture-for-test-cases" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sample_path</span></code> is a consistent test fixture for both test cases.
The sample <code class="docutils literal notranslate"><span class="pre">test_sample.w</span></code> file is created and removed after the test.</p>
<p class="rubric" id="fixture-for-test-cases-110">Fixture for test cases (110) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">sample_path</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="n">sample_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;test_sample.w&quot;</span>
    <span class="n">sample_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">sample_path</span>
    <span class="n">sample_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">clean_lines</span><span class="p">(</span><span class="n">first</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strips blank lines and trailing whitespace that (generally) aren&#39;t problems when weaving.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">non_blank</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">non_blank</span><span class="p">,</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">first</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())))</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Fixture for test cases (110)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</p>
</div>
</section>
<section id="weave-script-test">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Weave Script Test</a><a class="headerlink" href="#weave-script-test" title="Link to this heading">¶</a></h3>
<p>We check the weave output to be sure it’s what we expected.
This could be altered to check a few features of the weave file rather than compare the entire file.</p>
<p class="rubric" id="test-of-weave-py-111">Test of weave.py (111) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">expected_weave</span><span class="p">(</span><span class="n">sample_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">expected_weave</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;!doctype html&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;html lang=&quot;en&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;head&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;meta charset=&quot;utf-8&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;title&gt;Sample HTML web file&lt;/title&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/head&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;body&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;h1&gt;Sample HTML web file&lt;/h1&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s2">&quot;    &lt;p&gt;We&#39;re avoiding using Python specifically.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;    This hints at other languages being tangled by this tool.&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;div class=&quot;card&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;div class=&quot;card-header&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;a type=&quot;button&quot; class=&quot;btn btn-primary&quot; name=&quot;pyweb_1&quot;&gt;&lt;/a&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s2">&quot;    &lt;!--line number (&#39;test_sample.w&#39;, 16)--&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;    &lt;p class=&quot;small&quot;&gt;&lt;em&gt;sample_tangle.code (1)&lt;/em&gt; =&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;   &lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;div class=&quot;card-body&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;pre&gt;&lt;code&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&amp;rarr;&lt;a href=&quot;#pyweb_2&quot;&gt;&lt;em&gt;preamble (2)&lt;/em&gt;&lt;/a&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&amp;rarr;&lt;a href=&quot;#pyweb_3&quot;&gt;&lt;em&gt;body (3)&lt;/em&gt;&lt;/a&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;/code&gt;&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;div class=&quot;card-footer&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;p&gt;&amp;#8718; &lt;em&gt;sample_tangle.code (1)&lt;/em&gt;.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;div class=&quot;card&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;div class=&quot;card-header&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;a type=&quot;button&quot; class=&quot;btn btn-primary&quot; name=&quot;pyweb_2&quot;&gt;&lt;/a&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s2">&quot;    &lt;!--line number (&#39;test_sample.w&#39;, 22)--&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;    &lt;p class=&quot;small&quot;&gt;&lt;em&gt;preamble (2)&lt;/em&gt; =&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;   &lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;div class=&quot;card-body&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;pre&gt;&lt;code&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;#include &amp;lt;stdio.h&amp;gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;/code&gt;&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;div class=&quot;card-footer&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;p&gt;&amp;#8718; &lt;em&gt;preamble (2)&lt;/em&gt;.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;div class=&quot;card&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;div class=&quot;card-header&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;a type=&quot;button&quot; class=&quot;btn btn-primary&quot; name=&quot;pyweb_3&quot;&gt;&lt;/a&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s2">&quot;    &lt;!--line number (&#39;test_sample.w&#39;, 27)--&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s1">&#39;    &lt;p class=&quot;small&quot;&gt;&lt;em&gt;body (3)&lt;/em&gt; =&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;   &lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;div class=&quot;card-body&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;pre&gt;&lt;code&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;int main() {</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    println(&amp;quot;Hello, World!&amp;quot;)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;    &lt;/code&gt;&lt;/pre&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;div class=&quot;card-footer&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;p&gt;&amp;#8718; &lt;em&gt;body (3)&lt;/em&gt;.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/p&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;  &lt;/body&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;&lt;/html&gt;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">expected_weave</span>

<span class="k">def</span> <span class="nf">test_weave</span><span class="p">(</span><span class="n">sample_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">expected_weave</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">sample_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">)</span>

    <span class="n">weave</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">sample_path</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
    <span class="n">output</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">clean_lines</span><span class="p">(</span><span class="n">expected_weave</span><span class="p">)</span> <span class="o">==</span> <span class="n">clean_lines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Test of weave.py (111)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</p>
</div>
</section>
<section id="tangle-script-test">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Tangle Script Test</a><a class="headerlink" href="#tangle-script-test" title="Link to this heading">¶</a></h3>
<p>We check the tangle output to be sure it’s what we expected.</p>
<p class="rubric" id="test-of-tangle-py-112">Test of tangle.py (112) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expected_tangle</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    #include &lt;stdio.h&gt;</span>


<span class="s2">    int main() {</span>
<span class="s2">        println(&quot;Hello, World!&quot;)</span>
<span class="s2">    }</span>

<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_tangle</span><span class="p">(</span><span class="n">sample_path</span><span class="p">):</span>
    <span class="c1"># Name comes from ``@o`` command</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">sample_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;sample_tangle.code&quot;</span>

    <span class="n">tangle</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">sample_path</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
    <span class="n">output</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">clean_lines</span><span class="p">(</span><span class="n">expected_tangle</span><span class="p">)</span> <span class="o">==</span> <span class="n">clean_lines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Test of tangle.py (112)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</p>
</div>
</section>
<section id="overheads">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Overheads</a><a class="headerlink" href="#overheads" title="Link to this heading">¶</a></h3>
<p>These are the common Python overheads required for testing.
Import some modules used in general.
Import <code class="docutils literal notranslate"><span class="pre">pytest</span></code> to provide helpful definitions.
Import the modules under test.</p>
<p class="rubric" id="script-test-overheads-imports-etc-113">Script Test overheads: imports, etc. (113) =</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Script tests.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">import</span> <span class="nn">tangle</span>
<span class="kn">import</span> <span class="nn">weave</span>
</pre></div>
</div>
<div class="small docutils container">
<p>∎ <em>Script Test overheads: imports, etc. (113)</em>.
Used by     → <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a>.</p>
</div>
<p>Run this test with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PYTHONPATH</span><span class="o">=</span>src<span class="w"> </span>pytest<span class="w"> </span>tests/test_scripts.py
</pre></div>
</div>
<p>This will put the local <code class="docutils literal notranslate"><span class="pre">src</span></code> directory on the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>, so the modules under test can be imported.</p>
</section>
</section>
<section id="indices">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Indices</a><a class="headerlink" href="#indices" title="Link to this heading">¶</a></h2>
<section id="files">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Files</a><a class="headerlink" href="#files" title="Link to this heading">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">tests/test_unit.py<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#tests-test-unit-py-1">tests/test_unit.py (1)</a>:tests/conftest.py:
→ <a class="reference internal" href="#tests-conftest-py-81">tests/conftest.py (81)</a>:pytest.ini:
→ <a class="reference internal" href="#pytest-ini-84">pytest.ini (84)</a>:tests/test_loader.py:
→ <a class="reference internal" href="#tests-test-loader-py-85">tests/test_loader.py (85)</a>:tests/test_tangler.py:
→ <a class="reference internal" href="#tests-test-tangler-py-91">tests/test_tangler.py (91)</a>:tests/test_weaver.py:
→ <a class="reference internal" href="#tests-test-weaver-py-100">tests/test_weaver.py (100)</a>:tests/test_scripts.py:
→ <a class="reference internal" href="#tests-test-scripts-py-108">tests/test_scripts.py (108)</a></p>
</dd>
</dl>
</section>
<section id="macros">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Macros</a><a class="headerlink" href="#macros" title="Link to this heading">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Expected Output 0<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#expected-output-0-103">Expected Output 0 (103)</a>, → <a class="reference internal" href="#expected-output-0-104">Expected Output 0 (104)</a></p>
</dd>
<dt class="field-even">Fixture for Source, WebReader, Path, with an Include<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#fixture-for-source-webreader-path-with-an-include-83">Fixture for Source, WebReader, Path, with an Include (83)</a></p>
</dd>
<dt class="field-odd">Fixture for Source, WebReader, and Path<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#fixture-for-source-webreader-and-path-82">Fixture for Source, WebReader, and Path (82)</a></p>
</dd>
<dt class="field-even">Fixture for test cases<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#fixture-for-test-cases-110">Fixture for test cases (110)</a></p>
</dd>
<dt class="field-odd">Load Test error handling with a few common syntax errors<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#load-test-error-handling-with-a-few-common-syntax-errors-86">Load Test error handling with a few common syntax errors (86)</a></p>
</dd>
<dt class="field-even">Load Test include processing with syntax errors<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#load-test-include-processing-with-syntax-errors-88">Load Test include processing with syntax errors (88)</a></p>
</dd>
<dt class="field-odd">Load Test overheads<span class="colon">:</span></dt>
<dd class="field-odd"><p>imports, etc.:
→ <a class="reference internal" href="#load-test-overheads-imports-etc-90">Load Test overheads: imports, etc. (90)</a></p>
</dd>
<dt class="field-even">Sample Document 0<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#sample-document-0-102">Sample Document 0 (102)</a></p>
</dd>
<dt class="field-odd">Sample Document 1 with correct and incorrect syntax<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#sample-document-1-with-correct-and-incorrect-syntax-87">Sample Document 1 with correct and incorrect syntax (87)</a></p>
</dd>
<dt class="field-even">Sample Document 6<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#sample-document-6-96">Sample Document 6 (96)</a></p>
</dd>
<dt class="field-odd">Sample Document 7 and it’s included file<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#sample-document-7-and-it-s-included-file-98">Sample Document 7 and it’s included file (98)</a></p>
</dd>
<dt class="field-even">Sample Document 8 and the file it includes<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#sample-document-8-and-the-file-it-includes-89">Sample Document 8 and the file it includes (89)</a></p>
</dd>
<dt class="field-odd">Sample Document 9<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#sample-document-9-106">Sample Document 9 (106)</a></p>
</dd>
<dt class="field-even">Sample web file to test with<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#sample-web-file-to-test-with-109">Sample web file to test with (109)</a></p>
</dd>
<dt class="field-odd">Script Test overheads<span class="colon">:</span></dt>
<dd class="field-odd"><p>imports, etc.:
→ <a class="reference internal" href="#script-test-overheads-imports-etc-113">Script Test overheads: imports, etc. (113)</a></p>
</dd>
<dt class="field-even">Tangle Test fixture to refactor common setup<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#tangle-test-fixture-to-refactor-common-setup-92">Tangle Test fixture to refactor common setup (92)</a></p>
</dd>
<dt class="field-odd">Tangle Test function to execute cases<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#tangle-test-function-to-execute-cases-93">Tangle Test function to execute cases (93)</a></p>
</dd>
<dt class="field-even">Tangle Test include example 7<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#tangle-test-include-example-7-97">Tangle Test include example 7 (97)</a></p>
</dd>
<dt class="field-odd">Tangle Test overheads<span class="colon">:</span></dt>
<dd class="field-odd"><p>imports, etc.:
→ <a class="reference internal" href="#tangle-test-overheads-imports-etc-99">Tangle Test overheads: imports, etc. (99)</a></p>
</dd>
<dt class="field-even">Tangle Test semantic error 6<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#tangle-test-semantic-error-6-95">Tangle Test semantic error 6 (95)</a></p>
</dd>
<dt class="field-odd">Tangle Test semantic errors 2-5<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#tangle-test-semantic-errors-2-5-94">Tangle Test semantic errors 2-5 (94)</a></p>
</dd>
<dt class="field-even">Test of tangle.py<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#test-of-tangle-py-112">Test of tangle.py (112)</a></p>
</dd>
<dt class="field-odd">Test of weave.py<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#test-of-weave-py-111">Test of weave.py (111)</a></p>
</dd>
<dt class="field-even">Unit Test Mock Chunk class<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-mock-chunk-class-4">Unit Test Mock Chunk class (4)</a></p>
</dd>
<dt class="field-odd">Unit Test of Action class hierarchy<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-action-class-hierarchy-69">Unit Test of Action class hierarchy (69)</a></p>
</dd>
<dt class="field-even">Unit Test of Application class<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-application-class-78">Unit Test of Application class (78)</a></p>
</dd>
<dt class="field-odd">Unit Test of Chunk References<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-chunk-references-34">Unit Test of Chunk References (34)</a></p>
</dd>
<dt class="field-even">Unit Test of Chunk class hierarchy<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-chunk-class-hierarchy-14">Unit Test of Chunk class hierarchy (14)</a></p>
</dd>
<dt class="field-odd">Unit Test of Chunk construction<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-chunk-construction-19">Unit Test of Chunk construction (19)</a></p>
</dd>
<dt class="field-even">Unit Test of Chunk interrogation<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-chunk-interrogation-20">Unit Test of Chunk interrogation (20)</a></p>
</dd>
<dt class="field-odd">Unit Test of Chunk properties<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-chunk-properties-21">Unit Test of Chunk properties (21)</a></p>
</dd>
<dt class="field-even">Unit Test of Chunk superclass<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-chunk-superclass-15">Unit Test of Chunk superclass (15)</a>, → <a class="reference internal" href="#unit-test-of-chunk-superclass-16">Unit Test of Chunk superclass (16)</a>, → <a class="reference internal" href="#unit-test-of-chunk-superclass-17">Unit Test of Chunk superclass (17)</a>, → <a class="reference internal" href="#unit-test-of-chunk-superclass-18">Unit Test of Chunk superclass (18)</a></p>
</dd>
<dt class="field-odd">Unit Test of CodeCommand class to contain a program source code block<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-codecommand-class-to-contain-a-program-source-code-block-44">Unit Test of CodeCommand class to contain a program source code block (44)</a></p>
</dd>
<dt class="field-even">Unit Test of Command class hierarchy<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-command-class-hierarchy-39">Unit Test of Command class hierarchy (39)</a></p>
</dd>
<dt class="field-odd">Unit Test of Command superclass<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-command-superclass-40">Unit Test of Command superclass (40)</a></p>
</dd>
<dt class="field-even">Unit Test of Emitter Superclass<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-emitter-superclass-3">Unit Test of Emitter Superclass (3)</a></p>
</dd>
<dt class="field-odd">Unit Test of Emitter class hierarchy<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-emitter-class-hierarchy-2">Unit Test of Emitter class hierarchy (2)</a></p>
</dd>
<dt class="field-even">Unit Test of FileXrefCommand class for an output file cross-reference<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-filexrefcommand-class-for-an-output-file-cross-reference-48">Unit Test of FileXrefCommand class for an output file cross-reference (48)</a></p>
</dd>
<dt class="field-odd">Unit Test of HTML macros in Weaver<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-html-macros-in-weaver-10">Unit Test of HTML macros in Weaver (10)</a></p>
</dd>
<dt class="field-even">Unit Test of LaTeX macros in Weaver<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-latex-macros-in-weaver-7">Unit Test of LaTeX macros in Weaver (7)</a></p>
</dd>
<dt class="field-odd">Unit Test of MacroXrefCommand class for a named chunk cross-reference<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-macroxrefcommand-class-for-a-named-chunk-cross-reference-51">Unit Test of MacroXrefCommand class for a named chunk cross-reference (51)</a></p>
</dd>
<dt class="field-even">Unit Test of NamedChunk subclass<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-namedchunk-subclass-22">Unit Test of NamedChunk subclass (22)</a></p>
</dd>
<dt class="field-odd">Unit Test of NamedChunk with no indent<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-namedchunk-with-no-indent-25">Unit Test of NamedChunk with no indent (25)</a></p>
</dd>
<dt class="field-even">Unit Test of NamedDocumentChunk subclass<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-nameddocumentchunk-subclass-31">Unit Test of NamedDocumentChunk subclass (31)</a></p>
</dd>
<dt class="field-odd">Unit Test of OutputChunk subclass<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-outputchunk-subclass-28">Unit Test of OutputChunk subclass (28)</a></p>
</dd>
<dt class="field-even">Unit Test of ReferenceCommand class for chunk references<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-referencecommand-class-for-chunk-references-57">Unit Test of ReferenceCommand class for chunk references (57)</a></p>
</dd>
<dt class="field-odd">Unit Test of Tangler subclass of Emitter<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-tangler-subclass-of-emitter-12">Unit Test of Tangler subclass of Emitter (12)</a></p>
</dd>
<dt class="field-even">Unit Test of TanglerMake subclass of Emitter<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-tanglermake-subclass-of-emitter-13">Unit Test of TanglerMake subclass of Emitter (13)</a></p>
</dd>
<dt class="field-odd">Unit Test of TextCommand class to contain a document text block<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-textcommand-class-to-contain-a-document-text-block-41">Unit Test of TextCommand class to contain a document text block (41)</a></p>
</dd>
<dt class="field-even">Unit Test of UserIdXrefCommand class for a user identifier cross-reference<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-useridxrefcommand-class-for-a-user-identifier-cross-reference-54">Unit Test of UserIdXrefCommand class for a user identifier cross-reference (54)</a></p>
</dd>
<dt class="field-odd">Unit Test of Weaver subclass of Emitter<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-weaver-subclass-of-emitter-5">Unit Test of Weaver subclass of Emitter (5)</a></p>
</dd>
<dt class="field-even">Unit Test of Web class<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-web-class-60">Unit Test of Web class (60)</a></p>
</dd>
<dt class="field-odd">Unit Test of WebReader class<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-webreader-class-65">Unit Test of WebReader class (65)</a>, → <a class="reference internal" href="#unit-test-of-webreader-class-66">Unit Test of WebReader class (66)</a>, → <a class="reference internal" href="#unit-test-of-webreader-class-67">Unit Test of WebReader class (67)</a>, → <a class="reference internal" href="#unit-test-of-webreader-class-68">Unit Test of WebReader class (68)</a></p>
</dd>
<dt class="field-even">Unit Test of XrefCommand superclass for all cross-reference commands<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-xrefcommand-superclass-for-all-cross-reference-commands-47">Unit Test of XrefCommand superclass for all cross-reference commands (47)</a></p>
</dd>
<dt class="field-odd">Unit Test output chunk properties<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-output-chunk-properties-30">Unit Test output chunk properties (30)</a></p>
</dd>
<dt class="field-even">Unit Test output chunk xref<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-output-chunk-xref-29">Unit Test output chunk xref (29)</a></p>
</dd>
<dt class="field-odd">Unit Test overheads<span class="colon">:</span></dt>
<dd class="field-odd"><p>imports, etc.:
→ <a class="reference internal" href="#unit-test-overheads-imports-etc-79">Unit Test overheads: imports, etc. (79)</a>, → <a class="reference internal" href="#unit-test-overheads-imports-etc-80">Unit Test overheads: imports, etc. (80)</a></p>
</dd>
<dt class="field-even">Unit Test reference command methods should work<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-reference-command-methods-should-work-58">Unit Test reference command methods should work (58)</a></p>
</dd>
<dt class="field-odd">Unit Test reference command tangle should work<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-reference-command-tangle-should-work-59">Unit Test reference command tangle should work (59)</a></p>
</dd>
<dt class="field-even">Unit test LoadAction should call WebReader<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-loadaction-should-call-webreader-77">Unit test LoadAction should call WebReader (77)</a></p>
</dd>
<dt class="field-odd">Unit test TangleAction should call Tangler<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-tangleaction-should-call-tangler-75">Unit test TangleAction should call Tangler (75)</a></p>
</dd>
<dt class="field-even">Unit test WeaveAction should call Weaver<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-weaveaction-should-call-weaver-73">Unit test WeaveAction should call Weaver (73)</a></p>
</dd>
<dt class="field-odd">Unit test code command methods should work<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-code-command-methods-should-work-45">Unit test code command methods should work (45)</a></p>
</dd>
<dt class="field-even">Unit test code command tangle should error<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-code-command-tangle-should-error-46">Unit test code command tangle should error (46)</a></p>
</dd>
<dt class="field-odd">Unit test file xref command methods should work<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-file-xref-command-methods-should-work-49">Unit test file xref command methods should work (49)</a></p>
</dd>
<dt class="field-even">Unit test file xref command tangle should error<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-file-xref-command-tangle-should-error-50">Unit test file xref command tangle should error (50)</a></p>
</dd>
<dt class="field-odd">Unit test macro xref command methods should work<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-macro-xref-command-methods-should-work-52">Unit test macro xref command methods should work (52)</a></p>
</dd>
<dt class="field-even">Unit test macro xref command tangle shuould fail<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-macro-xref-command-tangle-shuould-fail-53">Unit test macro xref command tangle shuould fail (53)</a></p>
</dd>
<dt class="field-odd">Unit test named document chunk properties<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-named-document-chunk-properties-33">Unit test named document chunk properties (33)</a></p>
</dd>
<dt class="field-even">Unit test named document chunk xref<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-named-document-chunk-xref-32">Unit test named document chunk xref (32)</a></p>
</dd>
<dt class="field-odd">Unit test of Action Sequence class<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-action-sequence-class-70">Unit test of Action Sequence class (70)</a></p>
</dd>
<dt class="field-even">Unit test of LoadAction class<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-loadaction-class-76">Unit test of LoadAction class (76)</a></p>
</dd>
<dt class="field-odd">Unit test of TangleAction class<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-tangleaction-class-74">Unit test of TangleAction class (74)</a></p>
</dd>
<dt class="field-even">Unit test of WeaverAction class<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-weaveraction-class-72">Unit test of WeaverAction class (72)</a></p>
</dd>
<dt class="field-odd">Unit test of action sequence<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-action-sequence-71">Unit test of action sequence (71)</a></p>
</dd>
<dt class="field-even">Unit test of named chunk no-indent properties<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-named-chunk-no-indent-properties-27">Unit test of named chunk no-indent properties (27)</a></p>
</dd>
<dt class="field-odd">Unit test of named chunk no-indent xref<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-named-chunk-no-indent-xref-26">Unit test of named chunk no-indent xref (26)</a></p>
</dd>
<dt class="field-even">Unit test of named chunk properties<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-named-chunk-properties-24">Unit test of named chunk properties (24)</a></p>
</dd>
<dt class="field-odd">Unit test of named chunk xref<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-named-chunk-xref-23">Unit test of named chunk xref (23)</a></p>
</dd>
<dt class="field-even">Unit test of one-level transitive reference<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-one-level-transitive-reference-37">Unit test of one-level transitive reference (37)</a></p>
</dd>
<dt class="field-odd">Unit test of simple references<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-simple-references-35">Unit test of simple references (35)</a></p>
</dd>
<dt class="field-even">Unit test of top-level transitive reference<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-of-top-level-transitive-reference-38">Unit test of top-level transitive reference (38)</a></p>
</dd>
<dt class="field-odd">Unit test of two-level transitive reference<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-of-two-level-transitive-reference-36">Unit test of two-level transitive reference (36)</a></p>
</dd>
<dt class="field-even">Unit test text command methods should work<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-text-command-methods-should-work-42">Unit test text command methods should work (42)</a></p>
</dd>
<dt class="field-odd">Unit test text command tangle should error<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-text-command-tangle-should-error-43">Unit test text command tangle should error (43)</a></p>
</dd>
<dt class="field-even">Unit test userid xref command methods should work<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-userid-xref-command-methods-should-work-55">Unit test userid xref command methods should work (55)</a></p>
</dd>
<dt class="field-odd">Unit test userid xref command tangle should fail<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-userid-xref-command-tangle-should-fail-56">Unit test userid xref command tangle should fail (56)</a></p>
</dd>
<dt class="field-even">Unit test web iteration over chunks<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-web-iteration-over-chunks-62">Unit test web iteration over chunks (62)</a></p>
</dd>
<dt class="field-odd">Unit test web name resolution<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-web-name-resolution-61">Unit test web name resolution (61)</a></p>
</dd>
<dt class="field-even">Unit test web tangle when valid<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#unit-test-web-tangle-when-valid-63">Unit test web tangle when valid (63)</a></p>
</dd>
<dt class="field-odd">Unit test web weave when valid<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#unit-test-web-weave-when-valid-64">Unit test web weave when valid (64)</a></p>
</dd>
<dt class="field-even">Weave Test evaluation of expressions<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#weave-test-evaluation-of-expressions-105">Weave Test evaluation of expressions (105)</a></p>
</dd>
<dt class="field-odd">Weave Test overheads<span class="colon">:</span></dt>
<dd class="field-odd"><p>imports, etc.:
→ <a class="reference internal" href="#weave-test-overheads-imports-etc-107">Weave Test overheads: imports, etc. (107)</a></p>
</dd>
<dt class="field-even">Weave Test references and definitions<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#weave-test-references-and-definitions-101">Weave Test references and definitions (101)</a></p>
</dd>
<dt class="field-odd">expected RST output<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#expected-rst-output-6">expected RST output (6)</a></p>
</dd>
<dt class="field-even">expected html output<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#expected-html-output-11">expected html output (11)</a></p>
</dd>
<dt class="field-odd">expected tex minted output<span class="colon">:</span></dt>
<dd class="field-odd"><p>→ <a class="reference internal" href="#expected-tex-minted-output-9">expected tex minted output (9)</a></p>
</dd>
<dt class="field-even">expected tex output<span class="colon">:</span></dt>
<dd class="field-even"><p>→ <a class="reference internal" href="#expected-tex-output-8">expected tex output (8)</a></p>
</dd>
</dl>
<hr class="docutils" />
<div class="small docutils container">
<blockquote>
<div><p>Created by src/pyweb.py at Sat Oct 26 19:20:29 2024.</p>
</div></blockquote>
<p>Source pyweb_test.w modified Sun Oct 20 13:50:38 2024.</p>
<blockquote>
<div><p>pyweb.__version__ ‘3.3’.</p>
<p>Working directory ‘/Users/slott/Documents/Projects/py-web-tool’.</p>
</div></blockquote>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyWebTool</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pyweb.html">pyWeb Literate Programming 3.3</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pyWeb Literate Programming 3.3 - Test Suite</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unit-testing">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functional-testing">Functional Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-scripts-testing">Additional Scripts Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#indices">Indices</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="pyweb.html" title="previous chapter">pyWeb Literate Programming 3.3</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, S.Lott.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/pyweb_test.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>